<!doctype html>
<meta charset="utf-8" />
<meta name="color-scheme" content="light" />
<meta name="robots" content="noindex" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" type="image/x-icon" href="./favicon.ico">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<title>~</title>

<script>
    // Initialize and load saved shortcuts
    document.addEventListener('DOMContentLoaded', function() {
        // Load saved commands if they exist
        try {
            const savedCommands = localStorage.getItem('homeCommands');
            if (savedCommands) {
                const commandsArray = JSON.parse(savedCommands);
                // Clear the existing commands and add the saved ones
                if (typeof COMMANDS !== 'undefined') {
                    COMMANDS.clear();
                    for (const [key, value] of commandsArray) {
                        COMMANDS.set(key, value);
                    }
                }
            }
        } catch (e) {
            console.error('Error loading saved commands:', e);
        }
        
        // Make sure to apply saved theme first before other components initialize
        try {
            const savedSettings = localStorage.getItem('homeSettings');
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                document.documentElement.classList.toggle('dark-mode', settings.darkMode || false);
                // Store theme data in a data attribute for commands component to access
                document.documentElement.dataset.theme = settings.theme || 'default';
                document.documentElement.dataset.darkMode = settings.darkMode || false;
            }
        } catch (e) {
            console.error('Error pre-loading theme settings:', e);
        }
    });

    document.addEventListener('DOMContentLoaded', function() {
        function updateLinks(isLocal) {
            COMMANDS.forEach((value, key) => {
                try {
                    const url = new URL(value.url);
                    if (isLocal && url.hostname === 'ams') {
                        url.hostname = '192.168.1.9';
                    } else if (!isLocal && url.hostname === '192.168.1.9') {
                        url.hostname = 'ams';
                    }
                    value.url = url.toString();
                    console.log(`Updated command ${key}: ${value.url}`);
                } catch (e) {
                    console.error(`Error updating URL for command ${key}:`, e);
                }
            });
        }

        function isLocalNetwork() {
            fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(data => {
                    const publicIP = data.ip;
                    console.log('Detected public IP:', publicIP);

                    // Resolve a.088899.xyz to get the current public IP
                    fetch('https://dns.google/resolve?name=a.088899.xyz&type=A')
                        .then(response => response.json())
                        .then(dnsData => {
                            const domainIP = dnsData.Answer[0].data;
                            console.log('Resolved domain IP:', domainIP);

                            const isLocal = publicIP === domainIP;
                            console.log('Is local network:', isLocal);

                            updateLinks(isLocal);
                            // Reinitialize the commands component to apply the updated URLs
                            document.querySelector('commands-component').initialize();
                        })
                        .catch(error => {
                            console.error('Error resolving domain IP:', error);
                        });
                })
                .catch(error => {
                    console.error('Error detecting public IP:', error);
                });
        }

        isLocalNetwork();

        // Create settings dot and widget
        const settingsWidget = document.createElement('settings-widget');
        document.body.appendChild(settingsWidget);
        
        const settingsDot = document.createElement('div');
        settingsDot.className = 'settings-dot';
        settingsDot.addEventListener('click', () => {
            const settingsEl = document.querySelector('settings-widget');
            settingsEl.toggle();
        });
        document.body.appendChild(settingsDot);
        
        // Existing event listeners
        document.getElementById('greeting').textContent = getGreeting();
        document.getElementById('quote').textContent = getRandomQuote();
    });

    class Commands extends HTMLElement {
        constructor() {
            super();
            this.attachShadow({ mode: 'open' });
            this.initialize();
            
            // Add click event listener for handling shortcut editing
            this.shadowRoot.addEventListener('click', (e) => {
                // Check if we're in edit mode (settings panel is open)
                const settingsPanel = document.querySelector('settings-widget')?.shadowRoot?.querySelector('.settings-panel');
                const isEditMode = settingsPanel?.classList?.contains('open');
                
                if (!isEditMode) return; // Only handle edits when settings panel is open
                
                const command = e.target.closest('.command');
                if (!command) return;
                
                // We're in edit mode and clicked on a command, prevent navigation
                e.preventDefault();
                e.stopPropagation();
                
                // Get the key from the data attribute or key element text
                const key = command.dataset.key || command.querySelector('.key')?.textContent;
                console.log('Edit shortcut with key:', key);
                
                // Trigger the edit in the settings widget
                const settingsWidget = document.querySelector('settings-widget');
                if (settingsWidget && typeof settingsWidget.editShortcut === 'function') {
                    settingsWidget.editShortcut(key);
                } else {
                    console.error('Could not access settings widget or edit function');
                }
            });
        }
        
        initialize() {
            const template = document.getElementById('commands-template');
            const clone = template.content.cloneNode(true);
            const commands = clone.querySelector('.commands');
            const commandTemplate = document.getElementById('command-template');
            
            commands.innerHTML = ''; // Clear existing commands
            
            for (const [key, { name, url }] of COMMANDS.entries()) {
                if (!name || !url) continue;
                const clone = commandTemplate.content.cloneNode(true);
                const command = clone.querySelector('.command');
                
                // Set command properties
                command.href = url;
                command.dataset.key = key; // Store the key as a data attribute
                command.setAttribute('data-key', key); // Set as attribute for older browsers
                
                // Set target for external links
                if (CONFIG.openLinksInNewTab) command.target = '_blank';
                
                // Set text content for key and name
                clone.querySelector('.key').textContent = key;
                clone.querySelector('.name').textContent = name;
                
                // Add to commands list
                commands.append(clone);
            }
            
            this.shadowRoot.innerHTML = '';  // Clear the shadow DOM before appending
            this.shadowRoot.append(clone);
            
            // Apply theme to the commands after initialization
            const theme = document.documentElement.dataset.theme || 'default';
            const isDarkMode = document.documentElement.dataset.darkMode === 'true';
            setTimeout(() => {
                const settingsWidget = document.querySelector('settings-widget');
                if (settingsWidget && typeof settingsWidget.synchronizeCommands === 'function') {
                    settingsWidget.synchronizeCommands();
                }
            }, 0);
        }
    }

    customElements.define('commands-component', Commands);
</script>


<style>
    :root {
        --border-radius: 8px;
        --color-background: #f8f5e6; /* Vanilla/yellowish background */
        --color-text-subtle: #666666; /* Subtle gray text */
        --color-text: #222222; /* Near black text */
        --color-accent: #333333; /* Accent color */
        --color-hover: #444444; /* Hover color */
        --font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        --font-size: clamp(13px, 1vw, 15px); /* Smaller font size */
        --font-weight-bold: 500;
        --font-weight-normal: 400;
        --space: .5rem;
        --transition-speed: 200ms;
        --box-shadow: 0 1px 4px rgba(0, 0, 0, 0.03);
    }
</style>

<script>
    const CONFIG = {
        commandPathDelimiter: '/',
        commandSearchDelimiter: ' ',
        defaultSearchTemplate: 'https://www.google.com/search?q={}',
        openLinksInNewTab: false,
        suggestionLimit: 4,
    };

    const COMMANDS = new Map([
        ['a', { name: 'Plex', url: 'https://app.plex.tv/desktop/' }],
        ['b', { name: 'Sonarr', url: 'https://sonarr.088899.xyz' }],
        ['c', { name: 'Radarr', url: 'https://radarr.088899.xyz' }],
        ['i', { name: 'Transmission', url: 'https://tr.088899.xyz' }],
        ['f', { name: 'Metube', url: 'https://mt.088899.xyz' }],
        ['g', { name: 'Jackett', url: 'https://jkt.088899.xyz' }],
        ['h', { name: 'DNS', url: 'http://ams:8000' }],
        ['d', { name: 'Twitch', url: 'https://twitch.tv' }],
        ['j', { name: 'Twitter', url: 'https://x.com' }],
        ['k', { name: 'Gmail', url: 'https://gmail.com/' }],
        [
            's',
            {
                name: 'YouTube',
                searchTemplate: '/results?search_query={}',
                url: 'https://youtube.com/',
            },
        ],
        [
            'q',
            {
                name: 'Most used',
                searchTemplate: ':{}',
                suggestions: ['web.whatsapp.com', 'anilist.co', 'discord.com/app'],
                url: 'http://localhost:3000',
            },
        ],
    ]);
</script>

<template id="commands-template">
    <style>
        .commands {
            border-radius: var(--border-radius);
            column-gap: 2.5rem;
            columns: 1;
            list-style: none;
            margin: 0 auto;
            max-width: 10rem;
            overflow: hidden;
            padding: 2rem;
            width: 100vw;
            background-color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(0, 0, 0, 0.02);
            box-shadow: var(--box-shadow);
        }

        .command {
            display: flex;
            gap: 0.8rem;
            outline: 0;
            padding: 0.4rem 0.2rem;
            position: relative;
            text-decoration: none;
            border-radius: var(--border-radius);
            margin-bottom: 12px;
            transition: all var(--transition-speed);
        }

        .command:where(:focus, :hover) {
            background-color: transparent;
        }

        .command:where(:focus, :hover) .name::after {
            width: 100%;
        }
        
        /* Style for editable commands when settings panel is open */
        .editable .command {
            cursor: pointer;
            position: relative;
            transition: all 0.2s ease-in-out;
        }
        
        .editable .command::after {
            content: "✎";
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.7em;
            opacity: 0;
            transition: opacity var(--transition-speed), transform 0.2s ease;
            color: var(--color-accent);
        }
        
        .editable .command:hover::after {
            opacity: 0.8;
            transform: translateY(-50%) scale(1.2);
        }
        
        .editable .command:hover {
            background-color: rgba(0, 0, 0, 0.03);
            transform: translateX(3px);
            padding-right: 20px; /* Make room for the edit icon */
        }
        
        .key {
            color: var(--color-accent);
            display: inline-block;
            text-align: center;
            width: 1.5ch;
            font-weight: var(--font-weight-bold);
            font-size: 0.85em;
            opacity: 0.65;
        }
        
        .editable .key {
            color: var(--color-hover);
            font-weight: 600;
        }

        .name {
            color: var(--color-text-subtle);
            transition: color var(--transition-speed);
            letter-spacing: 0.01em;
            position: relative;
            font-size: 0.95em;
        }

        .name::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 1px;
            background-color: var(--color-text);
            transition: width var(--transition-speed);
        }

        .command:where(:focus, :hover) .name {
            color: var(--color-text);
        }

        @media (min-width: 500px) {
            .commands {
                columns: 2;
                max-width: 30rem;
            }
        }

        @media (min-width: 900px) {
            .commands {
                columns: 4;
                max-width: 52rem;
            }
        }
    </style>
    <nav>
        <menu class="commands"></menu>
    </nav>
</template>

<template id="command-template">
    <li>
        <a class="command" rel="noopener noreferrer">
            <span class="key"></span>
            <span class="name"></span>
        </a>
    </li>
</template>

<template id="search-template">
    <style>
        input,
        button {
            -moz-appearance: none;
            -webkit-appearance: none;
            background: transparent;
            border: 0;
            display: block;
            outline: 0;
        }

        .dialog {
            align-items: center;
            background: var(--color-background);
            border: none;
            display: none;
            flex-direction: column;
            height: 100%;
            justify-content: center;
            left: 0;
            padding: 0;
            top: 0;
            width: 100%;
            backdrop-filter: blur(3px);
        }

        .dialog[open] {
            display: flex;
        }

        .form {
            width: 100%;
            max-width: 500px;
        }

        .input {
            color: var(--color-text);
            font-size: 1.3rem;
            font-weight: var(--font-weight-normal);
            padding: 0.5rem 1rem;
            text-align: center;
            width: 100%;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            font-family: var(--font-family);
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: var(--border-radius);
        }

        .suggestions {
            align-items: center;
            display: flex;
            flex-direction: column;
            flex-wrap: wrap;
            justify-content: center;
            list-style: none;
            margin: var(--space) 0 0;
            overflow: hidden;
            padding: 0;
        }

        .suggestion {
            color: var(--color-text);
            cursor: pointer;
            font-size: 0.9rem;
            padding: var(--space);
            position: relative;
            transition: color var(--transition-speed);
            white-space: nowrap;
            z-index: 1;
            border-radius: var(--border-radius);
        }

        .suggestion:where(:focus, :hover) {
            color: var(--color-background);
        }

        .suggestion::before {
            background-color: var(--color-accent);
            border-radius: var(--border-radius);
            content: ' ';
            inset: calc(var(--space) / 1.5) calc(var(--space) / 3);
            opacity: 0;
            position: absolute;
            transform: translateY(0.5em);
            transition: all var(--transition-speed);
            z-index: -1;
        }

        .suggestion:where(:focus, :hover)::before {
            opacity: 1;
            transform: translateY(0);
        }

        .match {
            color: var(--color-text-subtle);
            transition: color var(--transition-speed);
        }

        .suggestion:where(:focus, :hover) .match {
            color: var(--color-background);
        }

        @media (min-width: 700px) {
            .suggestions {
                flex-direction: row;
            }
        }
    </style>
    <dialog class="dialog">
        <form autocomplete="off" class="form" method="dialog" spellcheck="false">
            <input class="input" title="search" type="text" />
            <menu class="suggestions"></menu>
        </form>
    </dialog>
</template>

<template id="suggestion-template">
    <li>
        <button class="suggestion" type="button"></button>
    </li>
</template>

<template id="match-template">
    <span class="match"></span>
</template>

<script type="module">
    class Search extends HTMLElement {
        #dialog;
        #form;
        #input;
        #suggestions;

        constructor() {
            super();
            this.attachShadow({ mode: 'open' });
            const template = document.getElementById('search-template');
            const clone = template.content.cloneNode(true);
            this.#dialog = clone.querySelector('.dialog');
            this.#form = clone.querySelector('.form');
            this.#input = clone.querySelector('.input');
            this.#suggestions = clone.querySelector('.suggestions');
            this.#form.addEventListener('submit', this.#onSubmit, false);
            this.#input.addEventListener('input', this.#onInput);
            this.#suggestions.addEventListener('click', this.#onSuggestionClick);
            document.addEventListener('keydown', this.#onKeydown);
            this.shadowRoot.append(clone);
        }

        static #attachSearchPrefix(array, { key, splitBy }) {
            if (!splitBy) return array;
            return array.map((search) => `${key}${splitBy}${search}`);
        }

        static #escapeRegexCharacters(s) {
            return s.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
        }

        static #fetchDuckDuckGoSuggestions(search) {
            return new Promise((resolve) => {
                window.autocompleteCallback = (res) => {
                    const suggestions = [];

                    for (const item of res) {
                        if (item.phrase === search.toLowerCase()) continue;
                        suggestions.push(item.phrase);
                    }

                    resolve(suggestions);
                };

                const script = document.createElement('script');
                document.querySelector('head').appendChild(script);
                script.src = `https://duckduckgo.com/ac/?callback=autocompleteCallback&q=${search}`;
                script.onload = script.remove;
            });
        }

        static #formatSearchUrl(url, searchPath, search) {
            if (!searchPath) return url;
            const [baseUrl] = Search.#splitUrl(url);
            const urlQuery = encodeURIComponent(search);
            searchPath = searchPath.replace(/{}/g, urlQuery);
            return baseUrl + searchPath;
        }

        static #hasProtocol(s) {
            return /^[a-zA-Z]+:\/\//i.test(s);
        }

        static #isUrl(s) {
            return /^((https?:\/\/)?[\w-]+(\.[\w-]+)+\.?(:\d+)?(\/\S*)?)$/i.test(s);
        }

        static #parseQuery = (raw) => {
            const query = raw.trim();

            if (this.#isUrl(query)) {
                const url = this.#hasProtocol(query) ? query : `https://${query}`;
                return { query, url };
            }

            if (COMMANDS.has(query)) {
                const { command, key, url } = COMMANDS.get(query);
                return command ? Search.#parseQuery(command) : { key, query, url };
            }

            let splitBy = CONFIG.commandSearchDelimiter;
            const [searchKey, rawSearch] = query.split(new RegExp(`${splitBy}(.*)`));

            if (COMMANDS.has(searchKey)) {
                const { searchTemplate, url: base } = COMMANDS.get(searchKey);
                const search = rawSearch.trim();
                const url = Search.#formatSearchUrl(base, searchTemplate, search);
                return { key: searchKey, query, search, splitBy, url };
            }

            splitBy = CONFIG.commandPathDelimiter;
            const [pathKey, path] = query.split(new RegExp(`${splitBy}(.*)`));

            if (COMMANDS.has(pathKey)) {
                const { url: base } = COMMANDS.get(pathKey);
                const [baseUrl] = Search.#splitUrl(base);
                const url = `${baseUrl}/${path}`;
                return { key: pathKey, path, query, splitBy, url };
            }

            const [baseUrl, rest] = Search.#splitUrl(CONFIG.defaultSearchTemplate);
            const url = Search.#formatSearchUrl(baseUrl, rest, query);
            return { query, search: query, url };
        };

        static #splitUrl(url) {
            const parser = document.createElement('a');
            parser.href = url;
            const baseUrl = `${parser.protocol}//${parser.hostname}`;
            const rest = `${parser.pathname}${parser.search}`;
            return [baseUrl, rest];
        }

        #close() {
            this.#input.value = '';
            this.#input.blur();
            this.#dialog.close();
            this.#suggestions.innerHTML = '';
        }

        #execute(query) {
            const { url } = Search.#parseQuery(query);
            const target = CONFIG.openLinksInNewTab ? '_blank' : '_self';
            window.open(url, target, 'noopener noreferrer');
            this.#close();
        }

        #focusNextSuggestion(previous = false) {
            const active = this.shadowRoot.activeElement;
            let nextIndex;

            if (active.dataset.index) {
                const activeIndex = Number(active.dataset.index);
                nextIndex = previous ? activeIndex - 1 : activeIndex + 1;
            } else {
                nextIndex = previous ? this.#suggestions.childElementCount - 1 : 0;
            }

            const next = this.#suggestions.children[nextIndex];
            if (next) next.querySelector('.suggestion').focus();
            else this.#input.focus();
        }

        #onInput = async () => {
            const oq = Search.#parseQuery(this.#input.value);

            if (!oq.query) {
                this.#close();
                return;
            }

            let suggestions = COMMANDS.get(oq.query)?.suggestions ?? [];

            if (oq.search && suggestions.length < CONFIG.suggestionLimit) {
                const res = await Search.#fetchDuckDuckGoSuggestions(oq.search);
                const formatted = Search.#attachSearchPrefix(res, oq);
                suggestions = suggestions.concat(formatted);
            }

            const nq = Search.#parseQuery(this.#input.value);
            if (nq.query !== oq.query) return;
            this.#renderSuggestions(suggestions, oq.query);
        };

        #onKeydown = (e) => {
            if (!this.#dialog.open) {
                this.#dialog.show();
                this.#input.focus();

                requestAnimationFrame(() => {
                    // close the search dialog before the next repaint if a character is
                    // not produced (e.g. if you type shift, control, alt etc.)
                    if (!this.#input.value) this.#close();
                });

                return;
            }

            if (e.key === 'Escape') {
                this.#close();
                return;
            }

            const alt = e.altKey ? 'alt-' : '';
            const ctrl = e.ctrlKey ? 'ctrl-' : '';
            const meta = e.metaKey ? 'meta-' : '';
            const shift = e.shiftKey ? 'shift-' : '';
            const modifierPrefixedKey = `${alt}${ctrl}${meta}${shift}${e.key}`;

            if (/^(ArrowDown|Tab|ctrl-n)$/.test(modifierPrefixedKey)) {
                e.preventDefault();
                this.#focusNextSuggestion();
                return;
            }

            if (/^(ArrowUp|ctrl-p|shift-Tab)$/.test(modifierPrefixedKey)) {
                e.preventDefault();
                this.#focusNextSuggestion(true);
            }
        };

        #onSubmit = () => {
            this.#execute(this.#input.value);
        };

        #onSuggestionClick = (e) => {
            const ref = e.target.closest('.suggestion');
            if (!ref) return;
            this.#execute(ref.dataset.suggestion);
        };

        #renderSuggestions(suggestions, query) {
            this.#suggestions.innerHTML = '';
            const sliced = suggestions.slice(0, CONFIG.suggestionLimit);
            const template = document.getElementById('suggestion-template');

            for (const [index, suggestion] of sliced.entries()) {
                const clone = template.content.cloneNode(true);
                const ref = clone.querySelector('.suggestion');
                ref.dataset.index = index;
                ref.dataset.suggestion = suggestion;
                const escapedQuery = Search.#escapeRegexCharacters(query);
                const matched = suggestion.match(new RegExp(escapedQuery, 'i'));

                if (matched) {
                    const template = document.getElementById('match-template');
                    const clone = template.content.cloneNode(true);
                    const matchRef = clone.querySelector('.match');
                    const pre = suggestion.slice(0, matched.index);
                    const post = suggestion.slice(matched.index + matched[0].length);
                    matchRef.innerText = matched[0];
                    matchRef.insertAdjacentHTML('beforebegin', pre);
                    matchRef.insertAdjacentHTML('afterend', post);
                    ref.append(clone);
                } else {
                    ref.innerText = suggestion;
                }

                this.#suggestions.append(clone);
            }
        }
    }

    customElements.define('search-component', Search);
</script>

<style>
    html {
        background-color: var(--color-background);
        background-image: linear-gradient(135deg, #f8f5e6, #f2edd0);
        font-family: var(--font-family);
        font-size: var(--font-size);
        line-height: 1.4;
        height: 100%;
    }

    body {
        margin: 0;
        color: var(--color-text);
        height: 100%;
    }

    main {
        align-items: center;
        box-sizing: border-box;
        display: flex;
        justify-content: center;
        min-height: 100vh;
        overflow: hidden;
        padding: calc(var(--space) * 4) var(--space);
        position: relative;
        width: 100vw;
    }

    /* Hide the background element */
    bgelement {
        display: none;
    }

    /* Corner text styles */
    .corner-text {
        position: fixed;
        padding: 2rem;
        font-size: 0.68rem;
        line-height: 1.6;
        color: var(--color-text-subtle);
        opacity: 0.7;
        letter-spacing: 0.03em;
    }

    .top-left {
        top: 0;
        left: 0;
        text-align: left;
    }

    .top-right {
        top: 0;
        right: 0;
        text-align: right;
    }

    .bottom-left {
        bottom: 0;
        left: 0;
        text-align: left;
        max-width: 300px;
        font-style: italic;
    }

    .bottom-right {
        bottom: 0;
        right: 0;
        text-align: right;
    }

    .corner-text span {
        display: inline-block;
    }

    .corner-text .label {
        font-weight: var(--font-weight-bold);
        opacity: 0.8;
        margin-bottom: 0.3rem;
        text-transform: lowercase;
        letter-spacing: 0.05em;
    }
    
    #greeting, #quote, .bottom-right {
        opacity: 0.7;
    }
    
    #quote {
        font-size: 0.65rem;
        max-width: 250px;
        line-height: 1.7;
    }
    
    .bottom-right {
        font-size: 0.65rem;
        letter-spacing: 0.05em;
    }

    /* Settings dot styles */
    .settings-dot {
        position: fixed;
        bottom: 1rem;
        left: 50%;
        transform: translateX(-50%);
        width: 4px; /* Smaller visual dot */
        height: 4px; /* Smaller visual dot */
        background-color: var(--color-text-subtle);
        border-radius: 50%;
        opacity: 0.5;
        cursor: pointer;
        transition: all var(--transition-speed);
        z-index: 10;
        /* Make hit area much larger than visual dot */
        margin: 1.3rem;
        padding: 1px;
        box-sizing: content-box;
        /* Add subtle shadow to make it more visible */
        box-shadow: 0 0 2px rgba(0, 0, 0, 0.1);
    }

    .settings-dot:hover {
        opacity: 0.8;
        transform: translateX(-50%) scale(1.2);
        background-color: var(--color-accent);
        box-shadow: 0 0 4px rgba(0, 0, 0, 0.15);
    }
    
    /* Responsive styles for various screen sizes */
    @media (max-width: 768px) {
        main {
            padding: calc(var(--space) * 3) var(--space);
            align-items: flex-start;
            padding-top: 4rem;
        }
        
        .corner-text {
            padding: 1.5rem;
        }
    }
    
    @media (max-width: 480px) {
        main {
            padding: calc(var(--space) * 2) var(--space);
            align-items: flex-start;
            padding-top: 3.5rem;
        }
        
        .corner-text {
            padding: 1rem;
        }
        
        .settings-dot {
            bottom: 0.5rem;
        }
    }
</style>

<script>
    // Function to get time of day greeting
    function getGreeting() {
        const hour = new Date().getHours();
        if (hour < 12) return "good morning";
        if (hour < 18) return "good afternoon";
        return "good evening";
    }

    // Random quotes array
    const QUOTES = [
        "The only way to do great work is to love what you do.",
        "Your time is limited, don't waste it living someone else's life.",
        "Stay hungry, stay foolish.",
        "Innovation distinguishes between a leader and a follower.",
        "The greatest glory in living lies not in never falling, but in rising every time we fall.",
        "Education is the most powerful weapon which you can use to change the world.",
        "The only source of knowledge is experience.",
        "Imagination is more important than knowledge.",
        "Strive not to be a success, but rather to be of value.",
        "If you can't explain it simply, you don't understand it well enough."
    ];

    // Function to get random quote
    function getRandomQuote() {
        return QUOTES[Math.floor(Math.random() * QUOTES.length)];
    }

    // Set corner text content when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('greeting').textContent = getGreeting();
        document.getElementById('quote').textContent = getRandomQuote();
    });
</script>

<main>
    <commands-component></commands-component>
    <search-component></search-component>
</main>

<div class="corner-text top-left">
    <span class="label">home</span><br>
    <span class="label">links</span>
</div>

<div class="corner-text top-right">
    <span id="greeting">good day</span>
</div>

<div class="corner-text bottom-left">
    <span id="quote"></span>
</div>

<div class="corner-text bottom-right">
    A. Magno
</div>

<template id="settings-widget-template">
    <style>
        .settings-panel {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            width: 280px;
            max-width: 90vw;
            z-index: 9;
            display: none;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .settings-panel.open {
            display: block;
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-50%) translateY(10px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        .settings-title {
            font-size: 0.8rem;
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
            margin-bottom: 0.8rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            padding-bottom: 0.5rem;
        }

        .settings-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.8rem;
        }

        .settings-option-label {
            font-size: 0.75rem;
            color: var(--color-text-subtle);
        }

        .settings-checkbox {
            position: relative;
            width: 30px;
            height: 16px;
        }

        .settings-checkbox input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .settings-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .3s;
            border-radius: 34px;
        }

        .settings-slider:before {
            position: absolute;
            content: "";
            height: 12px;
            width: 12px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }

        input:checked + .settings-slider {
            background-color: var(--color-accent);
        }

        input:checked + .settings-slider:before {
            transform: translateX(14px);
        }
        
        .settings-select {
            font-family: var(--font-family);
            font-size: 0.75rem;
            color: var(--color-text);
            background-color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            padding: 3px 6px;
            width: 120px;
            outline: none;
            transition: all var(--transition-speed);
        }
        
        .settings-select:focus {
            border-color: var(--color-accent);
            box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.05);
        }
        
        /* Share Settings Section */
        .share-settings {
            margin-top: 1rem;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
            padding-top: 1rem;
        }
        
        .share-title {
            font-size: 0.75rem;
            font-weight: var(--font-weight-bold);
            margin-bottom: 0.8rem;
            color: var(--color-text-subtle);
        }
        
        .share-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.8rem;
        }
        
        .share-button {
            font-family: var(--font-family);
            font-size: 0.7rem;
            font-weight: var(--font-weight-bold);
            color: var(--color-text-subtle);
            background-color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            padding: 5px 10px;
            cursor: pointer;
            transition: all var(--transition-speed);
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .share-button:hover {
            background-color: rgba(0, 0, 0, 0.03);
        }
        
        .share-button.import {
            background-color: var(--color-accent);
            color: white;
            border-color: transparent;
        }
        
        .share-button.import:hover {
            opacity: 0.9;
        }
        
        .share-input {
            width: 100%;
            font-family: var(--font-family);
            font-size: 0.75rem;
            color: var(--color-text);
            background-color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            padding: 5px 8px;
            outline: none;
            transition: all var(--transition-speed);
            margin-bottom: 0.5rem;
            min-height: 60px;
            max-height: 120px;
            resize: vertical;
            box-sizing: border-box;
            overflow-wrap: break-word;
        }
        
        .share-input:focus {
            border-color: var(--color-accent);
            box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.05);
        }
        
        .share-message {
            font-size: 0.65rem;
            color: var(--color-text-subtle);
            margin-top: 0.3rem;
            text-align: center;
            height: 1.3em;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .share-message.visible {
            opacity: 1;
        }
        
        /* Shortcut editor styles */
        .shortcut-editor {
            display: none;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .shortcut-editor.active {
            display: block;
            animation: fadeIn 0.2s ease-out;
        }
        
        .shortcut-editor-title {
            font-size: 0.75rem;
            font-weight: var(--font-weight-bold);
            margin-bottom: 0.8rem;
            color: var(--color-text-subtle);
        }
        
        .shortcut-form-group {
            margin-bottom: 0.8rem;
        }
        
        .shortcut-form-label {
            display: block;
            font-size: 0.7rem;
            margin-bottom: 0.3rem;
            color: var(--color-text-subtle);
        }
        
        .shortcut-form-input {
            width: 100%;
            font-family: var(--font-family);
            font-size: 0.75rem;
            color: var(--color-text);
            background-color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            padding: 5px 8px;
            outline: none;
            transition: all var(--transition-speed);
            box-sizing: border-box;
        }
        
        .shortcut-form-input:focus {
            border-color: var(--color-accent);
            box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.05);
        }
        
        .shortcut-form-key {
            width: 3ch;
            text-align: center;
        }
        
        .new-shortcut-button {
            display: block;
            width: 100%;
            font-family: var(--font-family);
            font-size: 0.75rem;
            font-weight: var(--font-weight-bold);
            color: var(--color-text-subtle);
            background-color: rgba(255, 255, 255, 0.7);
            border: 1px dashed rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            padding: 0.5rem;
            margin-top: 1rem;
            cursor: pointer;
            transition: all var(--transition-speed);
            text-align: center;
            box-sizing: border-box;
        }
        
        .new-shortcut-button:hover {
            background-color: rgba(0, 0, 0, 0.03);
            color: var(--color-text);
        }

        .shortcut-form-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 1rem;
        }

        .shortcut-form-button {
            font-family: var(--font-family);
            font-size: 0.7rem;
            font-weight: var(--font-weight-bold);
            color: var(--color-text-subtle);
            background-color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            padding: 5px 10px;
            cursor: pointer;
            transition: all var(--transition-speed);
        }

        .shortcut-form-button:hover {
            background-color: rgba(0, 0, 0, 0.03);
        }

        .shortcut-form-button.primary {
            background-color: var(--color-accent);
            color: white;
            border-color: transparent;
        }

        .shortcut-form-button.primary:hover {
            opacity: 0.9;
        }

        .shortcut-form-button.danger {
            color: #e53935;
            border-color: rgba(229, 57, 53, 0.3);
        }

        .shortcut-form-button.danger:hover {
            background-color: rgba(229, 57, 53, 0.1);
        }
    </style>
    <div class="settings-panel">
        <div class="settings-title">Settings</div>
        <div class="settings-option">
            <span class="settings-option-label">Open links in new tab</span>
            <label class="settings-checkbox">
                <input type="checkbox" id="new-tab-setting">
                <span class="settings-slider"></span>
            </label>
        </div>
        <div class="settings-option">
            <span class="settings-option-label">Dark mode</span>
            <label class="settings-checkbox">
                <input type="checkbox" id="dark-mode-setting">
                <span class="settings-slider"></span>
            </label>
        </div>
        <div class="settings-option">
            <span class="settings-option-label">Theme</span>
            <select id="theme-select" class="settings-select">
                <option value="default">Default</option>
                <option value="minimal">Minimal</option>
                <option value="glass">Glass Modern</option>
                <option value="ocean">Ocean</option>
                <option value="swiss">Swiss</option>
            </select>
        </div>
        
        <!-- Share Settings Section -->
        <div class="share-settings">
            <div class="share-title">Share Settings</div>
            <div class="share-buttons">
                <button type="button" class="share-button" id="export-settings">Export</button>
                <button type="button" class="share-button import" id="import-settings">Import</button>
            </div>
            <textarea class="share-input" id="share-data" placeholder="Paste settings data here to import, or click Export to generate shareable data."></textarea>
            <div class="share-message" id="share-message"></div>
        </div>
        
        <button type="button" class="new-shortcut-button" id="new-shortcut">+ Add New Shortcut</button>
        
        <!-- Shortcut Editor Form -->
        <div class="shortcut-editor" id="shortcut-editor">
            <div class="shortcut-editor-title">Edit Shortcut</div>
            <form id="shortcut-form">
                <div class="shortcut-form-group">
                    <label class="shortcut-form-label">Key</label>
                    <input type="text" class="shortcut-form-input shortcut-form-key" id="shortcut-key" maxlength="1">
                </div>
                <div class="shortcut-form-group">
                    <label class="shortcut-form-label">Name</label>
                    <input type="text" class="shortcut-form-input" id="shortcut-name">
                </div>
                <div class="shortcut-form-group">
                    <label class="shortcut-form-label">URL</label>
                    <input type="text" class="shortcut-form-input" id="shortcut-url">
                </div>
                <div class="shortcut-form-buttons">
                    <button type="button" class="shortcut-form-button danger" id="shortcut-delete">Delete</button>
                    <div>
                        <button type="button" class="shortcut-form-button" id="shortcut-cancel">Cancel</button>
                        <button type="submit" class="shortcut-form-button primary" id="shortcut-save">Save</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</template>

<script type="module">
    class SettingsWidget extends HTMLElement {
        #panel;
        #newTabSetting;
        #darkModeSetting;
        #themeSelect;
        #currentTheme = 'default';
        
        // Shortcut editor elements
        #shortcutEditor;
        #shortcutForm;
        #shortcutKey;
        #shortcutName;
        #shortcutUrl;
        #shortcutDelete;
        #shortcutCancel;
        #shortcutSave;
        #newShortcut;
        #editingKey = null;
        
        // Share settings elements
        #exportButton;
        #importButton;
        #shareData;
        #shareMessage;
        
        // Theme definitions
        #themes = {
            default: {
                light: {
                    background: '#f8f5e6',
                    gradient: 'linear-gradient(135deg, #f8f5e6, #f2edd0)',
                    text: '#222222',
                    textSubtle: '#666666',
                    accent: '#333333',
                    hover: '#444444',
                    boxShadow: '0 1px 4px rgba(0, 0, 0, 0.03)'
                },
                dark: {
                    background: '#1a1a1a',
                    gradient: 'linear-gradient(135deg, #222, #333)',
                    text: '#e0e0e0',
                    textSubtle: '#a0a0a0',
                    accent: '#505050',
                    hover: '#707070',
                    boxShadow: '0 1px 4px rgba(0, 0, 0, 0.2)'
                }
            },
            minimal: {
                light: {
                    background: '#ffffff',
                    gradient: 'none',
                    text: '#000000',
                    textSubtle: '#999999',
                    accent: '#cccccc',
                    hover: '#eeeeee',
                    boxShadow: 'none',
                    borderRadius: '0',
                    borderWidth: '0',
                    fontFamily: '\"Courier New\", monospace',
                    fontSize: '12px',
                    commandsBackground: 'transparent',
                    commandsBorder: 'none',
                    commandsBoxShadow: 'none',
                    commandMaxWidth: '70rem',
                    keyColor: '#666666'
                },
                dark: {
                    background: '#000000',
                    gradient: 'none',
                    text: '#ffffff',
                    textSubtle: '#777777',
                    accent: '#333333',
                    hover: '#222222',
                    boxShadow: 'none',
                    borderRadius: '0',
                    borderWidth: '0',
                    fontFamily: '\"Courier New\", monospace',
                    fontSize: '12px',
                    commandsBackground: 'transparent',
                    commandsBorder: 'none',
                    commandsBoxShadow: 'none',
                    commandMaxWidth: '70rem',
                    keyColor: '#999999'
                }
            },
            swiss: {
                light: {
                    background: '#ffffff',
                    gradient: 'none',
                    text: '#111111',
                    textSubtle: '#666666',
                    accent: '#ff3b30',
                    hover: '#ff6651',
                    boxShadow: 'none',
                    borderRadius: '0',
                    borderWidth: '0',
                    fontFamily: '\"Helvetica Neue\", Arial, sans-serif',
                    fontSize: '13px',
                    fontWeight: '300',
                    commandsBackground: 'transparent',
                    commandsBorder: 'none',
                    commandsBoxShadow: 'none',
                    commandMaxWidth: '80rem',
                    keyColor: '#ff3b30',
                    nameSpacing: '0.05em',
                    gridLayout: 'true',
                    letterSpacing: '0.03em',
                    keyFontSize: '1.1em',
                    keyWeight: '700',
                    nameAfterHeight: '0',
                    nameHoverColor: '#ff3b30'
                },
                dark: {
                    background: '#000000',
                    gradient: 'none',
                    text: '#ffffff',
                    textSubtle: '#999999',
                    accent: '#ff3b30',
                    hover: '#ff6651',
                    boxShadow: 'none',
                    borderRadius: '0',
                    borderWidth: '0',
                    fontFamily: '\"Helvetica Neue\", Arial, sans-serif',
                    fontSize: '13px',
                    fontWeight: '300',
                    commandsBackground: 'transparent',
                    commandsBorder: 'none',
                    commandsBoxShadow: 'none',
                    commandMaxWidth: '80rem',
                    keyColor: '#ff3b30',
                    nameSpacing: '0.05em',
                    gridLayout: 'true',
                    letterSpacing: '0.03em',
                    keyFontSize: '1.1em',
                    keyWeight: '700',
                    nameAfterHeight: '0',
                    nameHoverColor: '#ff3b30',
                    cornerTextTransform: 'uppercase',
                    cornerTextSpacing: '0.1em',
                    cornerTextWeight: '400',
                    cornerTextSize: '0.65rem'
                }
            },
            glass: {
                light: {
                    background: 'rgba(255, 255, 255, 0.7)',
                    gradient: 'linear-gradient(135deg, #f5f7fa, #c3cfe2)',
                    text: '#334155',
                    textSubtle: '#64748b',
                    accent: '#3b82f6',
                    hover: '#60a5fa',
                    boxShadow: '0 4px 20px rgba(0, 0, 0, 0.05)',
                    borderRadius: '16px',
                    commandsBackground: 'rgba(255, 255, 255, 0.6)',
                    commandsBorder: '1px solid rgba(255, 255, 255, 0.2)',
                    commandsBoxShadow: '0 8px 32px rgba(0, 0, 0, 0.07)',
                    fontFamily: '\"Inter\", -apple-system, BlinkMacSystemFont, sans-serif',
                    fontSize: '14px',
                    keyColor: '#3b82f6',
                    commandMaxWidth: '60rem',
                    backdropFilter: 'blur(10px)',
                    cornerTextStyle: 'text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.6rem; font-weight: 500;',
                    dotSize: '6px',
                    dotOpacity: '0.7',
                    nameAfterHeight: '2px'
                },
                dark: {
                    background: 'rgba(15, 23, 42, 0.7)',
                    gradient: 'linear-gradient(135deg, #0f172a, #1e293b)',
                    text: '#e2e8f0',
                    textSubtle: '#94a3b8',
                    accent: '#38bdf8',
                    hover: '#7dd3fc',
                    boxShadow: '0 4px 20px rgba(0, 0, 0, 0.2)',
                    borderRadius: '16px',
                    commandsBackground: 'rgba(30, 41, 59, 0.5)',
                    commandsBorder: '1px solid rgba(255, 255, 255, 0.1)',
                    commandsBoxShadow: '0 8px 32px rgba(0, 0, 0, 0.2)',
                    fontFamily: '\"Inter\", -apple-system, BlinkMacSystemFont, sans-serif',
                    fontSize: '14px',
                    keyColor: '#38bdf8',
                    commandMaxWidth: '60rem',
                    backdropFilter: 'blur(10px)',
                    cornerTextStyle: 'text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.6rem; font-weight: 500;',
                    dotSize: '6px',
                    dotOpacity: '0.7',
                    nameAfterHeight: '2px'
                }
            },
            ocean: {
                light: {
                    background: '#e0f7fa',
                    gradient: 'linear-gradient(135deg, #e0f7fa, #80deea 50%, #4dd0e1)',
                    text: '#006064',
                    textSubtle: '#0097a7',
                    accent: '#00838f',
                    hover: '#006064',
                    boxShadow: '0 4px 14px rgba(0, 131, 143, 0.15)',
                    borderRadius: '12px',
                    commandsBackground: 'rgba(224, 247, 250, 0.8)',
                    commandsBorder: '1px solid rgba(129, 212, 250, 0.4)',
                    commandsBoxShadow: '0 6px 24px rgba(0, 131, 143, 0.1)',
                    fontFamily: '\"Inter\", -apple-system, BlinkMacSystemFont, sans-serif',
                    fontSize: '14px',
                    keyColor: '#00acc1',
                    commandMaxWidth: '55rem',
                    backdropFilter: 'blur(8px)',
                    cornerTextStyle: 'font-style: italic; letter-spacing: 0.05em; font-size: 0.7rem;',
                    dotSize: '8px',
                    dotOpacity: '0.8',
                    nameAfterHeight: '2px',
                    nameFont: '500',
                    commandsColumns: '3',
                    inputBackground: 'rgba(224, 247, 250, 0.9)',
                    inputBorder: '1px solid rgba(129, 212, 250, 0.5)',
                    inputShadow: '0 2px 10px rgba(0, 131, 143, 0.1)',
                    uiAnimation: 'true',
                    cornerTextOpacity: '0.85'
                },
                dark: {
                    background: '#002f35',
                    gradient: 'linear-gradient(135deg, #002f35, #00363a 50%, #004d40)',
                    text: '#e0f7fa',
                    textSubtle: '#80deea',
                    accent: '#26c6da',
                    hover: '#4dd0e1',
                    boxShadow: '0 4px 14px rgba(0, 172, 193, 0.2)',
                    borderRadius: '12px',
                    commandsBackground: 'rgba(0, 59, 66, 0.7)',
                    commandsBorder: '1px solid rgba(38, 198, 218, 0.2)',
                    commandsBoxShadow: '0 6px 24px rgba(0, 172, 193, 0.15)',
                    fontFamily: '\"Inter\", -apple-system, BlinkMacSystemFont, sans-serif',
                    fontSize: '14px',
                    keyColor: '#26c6da',
                    commandMaxWidth: '55rem',
                    backdropFilter: 'blur(8px)',
                    cornerTextStyle: 'font-style: italic; letter-spacing: 0.05em; font-size: 0.7rem;',
                    dotSize: '8px',
                    dotOpacity: '0.8',
                    nameAfterHeight: '2px',
                    nameFont: '500',
                    commandsColumns: '3',
                    inputBackground: 'rgba(0, 59, 66, 0.8)',
                    inputBorder: '1px solid rgba(38, 198, 218, 0.3)',
                    inputShadow: '0 2px 10px rgba(0, 172, 193, 0.15)',
                    uiAnimation: 'true',
                    cornerTextOpacity: '0.85'
                }
            }
        };
        
        constructor() {
            super();
            this.attachShadow({ mode: 'open' });
            const template = document.getElementById('settings-widget-template');
            const clone = template.content.cloneNode(true);
            this.#panel = clone.querySelector('.settings-panel');
            this.shadowRoot.append(clone);
            
            // Get settings elements
            this.#newTabSetting = this.shadowRoot.querySelector('#new-tab-setting');
            this.#darkModeSetting = this.shadowRoot.querySelector('#dark-mode-setting');
            this.#themeSelect = this.shadowRoot.querySelector('#theme-select');
            
            // Get shortcut editor elements
            this.#shortcutEditor = this.shadowRoot.querySelector('#shortcut-editor');
            this.#shortcutForm = this.shadowRoot.querySelector('#shortcut-form');
            this.#shortcutKey = this.shadowRoot.querySelector('#shortcut-key');
            this.#shortcutName = this.shadowRoot.querySelector('#shortcut-name');
            this.#shortcutUrl = this.shadowRoot.querySelector('#shortcut-url');
            this.#shortcutDelete = this.shadowRoot.querySelector('#shortcut-delete');
            this.#shortcutCancel = this.shadowRoot.querySelector('#shortcut-cancel');
            this.#shortcutSave = this.shadowRoot.querySelector('#shortcut-save');
            this.#newShortcut = this.shadowRoot.querySelector('#new-shortcut');
            
            // Get share settings elements
            this.#exportButton = this.shadowRoot.querySelector('#export-settings');
            this.#importButton = this.shadowRoot.querySelector('#import-settings');
            this.#shareData = this.shadowRoot.querySelector('#share-data');
            this.#shareMessage = this.shadowRoot.querySelector('#share-message');
            
            // Initialize settings from the existing CONFIG
            this.#newTabSetting.checked = CONFIG.openLinksInNewTab;
            
            // Try to load user settings from localStorage
            this.#loadSettings();
            
            // Add event listeners
            this.#newTabSetting.addEventListener('change', this.#onNewTabChange);
            this.#darkModeSetting.addEventListener('change', this.#onDarkModeChange);
            this.#themeSelect.addEventListener('change', this.#onThemeChange);
            
            // Add shortcut editor event listeners
            this.#shortcutForm.addEventListener('submit', this.#onShortcutSave);
            this.#shortcutCancel.addEventListener('click', this.#onShortcutCancel);
            this.#shortcutDelete.addEventListener('click', this.#onShortcutDelete);
            this.#newShortcut.addEventListener('click', this.#onNewShortcut);
            
            // Add share settings event listeners
            this.#exportButton.addEventListener('click', this.#onExportSettings);
            this.#importButton.addEventListener('click', this.#onImportSettings);
            
            // Close panel when clicking outside
            document.addEventListener('click', this.#onDocumentClick);
        }
        
        toggle() {
            this.#panel.classList.toggle('open');
            
            // Toggle editable class on commands container
            const commandsEl = document.querySelector('commands-component');
            if (commandsEl && commandsEl.shadowRoot) {
                const commandsMenu = commandsEl.shadowRoot.querySelector('.commands');
                if (commandsMenu) {
                    if (this.#panel.classList.contains('open')) {
                        commandsMenu.classList.add('editable');
                    } else {
                        commandsMenu.classList.remove('editable');
                    }
                }
            }
            
            // Hide shortcut editor when toggling panel
            this.#shortcutEditor.classList.remove('active');
            this.#editingKey = null;
        }
        
        // Method to edit a shortcut - called from Commands component
        editShortcut(key) {
            console.log('SettingsWidget.editShortcut called with key:', key);
            
            if (!COMMANDS.has(key)) {
                console.error(`Command with key "${key}" not found`);
                return;
            }
            
            const command = COMMANDS.get(key);
            
            // Update form fields
            this.#shortcutKey.value = key;
            this.#shortcutName.value = command.name || '';
            this.#shortcutUrl.value = command.url || '';
            
            // Store the key being edited
            this.#editingKey = key;
            
            // Show the delete button for existing shortcuts
            this.#shortcutDelete.style.visibility = 'visible';
            
            // Show the editor
            this.#shortcutEditor.classList.add('active');
        }
        
        #onShortcutSave = (e) => {
            e.preventDefault();
            
            const key = this.#shortcutKey.value.trim();
            const name = this.#shortcutName.value.trim();
            const url = this.#shortcutUrl.value.trim();
            
            // Validate inputs
            if (!key || !name || !url) {
                alert('All fields are required.');
                return;
            }
            
            // Ensure key is a single character
            if (key.length !== 1) {
                alert('Key must be a single character.');
                return;
            }
            
            // If we're changing the key, check if it's already in use
            if (key !== this.#editingKey && COMMANDS.has(key)) {
                alert(`Key "${key}" is already in use. Please choose another.`);
                return;
            }
            
            // Create or update the command
            const command = {
                name,
                url
            };
            
            // If we're changing the key, remove the old entry
            if (this.#editingKey && this.#editingKey !== key) {
                COMMANDS.delete(this.#editingKey);
            }
            
            // Set the new command
            COMMANDS.set(key, command);
            
            // Save commands to localStorage
            this.#saveCommands();
            
            // Update the UI
            document.querySelector('commands-component').initialize();
            
            // Hide the editor
            this.#shortcutEditor.classList.remove('active');
            this.#editingKey = null;
        };
        
        #onShortcutCancel = () => {
            // Hide the editor
            this.#shortcutEditor.classList.remove('active');
            this.#editingKey = null;
        };
        
        #onShortcutDelete = () => {
            if (!this.#editingKey || !COMMANDS.has(this.#editingKey)) {
                return;
            }
            
            if (confirm(`Delete the shortcut "${this.#editingKey}" - ${COMMANDS.get(this.#editingKey).name}?`)) {
                // Remove the command
                COMMANDS.delete(this.#editingKey);
                
                // Save commands to localStorage
                this.#saveCommands();
                
                // Update the UI
                document.querySelector('commands-component').initialize();
                
                // Hide the editor
                this.#shortcutEditor.classList.remove('active');
                this.#editingKey = null;
            }
        };
        
        #onNewShortcut = () => {
            // Reset form fields for a new shortcut
            this.#shortcutKey.value = '';
            this.#shortcutName.value = '';
            this.#shortcutUrl.value = '';
            
            // Clear the editing key
            this.#editingKey = null;
            
            // Hide the delete button for new shortcuts
            this.#shortcutDelete.style.visibility = 'hidden';
            
            // Show the editor
            this.#shortcutEditor.classList.add('active');
        };
        
        #saveCommands() {
            try {
                // Convert Map to array of [key, value] pairs then to object
                const commandsArray = Array.from(COMMANDS.entries());
                localStorage.setItem('homeCommands', JSON.stringify(commandsArray));
            } catch (e) {
                console.error('Error saving commands:', e);
            }
        }
        
        #saveSettings() {
            try {
                const settings = {
                    openLinksInNewTab: this.#newTabSetting.checked,
                    darkMode: this.#darkModeSetting.checked,
                    theme: this.#currentTheme
                };
                localStorage.setItem('homeSettings', JSON.stringify(settings));
            } catch (e) {
                console.error('Error saving settings:', e);
            }
        }
        
        #loadSettings() {
            try {
                // Try to load settings from localStorage
                const savedSettings = localStorage.getItem('homeSettings');
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    
                    // Apply saved settings
                    this.#newTabSetting.checked = settings.openLinksInNewTab || false;
                    this.#darkModeSetting.checked = settings.darkMode || false;
                    this.#themeSelect.value = settings.theme || 'default';
                    this.#currentTheme = settings.theme || 'default';
                    
                    // Apply theme and mode
                    this.#applyTheme(this.#currentTheme, this.#darkModeSetting.checked);
                    
                    // Update CONFIG
                    CONFIG.openLinksInNewTab = this.#newTabSetting.checked;
                }
            } catch (e) {
                console.error('Error loading settings:', e);
            }
        }
        
        #onNewTabChange = (e) => {
            CONFIG.openLinksInNewTab = e.target.checked;
            // Re-initialize commands component to apply setting
            document.querySelector('commands-component').initialize();
            this.#saveSettings();
        };
        
        #onDarkModeChange = (e) => {
            this.#applyTheme(this.#currentTheme, e.target.checked);
            this.#saveSettings();
        };
        
        #onThemeChange = (e) => {
            this.#currentTheme = e.target.value;
            this.#applyTheme(this.#currentTheme, this.#darkModeSetting.checked);
            this.#saveSettings();
        };
        
        #applyTheme(themeName, isDark) {
            const theme = this.#themes[themeName] || this.#themes.default;
            const colors = isDark ? theme.dark : theme.light;
            
            // Store current theme in document for Commands component to access on initialization
            document.documentElement.dataset.theme = themeName;
            document.documentElement.dataset.darkMode = isDark;
            
            document.documentElement.style.setProperty('--color-background', colors.background);
            document.documentElement.style.setProperty('--color-text', colors.text);
            document.documentElement.style.setProperty('--color-text-subtle', colors.textSubtle);
            document.documentElement.style.setProperty('--color-accent', colors.accent);
            document.documentElement.style.setProperty('--color-hover', colors.hover);
            document.documentElement.style.setProperty('--box-shadow', colors.boxShadow);
            
            // Apply gradient
            if (colors.gradient && colors.gradient !== 'none') {
                document.documentElement.style.backgroundImage = colors.gradient;
            } else {
                document.documentElement.style.backgroundImage = 'none';
            }
            
            // Call separate method for commands component styling to avoid code duplication
            this.#applyThemeToCommandsComponent(themeName, isDark);
            
            // Handle special minimal theme properties
            if (themeName === 'minimal') {
                // Adjust border radius
                document.documentElement.style.setProperty('--border-radius', colors.borderRadius || '8px');
                
                // Adjust font
                if (colors.fontFamily) {
                    document.documentElement.style.fontFamily = colors.fontFamily;
                }
                
                if (colors.fontSize) {
                    document.documentElement.style.fontSize = colors.fontSize;
                }
                
                // Modify commands component style
                const commandsEl = document.querySelector('commands-component');
                if (commandsEl && commandsEl.shadowRoot) {
                    const commandsMenu = commandsEl.shadowRoot.querySelector('.commands');
                    if (commandsMenu) {
                        commandsMenu.style.backgroundColor = colors.commandsBackground || '';
                        commandsMenu.style.border = colors.commandsBorder || '';
                        commandsMenu.style.boxShadow = colors.commandsBoxShadow || '';
                        commandsMenu.style.maxWidth = colors.commandMaxWidth || '';
                        
                        // Update key colors
                        const keys = commandsEl.shadowRoot.querySelectorAll('.key');
                        keys.forEach(key => {
                            key.style.color = colors.keyColor || '';
                        });
                    }
                }
                
                // Hide corner texts for minimal theme
                const cornerTexts = document.querySelectorAll('.corner-text');
                cornerTexts.forEach(el => {
                    el.style.opacity = '0';
                });
                
                // Make dot smaller and more subtle
                const dot = document.querySelector('.settings-dot');
                if (dot) {
                    dot.style.width = '3px';
                    dot.style.height = '3px';
                    dot.style.opacity = '0.3';
                }
            } else if (themeName === 'glass') {
                // Apply glass theme properties
                document.documentElement.style.setProperty('--border-radius', colors.borderRadius || '16px');
                
                // Apply backdrop filter to html
                document.documentElement.style.backdropFilter = colors.backdropFilter || 'blur(10px)';
                
                // Set font properties
                if (colors.fontFamily) {
                    document.documentElement.style.fontFamily = colors.fontFamily;
                }
                
                if (colors.fontSize) {
                    document.documentElement.style.fontSize = colors.fontSize;
                }
                
                // Modify commands component style to be glassy
                const commandsEl = document.querySelector('commands-component');
                if (commandsEl && commandsEl.shadowRoot) {
                    const commandsMenu = commandsEl.shadowRoot.querySelector('.commands');
                    if (commandsMenu) {
                        commandsMenu.style.backgroundColor = colors.commandsBackground || '';
                        commandsMenu.style.border = colors.commandsBorder || '';
                        commandsMenu.style.boxShadow = colors.commandsBoxShadow || '';
                        commandsMenu.style.backdropFilter = colors.backdropFilter || '';
                        commandsMenu.style.maxWidth = colors.commandMaxWidth || '';
                        
                        // Update key colors and make them more prominent
                        const keys = commandsEl.shadowRoot.querySelectorAll('.key');
                        keys.forEach(key => {
                            key.style.color = colors.keyColor || '';
                            key.style.opacity = '1';
                            key.style.fontWeight = '600';
                        });

                        // Update name underline style
                        const names = commandsEl.shadowRoot.querySelectorAll('.name');
                        names.forEach(name => {
                            const after = name.querySelector('::after') || name;
                            name.style.letterSpacing = '0.02em';
                            if (colors.nameAfterHeight) {
                                const style = document.createElement('style');
                                style.textContent = `.name::after { height: ${colors.nameAfterHeight} !important; }`;
                                commandsEl.shadowRoot.appendChild(style);
                            }
                        });
                    }
                }
                
                // Style corner texts for glass theme
                const cornerTexts = document.querySelectorAll('.corner-text');
                cornerTexts.forEach(el => {
                    el.style.cssText = colors.cornerTextStyle || '';
                    el.style.opacity = '0.8';
                });
                
                // Style the settings dot
                const dot = document.querySelector('.settings-dot');
                if (dot) {
                    dot.style.width = colors.dotSize || '6px';
                    dot.style.height = colors.dotSize || '6px';
                    dot.style.opacity = colors.dotOpacity || '0.7';
                    dot.style.backgroundColor = colors.accent;
                    dot.style.boxShadow = '0 0 10px ' + colors.accent;
                }
                
                // Update settings panel to glass style
                const settingsEl = document.querySelector('settings-widget');
                if (settingsEl && settingsEl.shadowRoot) {
                    const panel = settingsEl.shadowRoot.querySelector('.settings-panel');
                    if (panel) {
                        panel.style.backgroundColor = colors.commandsBackground;
                        panel.style.backdropFilter = colors.backdropFilter;
                        panel.style.border = colors.commandsBorder;
                        panel.style.boxShadow = colors.commandsBoxShadow;
                        panel.style.borderRadius = colors.borderRadius;
                    }
                }
                
                // Apply search component styles
                const searchEl = document.querySelector('search-component');
                if (searchEl && searchEl.shadowRoot) {
                    const dialog = searchEl.shadowRoot.querySelector('.dialog');
                    const input = searchEl.shadowRoot.querySelector('.input');
                    if (dialog && input) {
                        dialog.style.backdropFilter = colors.backdropFilter;
                        input.style.backdropFilter = colors.backdropFilter;
                        input.style.backgroundColor = colors.commandsBackground;
                        input.style.border = colors.commandsBorder;
                        input.style.boxShadow = colors.commandsBoxShadow;
                    }
                }
            } else if (themeName === 'ocean') {
                // Apply Ocean theme properties
                document.documentElement.style.setProperty('--border-radius', colors.borderRadius || '12px');
                
                // Apply backdrop filter to html
                document.documentElement.style.backdropFilter = colors.backdropFilter || 'blur(8px)';
                
                // Set font properties
                if (colors.fontFamily) {
                    document.documentElement.style.fontFamily = colors.fontFamily;
                }
                
                if (colors.fontSize) {
                    document.documentElement.style.fontSize = colors.fontSize;
                }
                
                // Modify commands component style for Ocean theme
                const commandsEl = document.querySelector('commands-component');
                if (commandsEl && commandsEl.shadowRoot) {
                    const commandsMenu = commandsEl.shadowRoot.querySelector('.commands');
                    if (commandsMenu) {
                        commandsMenu.style.backgroundColor = colors.commandsBackground || '';
                        commandsMenu.style.border = colors.commandsBorder || '';
                        commandsMenu.style.boxShadow = colors.commandsBoxShadow || '';
                        commandsMenu.style.backdropFilter = colors.backdropFilter || '';
                        commandsMenu.style.maxWidth = colors.commandMaxWidth || '';
                        
                        // Set columns for the commands menu if specified
                        if (colors.commandsColumns) {
                            const style = document.createElement('style');
                            style.textContent = `
                                @media (min-width: 500px) {
                                    .commands {
                                        columns: ${colors.commandsColumns} !important;
                                    }
                                }
                            `;
                            commandsEl.shadowRoot.appendChild(style);
                        }
                        
                        // Update key colors with Ocean theme styling
                        const keys = commandsEl.shadowRoot.querySelectorAll('.key');
                        keys.forEach(key => {
                            key.style.color = colors.keyColor || '';
                            key.style.opacity = '1';
                            key.style.fontWeight = '600';
                        });

                        // Update name styles with Ocean theme styling
                        const names = commandsEl.shadowRoot.querySelectorAll('.name');
                        names.forEach(name => {
                            name.style.letterSpacing = '0.03em';
                            name.style.fontWeight = colors.nameFont || '400';
                            
                            if (colors.nameAfterHeight) {
                                const style = document.createElement('style');
                                style.textContent = `.name::after { 
                                    height: ${colors.nameAfterHeight} !important; 
                                    background-color: ${colors.accent} !important;
                                }`;
                                commandsEl.shadowRoot.appendChild(style);
                            }
                        });
                        
                        // Add subtle animation if enabled
                        if (colors.uiAnimation === 'true') {
                            const style = document.createElement('style');
                            style.textContent = `
                                .command {
                                    transition: transform 0.3s ease, box-shadow 0.3s ease !important;
                                }
                                .command:hover {
                                    transform: translateY(-2px) !important;
                                    box-shadow: 0 4px 12px rgba(0, 131, 143, 0.15) !important;
                                }
                            `;
                            commandsEl.shadowRoot.appendChild(style);
                        }
                    }
                }
                
                // Style corner texts for Ocean theme
                const cornerTexts = document.querySelectorAll('.corner-text');
                cornerTexts.forEach(el => {
                    el.style.cssText = colors.cornerTextStyle || '';
                    el.style.opacity = colors.cornerTextOpacity || '0.85';
                });
                
                // Style the settings dot for Ocean theme
                const dot = document.querySelector('.settings-dot');
                if (dot) {
                    dot.style.width = colors.dotSize || '8px';
                    dot.style.height = colors.dotSize || '8px';
                    dot.style.opacity = colors.dotOpacity || '0.8';
                    dot.style.backgroundColor = colors.accent;
                    dot.style.boxShadow = '0 0 12px ' + colors.accent;
                    
                    // Add pulse animation to the dot
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes pulse {
                            0% { transform: translateX(-50%) scale(1); }
                            50% { transform: translateX(-50%) scale(1.2); }
                            100% { transform: translateX(-50%) scale(1); }
                        }
                        .settings-dot:hover {
                            animation: pulse 1.5s infinite ease-in-out;
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                // Update settings panel for Ocean theme
                const settingsEl = document.querySelector('settings-widget');
                if (settingsEl && settingsEl.shadowRoot) {
                    const panel = settingsEl.shadowRoot.querySelector('.settings-panel');
                    if (panel) {
                        panel.style.backgroundColor = colors.commandsBackground;
                        panel.style.backdropFilter = colors.backdropFilter;
                        panel.style.border = colors.commandsBorder;
                        panel.style.boxShadow = colors.commandsBoxShadow;
                        panel.style.borderRadius = colors.borderRadius;
                    }
                }
                
                // Apply search component styles for Ocean theme
                const searchEl = document.querySelector('search-component');
                if (searchEl && searchEl.shadowRoot) {
                    const dialog = searchEl.shadowRoot.querySelector('.dialog');
                    const input = searchEl.shadowRoot.querySelector('.input');
                    const suggestions = searchEl.shadowRoot.querySelector('.suggestions');
                    
                    if (dialog && input) {
                        dialog.style.backdropFilter = colors.backdropFilter;
                        input.style.backgroundColor = colors.inputBackground || colors.commandsBackground;
                        input.style.border = colors.inputBorder || colors.commandsBorder;
                        input.style.boxShadow = colors.inputShadow || colors.commandsBoxShadow;
                        input.style.borderRadius = colors.borderRadius;
                        
                        // Style the suggestions for Ocean theme
                        if (suggestions) {
                            const style = document.createElement('style');
                            style.textContent = `
                                .suggestion::before {
                                    background-color: ${colors.accent} !important;
                                }
                            `;
                            searchEl.shadowRoot.appendChild(style);
                        }
                    }
                }
            } else if (themeName === 'swiss') {
                // Apply Swiss theme properties - minimal, typography focused, red accent
                document.documentElement.style.setProperty('--border-radius', colors.borderRadius || '0');
                
                // Set font properties
                if (colors.fontFamily) {
                    document.documentElement.style.fontFamily = colors.fontFamily;
                }
                
                if (colors.fontSize) {
                    document.documentElement.style.fontSize = colors.fontSize;
                }
                
                if (colors.fontWeight) {
                    document.documentElement.style.fontWeight = colors.fontWeight;
                }
                
                if (colors.letterSpacing) {
                    document.documentElement.style.letterSpacing = colors.letterSpacing;
                }
                
                // Modify commands component style for Swiss theme
                const commandsEl = document.querySelector('commands-component');
                if (commandsEl && commandsEl.shadowRoot) {
                    const commandsMenu = commandsEl.shadowRoot.querySelector('.commands');
                    if (commandsMenu) {
                        commandsMenu.style.backgroundColor = 'transparent';
                        commandsMenu.style.border = 'none';
                        commandsMenu.style.boxShadow = 'none';
                        commandsMenu.style.maxWidth = colors.commandMaxWidth || '80rem';
                        commandsMenu.style.paddingTop = '3rem';
                        
                        // Set grid layout if specified
                        if (colors.gridLayout === 'true') {
                            // Create grid layout style
                            const gridStyle = document.createElement('style');
                            gridStyle.className = 'swiss-grid-style';
                            gridStyle.textContent = `
                                .commands {
                                    display: grid !important;
                                    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)) !important;
                                    grid-gap: 1.5rem !important;
                                    columns: unset !important;
                                    padding: 1.5rem !important;
                                    justify-content: center !important;
                                    align-items: start !important;
                                    width: auto !important;
                                    max-width: 42rem !important;
                                    margin: 0 auto !important;
                                }
                                
                                .command {
                                    display: flex !important;
                                    flex-direction: column !important;
                                    align-items: flex-start !important;
                                    gap: 0.5rem !important;
                                    border-left: 2px solid transparent !important;
                                    padding-left: 0.5rem !important;
                                    transition: all 0.2s ease !important;
                                    margin-bottom: 0.5rem !important;
                                }
                                
                                .command:hover {
                                    border-left-color: ${colors.accent} !important;
                                }
                                
                                @media (max-width: 768px) {
                                    .commands {
                                        grid-template-columns: repeat(3, minmax(100px, 1fr)) !important;
                                        grid-gap: 1rem !important;
                                        padding: 1rem !important;
                                        max-width: 32rem !important;
                                    }
                                    
                                    .command {
                                        margin-bottom: 0.25rem !important;
                                    }
                                }
                                
                                @media (max-width: 480px) {
                                    .commands {
                                        grid-template-columns: repeat(2, minmax(90px, 1fr)) !important;
                                        max-width: 22rem !important;
                                        padding: 0.8rem !important;
                                    }
                                }
                            `;
                            commandsEl.shadowRoot.appendChild(gridStyle);
                        }
                        
                        // Update key styling with Swiss typography principles
                        const keys = commandsEl.shadowRoot.querySelectorAll('.key');
                        keys.forEach(key => {
                            key.style.color = colors.keyColor || '#ff3b30';
                            key.style.opacity = '1';
                            key.style.fontWeight = colors.keyWeight || '700';
                            key.style.fontSize = colors.keyFontSize || '1.1em';
                            key.style.width = 'auto';
                            key.style.textAlign = 'left';
                        });

                        // Update name styles with Swiss typography
                        const names = commandsEl.shadowRoot.querySelectorAll('.name');
                        names.forEach(name => {
                            name.style.letterSpacing = colors.nameSpacing || '0.05em';
                            name.style.textTransform = 'uppercase';
                            name.style.fontSize = '0.8em';
                            name.style.opacity = '0.9';
                        });
                        
                        // Add Swiss-specific hover effect and responsive styles
                        const nameHoverStyle = document.createElement('style');
                        nameHoverStyle.className = 'swiss-name-hover-style';
                        nameHoverStyle.textContent = `
                            .command:hover .name {
                                color: ${colors.nameHoverColor || colors.accent} !important;
                            }
                            
                            .name::after {
                                display: none !important;
                            }
                            
                            @media (max-width: 768px) {
                                .key {
                                    font-size: 1em !important;
                                }
                                
                                .name {
                                    font-size: 0.75em !important;
                                }
                            }
                            
                            @media (max-width: 480px) {
                                .key {
                                    font-size: 0.9em !important;
                                }
                                
                                .name {
                                    font-size: 0.7em !important;
                                    letter-spacing: 0.03em !important;
                                }
                            }
                        `;
                        commandsEl.shadowRoot.appendChild(nameHoverStyle);
                    }
                }
                
                // Style corner texts for Swiss theme
                const cornerTexts = document.querySelectorAll('.corner-text');
                cornerTexts.forEach(el => {
                    el.style.textTransform = colors.cornerTextTransform || 'uppercase';
                    el.style.letterSpacing = colors.cornerTextSpacing || '0.1em';
                    el.style.fontWeight = colors.cornerTextWeight || '400';
                    el.style.fontSize = colors.cornerTextSize || '0.65rem';
                    el.style.opacity = '0.8';
                });
                
                // Additional responsive style for corner texts
                const cornerTextStyle = document.createElement('style');
                cornerTextStyle.textContent = `
                    @media (max-width: 768px) {
                        .corner-text {
                            padding: 1rem !important;
                            max-width: 150px !important;
                        }
                        
                        .top-left, .top-right, .bottom-left, .bottom-right {
                            font-size: 0.6rem !important;
                        }
                    }
                    
                    @media (max-width: 480px) {
                        .top-left, .bottom-right {
                            display: none !important;
                        }
                        
                        .top-right, .bottom-left {
                            padding: 0.75rem !important;
                            font-size: 0.55rem !important;
                        }
                    }
                `;
                document.head.appendChild(cornerTextStyle);
                
                // Style the settings dot
                const dot = document.querySelector('.settings-dot');
                if (dot) {
                    dot.style.width = '4px';
                    dot.style.height = '4px';
                    dot.style.opacity = '0.7';
                    dot.style.backgroundColor = colors.accent;
                    dot.style.boxShadow = 'none';
                }
                
                // Update settings panel with Swiss theme
                const settingsEl = document.querySelector('settings-widget');
                if (settingsEl && settingsEl.shadowRoot) {
                    const panel = settingsEl.shadowRoot.querySelector('.settings-panel');
                    if (panel) {
                        panel.style.backgroundColor = isDark ? 'rgba(20, 20, 20, 0.95)' : 'rgba(255, 255, 255, 0.95)';
                        panel.style.backdropFilter = 'blur(0)';
                        panel.style.border = 'none';
                        panel.style.boxShadow = 'none';
                        panel.style.borderRadius = '0';
                        panel.style.borderLeft = `2px solid ${colors.accent}`;
                        
                        // Add responsive settings for smaller screens
                        const responsiveSettingsStyle = document.createElement('style');
                        responsiveSettingsStyle.textContent = `
                            @media (max-width: 480px) {
                                .settings-panel {
                                    width: 240px !important;
                                    max-width: 90vw !important;
                                    font-size: 0.9em !important;
                                }
                                
                                .settings-option-label {
                                    font-size: 0.7rem !important;
                                }
                                
                                .settings-select {
                                    width: 100px !important;
                                    font-size: 0.7rem !important;
                                }
                                
                                .share-button {
                                    padding: 4px 8px !important;
                                    font-size: 0.65rem !important;
                                }
                                
                                .shortcut-form-input {
                                    padding: 4px 6px !important;
                                }
                            }
                        `;
                        settingsEl.shadowRoot.appendChild(responsiveSettingsStyle);
                    }
                    
                    // Style buttons in the Swiss theme
                    const buttons = settingsEl.shadowRoot.querySelectorAll('button');
                    buttons.forEach(button => {
                        if (button.classList.contains('primary') || button.classList.contains('import')) {
                            button.style.backgroundColor = colors.accent;
                            button.style.borderRadius = '0';
                        } else {
                            button.style.borderRadius = '0';
                        }
                    });
                }
                
                // Apply search component styles for Swiss theme
                const searchEl = document.querySelector('search-component');
                if (searchEl && searchEl.shadowRoot) {
                    const dialog = searchEl.shadowRoot.querySelector('.dialog');
                    const input = searchEl.shadowRoot.querySelector('.input');
                    
                    if (dialog && input) {
                        dialog.style.backdropFilter = 'none';
                        input.style.backgroundColor = 'transparent';
                        input.style.border = 'none';
                        input.style.borderBottom = `1px solid ${colors.accent}`;
                        input.style.borderRadius = '0';
                        input.style.boxShadow = 'none';
                        input.style.fontFamily = colors.fontFamily;
                        input.style.letterSpacing = colors.letterSpacing;
                        
                        // Add responsive styles for search
                        const responsiveSearchStyle = document.createElement('style');
                        responsiveSearchStyle.className = 'swiss-search-style';
                        responsiveSearchStyle.textContent = `
                            .input {
                                width: 90% !important;
                                max-width: 400px !important;
                                margin: 0 auto !important;
                            }
                            
                            @media (max-width: 480px) {
                                .input {
                                    font-size: 1rem !important;
                                    padding: 0.4rem 0.8rem !important;
                                }
                                
                                .suggestion {
                                    font-size: 0.8rem !important;
                                    padding: 0.4rem !important;
                                }
                            }
                            
                            .suggestion::before {
                                background-color: ${colors.accent} !important;
                                border-radius: 0 !important;
                            }
                        `;
                        searchEl.shadowRoot.appendChild(responsiveSearchStyle);
                    }
                }
            } else {
                // Reset to default styles for other themes
                document.documentElement.style.setProperty('--border-radius', '8px');
                document.documentElement.style.fontFamily = 'var(--font-family)';
                document.documentElement.style.fontSize = 'var(--font-size)';
                document.documentElement.style.backdropFilter = 'none';
                
                // Reset commands component style
                const commandsEl = document.querySelector('commands-component');
                if (commandsEl && commandsEl.shadowRoot) {
                    const commandsMenu = commandsEl.shadowRoot.querySelector('.commands');
                    if (commandsMenu) {
                        commandsMenu.style.backgroundColor = 'rgba(255, 255, 255, 0.7)';
                        commandsMenu.style.border = '1px solid rgba(0, 0, 0, 0.02)';
                        commandsMenu.style.boxShadow = 'var(--box-shadow)';
                        commandsMenu.style.backdropFilter = '';
                        commandsMenu.style.maxWidth = '';
                        
                        // Reset key colors
                        const keys = commandsEl.shadowRoot.querySelectorAll('.key');
                        keys.forEach(key => {
                            key.style.color = '';
                            key.style.opacity = '';
                            key.style.fontWeight = '';
                        });
                        
                        // Reset name styles
                        const names = commandsEl.shadowRoot.querySelectorAll('.name');
                        names.forEach(name => {
                            name.style.letterSpacing = '';
                        });
                    }
                }
                
                // Show corner texts for other themes
                const cornerTexts = document.querySelectorAll('.corner-text');
                cornerTexts.forEach(el => {
                    el.style.cssText = '';
                    el.style.opacity = '';
                });
                
                // Reset dot size
                const dot = document.querySelector('.settings-dot');
                if (dot) {
                    dot.style.width = '5px';
                    dot.style.height = '5px';
                    dot.style.opacity = '0.5';
                    dot.style.backgroundColor = '';
                    dot.style.boxShadow = '';
                }
                
                // Reset settings panel
                const settingsEl = document.querySelector('settings-widget');
                if (settingsEl && settingsEl.shadowRoot) {
                    const panel = settingsEl.shadowRoot.querySelector('.settings-panel');
                    if (panel) {
                        panel.style.backgroundColor = '';
                        panel.style.backdropFilter = '';
                        panel.style.border = '';
                        panel.style.boxShadow = '';
                        panel.style.borderRadius = '';
                    }
                }
                
                // Reset search component styles
                const searchEl = document.querySelector('search-component');
                if (searchEl && searchEl.shadowRoot) {
                    const dialog = searchEl.shadowRoot.querySelector('.dialog');
                    const input = searchEl.shadowRoot.querySelector('.input');
                    if (dialog && input) {
                        dialog.style.backdropFilter = '';
                        input.style.backdropFilter = '';
                        input.style.backgroundColor = '';
                        input.style.border = '';
                        input.style.boxShadow = '';
                    }
                }
            }
            
            // Remove any theme-specific styles
            const allCommandsEl = document.querySelector('commands-component');
            if (allCommandsEl && allCommandsEl.shadowRoot) {
                const commandsMenu = allCommandsEl.shadowRoot.querySelector('.commands');
                if (commandsMenu) {
                    // Remove any theme-specific styles that aren't needed for the current theme
                    const themeStyles = allCommandsEl.shadowRoot.querySelectorAll('.ocean-columns-style, .ocean-name-style, .ocean-animation-style, .swiss-grid-style, .swiss-name-hover-style, .swiss-search-style');
                    themeStyles.forEach(style => {
                        // Only remove styles not relevant to current theme
                        if ((themeName !== 'ocean' && style.className.includes('ocean')) || 
                            (themeName !== 'swiss' && style.className.includes('swiss'))) {
                            style.remove();
                        }
                    });
                
                    // If settings panel is open, make sure the editable class is added
                    if (this.#panel.classList.contains('open')) {
                        commandsMenu.classList.add('editable');
                    } else {
                        commandsMenu.classList.remove('editable');
                    }
                }
            }
        }
        
        // Method to synchronize theme settings with the commands component
        synchronizeCommands() {
            // Apply current theme to commands component
            const commandsEl = document.querySelector('commands-component');
            if (commandsEl && commandsEl.shadowRoot) {
                this.#applyThemeToCommandsComponent(this.#currentTheme, this.#darkModeSetting.checked);
            }
        }
        
        #onDocumentClick = (e) => {
            // Don't close if clicking inside the settings panel or the dot
            if (e.target.closest('.settings-dot') || e.target.closest('settings-widget')) {
                return;
            }
            this.#panel.classList.remove('open');
        };
        
        // Helper method to apply theme specifically to commands component
        #applyThemeToCommandsComponent(themeName, isDark) {
            const theme = this.#themes[themeName] || this.#themes.default;
            const colors = isDark ? theme.dark : theme.light;
            
            // Get commands component
            const commandsEl = document.querySelector('commands-component');
            if (!commandsEl || !commandsEl.shadowRoot) return;
            
            const commandsMenu = commandsEl.shadowRoot.querySelector('.commands');
            if (!commandsMenu) return;
            
            if (themeName === 'minimal') {
                // Apply minimal theme to commands
                commandsMenu.style.backgroundColor = 'transparent';
                commandsMenu.style.border = 'none';
                commandsMenu.style.boxShadow = 'none';
                commandsMenu.style.maxWidth = '70rem';
                
                // Update key colors with minimal theme styling
                const keys = commandsEl.shadowRoot.querySelectorAll('.key');
                keys.forEach(key => {
                    key.style.color = colors.keyColor || '#666666';
                });
            } else if (themeName === 'ocean') {
                // Apply Ocean theme to commands
                commandsMenu.style.backgroundColor = colors.commandsBackground || '';
                commandsMenu.style.border = colors.commandsBorder || '';
                commandsMenu.style.boxShadow = colors.commandsBoxShadow || '';
                commandsMenu.style.backdropFilter = colors.backdropFilter || '';
                commandsMenu.style.maxWidth = colors.commandMaxWidth || '';
                
                // Update key colors with Ocean theme styling
                const keys = commandsEl.shadowRoot.querySelectorAll('.key');
                keys.forEach(key => {
                    key.style.color = colors.keyColor || '';
                    key.style.opacity = '1';
                    key.style.fontWeight = '600';
                });

                // Update name styles with Ocean theme styling
                const names = commandsEl.shadowRoot.querySelectorAll('.name');
                names.forEach(name => {
                    name.style.letterSpacing = '0.03em';
                    name.style.fontWeight = colors.nameFont || '400';
                });
                
                // Set columns for the commands menu if specified
                if (colors.commandsColumns) {
                    // Check if style already exists
                    let style = commandsEl.shadowRoot.querySelector('.ocean-columns-style');
                    if (!style) {
                        style = document.createElement('style');
                        style.className = 'ocean-columns-style';
                        style.textContent = `
                            @media (min-width: 500px) {
                                .commands {
                                    columns: ${colors.commandsColumns} !important;
                                }
                            }
                        `;
                        commandsEl.shadowRoot.appendChild(style);
                    }
                }
                
                // Add nameAfter style if needed
                if (colors.nameAfterHeight) {
                    let nameStyle = commandsEl.shadowRoot.querySelector('.ocean-name-style');
                    if (!nameStyle) {
                        nameStyle = document.createElement('style');
                        nameStyle.className = 'ocean-name-style';
                        nameStyle.textContent = `.name::after { 
                            height: ${colors.nameAfterHeight} !important; 
                            background-color: ${colors.accent} !important;
                        }`;
                        commandsEl.shadowRoot.appendChild(nameStyle);
                    }
                }
                
                // Add animations if enabled
                if (colors.uiAnimation === 'true') {
                    let animStyle = commandsEl.shadowRoot.querySelector('.ocean-animation-style');
                    if (!animStyle) {
                        animStyle = document.createElement('style');
                        animStyle.className = 'ocean-animation-style';
                        animStyle.textContent = `
                            .command {
                                transition: transform 0.3s ease, box-shadow 0.3s ease !important;
                            }
                            .command:hover {
                                transform: translateY(-2px) !important;
                                box-shadow: 0 4px 12px rgba(0, 131, 143, 0.15) !important;
                            }
                        `;
                        commandsEl.shadowRoot.appendChild(animStyle);
                    }
                }
            } else if (themeName === 'swiss') {
                // Apply Swiss theme properties - minimal, typography focused, red accent
                document.documentElement.style.setProperty('--border-radius', colors.borderRadius || '0');
                
                // Set font properties
                if (colors.fontFamily) {
                    document.documentElement.style.fontFamily = colors.fontFamily;
                }
                
                if (colors.fontSize) {
                    document.documentElement.style.fontSize = colors.fontSize;
                }
                
                if (colors.fontWeight) {
                    document.documentElement.style.fontWeight = colors.fontWeight;
                }
                
                if (colors.letterSpacing) {
                    document.documentElement.style.letterSpacing = colors.letterSpacing;
                }
                
                // Modify commands component style for Swiss theme
                const commandsEl = document.querySelector('commands-component');
                if (commandsEl && commandsEl.shadowRoot) {
                    const commandsMenu = commandsEl.shadowRoot.querySelector('.commands');
                    if (commandsMenu) {
                        commandsMenu.style.backgroundColor = 'transparent';
                        commandsMenu.style.border = 'none';
                        commandsMenu.style.boxShadow = 'none';
                        commandsMenu.style.maxWidth = colors.commandMaxWidth || '80rem';
                        commandsMenu.style.paddingTop = '3rem';
                        
                        // Set grid layout if specified
                        if (colors.gridLayout === 'true') {
                            // Create grid layout style
                            const gridStyle = document.createElement('style');
                            gridStyle.className = 'swiss-grid-style';
                            gridStyle.textContent = `
                                .commands {
                                    display: grid !important;
                                    grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)) !important;
                                    grid-gap: 1.5rem !important;
                                    columns: unset !important;
                                    padding: 1.5rem !important;
                                    justify-content: center !important;
                                    align-items: start !important;
                                    width: auto !important;
                                    max-width: 42rem !important;
                                    margin: 0 auto !important;
                                }
                                
                                .command {
                                    display: flex !important;
                                    flex-direction: column !important;
                                    align-items: flex-start !important;
                                    gap: 0.5rem !important;
                                    border-left: 2px solid transparent !important;
                                    padding-left: 0.5rem !important;
                                    transition: all 0.2s ease !important;
                                    margin-bottom: 0.5rem !important;
                                }
                                
                                .command:hover {
                                    border-left-color: ${colors.accent} !important;
                                }
                                
                                @media (max-width: 768px) {
                                    .commands {
                                        grid-template-columns: repeat(3, minmax(100px, 1fr)) !important;
                                        grid-gap: 1rem !important;
                                        padding: 1rem !important;
                                        max-width: 32rem !important;
                                    }
                                    
                                    .command {
                                        margin-bottom: 0.25rem !important;
                                    }
                                }
                                
                                @media (max-width: 480px) {
                                    .commands {
                                        grid-template-columns: repeat(2, minmax(90px, 1fr)) !important;
                                        max-width: 22rem !important;
                                        padding: 0.8rem !important;
                                    }
                                }
                            `;
                            commandsEl.shadowRoot.appendChild(gridStyle);
                        }
                        
                        // Update key styling with Swiss typography principles
                        const keys = commandsEl.shadowRoot.querySelectorAll('.key');
                        keys.forEach(key => {
                            key.style.color = colors.keyColor || '#ff3b30';
                            key.style.opacity = '1';
                            key.style.fontWeight = colors.keyWeight || '700';
                            key.style.fontSize = colors.keyFontSize || '1.1em';
                            key.style.width = 'auto';
                            key.style.textAlign = 'left';
                        });

                        // Update name styles with Swiss typography
                        const names = commandsEl.shadowRoot.querySelectorAll('.name');
                        names.forEach(name => {
                            name.style.letterSpacing = colors.nameSpacing || '0.05em';
                            name.style.textTransform = 'uppercase';
                            name.style.fontSize = '0.8em';
                            name.style.opacity = '0.9';
                        });
                        
                        // Add Swiss-specific hover effect and responsive styles
                        const nameHoverStyle = document.createElement('style');
                        nameHoverStyle.className = 'swiss-name-hover-style';
                        nameHoverStyle.textContent = `
                            .command:hover .name {
                                color: ${colors.nameHoverColor || colors.accent} !important;
                            }
                            
                            .name::after {
                                display: none !important;
                            }
                            
                            @media (max-width: 768px) {
                                .key {
                                    font-size: 1em !important;
                                }
                                
                                .name {
                                    font-size: 0.75em !important;
                                }
                            }
                            
                            @media (max-width: 480px) {
                                .key {
                                    font-size: 0.9em !important;
                                }
                                
                                .name {
                                    font-size: 0.7em !important;
                                    letter-spacing: 0.03em !important;
                                }
                            }
                        `;
                        commandsEl.shadowRoot.appendChild(nameHoverStyle);
                    }
                }
                
                // Style corner texts for Swiss theme
                const cornerTexts = document.querySelectorAll('.corner-text');
                cornerTexts.forEach(el => {
                    el.style.textTransform = colors.cornerTextTransform || 'uppercase';
                    el.style.letterSpacing = colors.cornerTextSpacing || '0.1em';
                    el.style.fontWeight = colors.cornerTextWeight || '400';
                    el.style.fontSize = colors.cornerTextSize || '0.65rem';
                    el.style.opacity = '0.8';
                });
                
                // Additional responsive style for corner texts
                const cornerTextStyle = document.createElement('style');
                cornerTextStyle.textContent = `
                    @media (max-width: 768px) {
                        .corner-text {
                            padding: 1rem !important;
                            max-width: 150px !important;
                        }
                        
                        .top-left, .top-right, .bottom-left, .bottom-right {
                            font-size: 0.6rem !important;
                        }
                    }
                    
                    @media (max-width: 480px) {
                        .top-left, .bottom-right {
                            display: none !important;
                        }
                        
                        .top-right, .bottom-left {
                            padding: 0.75rem !important;
                            font-size: 0.55rem !important;
                        }
                    }
                `;
                document.head.appendChild(cornerTextStyle);
                
                // Style the settings dot
                const dot = document.querySelector('.settings-dot');
                if (dot) {
                    dot.style.width = '4px';
                    dot.style.height = '4px';
                    dot.style.opacity = '0.7';
                    dot.style.backgroundColor = colors.accent;
                    dot.style.boxShadow = 'none';
                }
                
                // Update settings panel with Swiss theme
                const settingsEl = document.querySelector('settings-widget');
                if (settingsEl && settingsEl.shadowRoot) {
                    const panel = settingsEl.shadowRoot.querySelector('.settings-panel');
                    if (panel) {
                        panel.style.backgroundColor = isDark ? 'rgba(20, 20, 20, 0.95)' : 'rgba(255, 255, 255, 0.95)';
                        panel.style.backdropFilter = 'blur(0)';
                        panel.style.border = 'none';
                        panel.style.boxShadow = 'none';
                        panel.style.borderRadius = '0';
                        panel.style.borderLeft = `2px solid ${colors.accent}`;
                        
                        // Add responsive settings for smaller screens
                        const responsiveSettingsStyle = document.createElement('style');
                        responsiveSettingsStyle.textContent = `
                            @media (max-width: 480px) {
                                .settings-panel {
                                    width: 240px !important;
                                    max-width: 90vw !important;
                                    font-size: 0.9em !important;
                                }
                                
                                .settings-option-label {
                                    font-size: 0.7rem !important;
                                }
                                
                                .settings-select {
                                    width: 100px !important;
                                    font-size: 0.7rem !important;
                                }
                                
                                .share-button {
                                    padding: 4px 8px !important;
                                    font-size: 0.65rem !important;
                                }
                                
                                .shortcut-form-input {
                                    padding: 4px 6px !important;
                                }
                            }
                        `;
                        settingsEl.shadowRoot.appendChild(responsiveSettingsStyle);
                    }
                    
                    // Style buttons in the Swiss theme
                    const buttons = settingsEl.shadowRoot.querySelectorAll('button');
                    buttons.forEach(button => {
                        if (button.classList.contains('primary') || button.classList.contains('import')) {
                            button.style.backgroundColor = colors.accent;
                            button.style.borderRadius = '0';
                        } else {
                            button.style.borderRadius = '0';
                        }
                    });
                }
                
                // Apply search component styles for Swiss theme
                const searchEl = document.querySelector('search-component');
                if (searchEl && searchEl.shadowRoot) {
                    const dialog = searchEl.shadowRoot.querySelector('.dialog');
                    const input = searchEl.shadowRoot.querySelector('.input');
                    
                    if (dialog && input) {
                        dialog.style.backdropFilter = 'none';
                        input.style.backgroundColor = 'transparent';
                        input.style.border = 'none';
                        input.style.borderBottom = `1px solid ${colors.accent}`;
                        input.style.borderRadius = '0';
                        input.style.boxShadow = 'none';
                        input.style.fontFamily = colors.fontFamily;
                        input.style.letterSpacing = colors.letterSpacing;
                        
                        // Add responsive styles for search
                        const responsiveSearchStyle = document.createElement('style');
                        responsiveSearchStyle.className = 'swiss-search-style';
                        responsiveSearchStyle.textContent = `
                            .input {
                                width: 90% !important;
                                max-width: 400px !important;
                                margin: 0 auto !important;
                            }
                            
                            @media (max-width: 480px) {
                                .input {
                                    font-size: 1rem !important;
                                    padding: 0.4rem 0.8rem !important;
                                }
                                
                                .suggestion {
                                    font-size: 0.8rem !important;
                                    padding: 0.4rem !important;
                                }
                            }
                            
                            .suggestion::before {
                                background-color: ${colors.accent} !important;
                                border-radius: 0 !important;
                            }
                        `;
                        searchEl.shadowRoot.appendChild(responsiveSearchStyle);
                    }
                }
            } else {
                // Reset to default styles for other themes
                document.documentElement.style.setProperty('--border-radius', '8px');
                document.documentElement.style.fontFamily = 'var(--font-family)';
                document.documentElement.style.fontSize = 'var(--font-size)';
                document.documentElement.style.backdropFilter = 'none';
                
                // Reset commands component style
                const commandsEl = document.querySelector('commands-component');
                if (commandsEl && commandsEl.shadowRoot) {
                    const commandsMenu = commandsEl.shadowRoot.querySelector('.commands');
                    if (commandsMenu) {
                        commandsMenu.style.backgroundColor = 'rgba(255, 255, 255, 0.7)';
                        commandsMenu.style.border = '1px solid rgba(0, 0, 0, 0.02)';
                        commandsMenu.style.boxShadow = 'var(--box-shadow)';
                        commandsMenu.style.backdropFilter = '';
                        commandsMenu.style.maxWidth = '';
                        
                        // Reset key colors
                        const keys = commandsEl.shadowRoot.querySelectorAll('.key');
                        keys.forEach(key => {
                            key.style.color = '';
                            key.style.opacity = '';
                            key.style.fontWeight = '';
                        });
                        
                        // Reset name styles
                        const names = commandsEl.shadowRoot.querySelectorAll('.name');
                        names.forEach(name => {
                            name.style.letterSpacing = '';
                        });
                    }
                }
                
                // Show corner texts for other themes
                const cornerTexts = document.querySelectorAll('.corner-text');
                cornerTexts.forEach(el => {
                    el.style.cssText = '';
                    el.style.opacity = '';
                });
                
                // Reset dot size
                const dot = document.querySelector('.settings-dot');
                if (dot) {
                    dot.style.width = '5px';
                    dot.style.height = '5px';
                    dot.style.opacity = '0.5';
                    dot.style.backgroundColor = '';
                    dot.style.boxShadow = '';
                }
                
                // Reset settings panel
                const settingsEl = document.querySelector('settings-widget');
                if (settingsEl && settingsEl.shadowRoot) {
                    const panel = settingsEl.shadowRoot.querySelector('.settings-panel');
                    if (panel) {
                        panel.style.backgroundColor = '';
                        panel.style.backdropFilter = '';
                        panel.style.border = '';
                        panel.style.boxShadow = '';
                        panel.style.borderRadius = '';
                    }
                }
                
                // Reset search component styles
                const searchEl = document.querySelector('search-component');
                if (searchEl && searchEl.shadowRoot) {
                    const dialog = searchEl.shadowRoot.querySelector('.dialog');
                    const input = searchEl.shadowRoot.querySelector('.input');
                    if (dialog && input) {
                        dialog.style.backdropFilter = '';
                        input.style.backdropFilter = '';
                        input.style.backgroundColor = '';
                        input.style.border = '';
                        input.style.boxShadow = '';
                    }
                }
            }
            
            // Remove any theme-specific styles
            const allCommandsEl = document.querySelector('commands-component');
            if (allCommandsEl && allCommandsEl.shadowRoot) {
                const commandsMenu = allCommandsEl.shadowRoot.querySelector('.commands');
                if (commandsMenu) {
                    // Remove any theme-specific styles that aren't needed for the current theme
                    const themeStyles = allCommandsEl.shadowRoot.querySelectorAll('.ocean-columns-style, .ocean-name-style, .ocean-animation-style, .swiss-grid-style, .swiss-name-hover-style, .swiss-search-style');
                    themeStyles.forEach(style => {
                        // Only remove styles not relevant to current theme
                        if ((themeName !== 'ocean' && style.className.includes('ocean')) || 
                            (themeName !== 'swiss' && style.className.includes('swiss'))) {
                            style.remove();
                        }
                    });
                
                    // If settings panel is open, make sure the editable class is added
                    if (this.#panel.classList.contains('open')) {
                        commandsMenu.classList.add('editable');
                    } else {
                        commandsMenu.classList.remove('editable');
                    }
                }
            }
        }
        
        // Method to display temporary messages in the share section
        #showMessage(message, isError = false) {
            this.#shareMessage.textContent = message;
            this.#shareMessage.classList.add('visible');
            
            if (isError) {
                this.#shareMessage.style.color = '#e53935';
            } else {
                this.#shareMessage.style.color = '';
            }
            
            // Hide the message after 3 seconds
            setTimeout(() => {
                this.#shareMessage.classList.remove('visible');
            }, 3000);
        }
        
        // Export settings and commands to a shareable string
        #onExportSettings = () => {
            try {
                // Gather all settings and commands
                const exportData = {
                    version: 1,
                    settings: {
                        openLinksInNewTab: this.#newTabSetting.checked,
                        darkMode: this.#darkModeSetting.checked,
                        theme: this.#currentTheme
                    },
                    commands: Array.from(COMMANDS.entries())
                };
                
                // Convert to JSON and then to Base64 for sharing
                const jsonData = JSON.stringify(exportData);
                const base64Data = btoa(jsonData);
                
                // Display in the textarea
                this.#shareData.value = base64Data;
                
                // Select the text for easy copying
                this.#shareData.select();
                document.execCommand('copy');
                
                this.#showMessage('Settings copied to clipboard!');
            } catch (e) {
                console.error('Error exporting settings:', e);
                this.#showMessage('Error exporting settings', true);
            }
        };
        
        // Import settings and commands from a shared string
        #onImportSettings = () => {
            try {
                const base64Data = this.#shareData.value.trim();
                
                if (!base64Data) {
                    this.#showMessage('Please paste settings data first', true);
                    return;
                }
                
                // Decode the Base64 string to JSON
                const jsonData = atob(base64Data);
                const importData = JSON.parse(jsonData);
                
                // Check version compatibility
                if (!importData.version || importData.version !== 1) {
                    this.#showMessage('Incompatible settings format', true);
                    return;
                }
                
                // Apply settings
                if (importData.settings) {
                    this.#newTabSetting.checked = importData.settings.openLinksInNewTab || false;
                    this.#darkModeSetting.checked = importData.settings.darkMode || false;
                    this.#themeSelect.value = importData.settings.theme || 'default';
                    this.#currentTheme = importData.settings.theme || 'default';
                    
                    // Save to localStorage
                    this.#saveSettings();
                    
                    // Apply theme
                    this.#applyTheme(this.#currentTheme, this.#darkModeSetting.checked);
                    
                    // Update CONFIG
                    CONFIG.openLinksInNewTab = this.#newTabSetting.checked;
                }
                
                // Import commands
                if (importData.commands && Array.isArray(importData.commands)) {
                    // Clear existing commands
                    COMMANDS.clear();
                    
                    // Add imported commands
                    for (const [key, value] of importData.commands) {
                        COMMANDS.set(key, value);
                    }
                    
                    // Save to localStorage
                    this.#saveCommands();
                    
                    // Update UI
                    document.querySelector('commands-component').initialize();
                }
                
                this.#showMessage('Settings imported successfully!');
                
                // Clear the textarea
                this.#shareData.value = '';
            } catch (e) {
                console.error('Error importing settings:', e);
                this.#showMessage('Invalid settings data format', true);
            }
        };
    }

    customElements.define('settings-widget', SettingsWidget);
</script>
