<!doctype html>
<meta charset="utf-8" />
<meta name="color-scheme" content="light" />
<meta name="robots" content="noindex" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" type="image/x-icon" href="./favicon.ico">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<title>~</title>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        function updateLinks(isLocal) {
            COMMANDS.forEach((value, key) => {
                try {
                    const url = new URL(value.url);
                    if (isLocal && url.hostname === 'ams') {
                        url.hostname = '192.168.1.9';
                    } else if (!isLocal && url.hostname === '192.168.1.9') {
                        url.hostname = 'ams';
                    }
                    value.url = url.toString();
                    console.log(`Updated command ${key}: ${value.url}`);
                } catch (e) {
                    console.error(`Error updating URL for command ${key}:`, e);
                }
            });
        }

        function isLocalNetwork() {
            fetch('https://api.ipify.org?format=json')
                .then(response => response.json())
                .then(data => {
                    const publicIP = data.ip;
                    console.log('Detected public IP:', publicIP);

                    // Resolve a.088899.xyz to get the current public IP
                    fetch('https://dns.google/resolve?name=a.088899.xyz&type=A')
                        .then(response => response.json())
                        .then(dnsData => {
                            const domainIP = dnsData.Answer[0].data;
                            console.log('Resolved domain IP:', domainIP);

                            const isLocal = publicIP === domainIP;
                            console.log('Is local network:', isLocal);

                            updateLinks(isLocal);
                            // Reinitialize the commands component to apply the updated URLs
                            document.querySelector('commands-component').initialize();
                        })
                        .catch(error => {
                            console.error('Error resolving domain IP:', error);
                        });
                })
                .catch(error => {
                    console.error('Error detecting public IP:', error);
                });
        }

        isLocalNetwork();
    });

    class Commands extends HTMLElement {
        constructor() {
            super();
            this.attachShadow({ mode: 'open' });
            this.initialize();
        }

        initialize() {
            const template = document.getElementById('commands-template');
            const clone = template.content.cloneNode(true);
            const commands = clone.querySelector('.commands');
            const commandTemplate = document.getElementById('command-template');

            for (const [key, { name, url }] of COMMANDS.entries()) {
                if (!name || !url) continue;
                const clone = commandTemplate.content.cloneNode(true);
                const command = clone.querySelector('.command');
                command.href = url;
                if (CONFIG.openLinksInNewTab) command.target = '_blank';
                clone.querySelector('.key').innerText = key;
                clone.querySelector('.name').innerText = name;
                commands.append(clone);
            }

            this.shadowRoot.innerHTML = '';  // Clear the shadow DOM before appending
            this.shadowRoot.append(clone);
        }
    }

    customElements.define('commands-component', Commands);
</script>


<style>
    :root {
        --border-radius: 8px;
        --color-background: #f8f5e6; /* Vanilla/yellowish background */
        --color-text-subtle: #666666; /* Subtle gray text */
        --color-text: #222222; /* Near black text */
        --color-accent: #333333; /* Accent color */
        --color-hover: #444444; /* Hover color */
        --font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        --font-size: clamp(13px, 1vw, 15px); /* Smaller font size */
        --font-weight-bold: 500;
        --font-weight-normal: 400;
        --space: .5rem;
        --transition-speed: 200ms;
        --box-shadow: 0 1px 4px rgba(0, 0, 0, 0.03);
    }
</style>

<script>
    const CONFIG = {
        commandPathDelimiter: '/',
        commandSearchDelimiter: ' ',
        defaultSearchTemplate: 'https://www.google.com/search?q={}',
        openLinksInNewTab: false,
        suggestionLimit: 4,
    };

    const COMMANDS = new Map([
        ['a', { name: 'Plex', url: 'https://app.plex.tv/desktop/' }],
        ['b', { name: 'Sonarr', url: 'https://sonarr.088899.xyz' }],
        ['c', { name: 'Radarr', url: 'https://radarr.088899.xyz' }],
        ['i', { name: 'Transmission', url: 'https://tr.088899.xyz' }],
        ['f', { name: 'Metube', url: 'https://mt.088899.xyz' }],
        ['g', { name: 'Jackett', url: 'https://jkt.088899.xyz' }],
        ['h', { name: 'DNS', url: 'http://ams:8000' }],
        ['d', { name: 'Twitch', url: 'https://twitch.tv' }],
        ['j', { name: 'Twitter', url: 'https://x.com' }],
        ['k', { name: 'Gmail', url: 'https://gmail.com/' }],
        [
            's',
            {
                name: 'YouTube',
                searchTemplate: '/results?search_query={}',
                url: 'https://youtube.com/',
            },
        ],
        [
            'q',
            {
                name: 'Most used',
                searchTemplate: ':{}',
                suggestions: ['web.whatsapp.com', 'anilist.co', 'discord.com/app'],
                url: 'http://localhost:3000',
            },
        ],
    ]);
</script>

<template id="commands-template">
    <style>
        .commands {
            border-radius: var(--border-radius);
            column-gap: 2.5rem;
            columns: 1;
            list-style: none;
            margin: 0 auto;
            max-width: 10rem;
            overflow: hidden;
            padding: 2rem;
            width: 100vw;
            background-color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(0, 0, 0, 0.02);
            box-shadow: var(--box-shadow);
        }

        .command {
            display: flex;
            gap: 0.8rem;
            outline: 0;
            padding: 0.4rem 0.2rem;
            position: relative;
            text-decoration: none;
            border-radius: var(--border-radius);
            margin-bottom: 12px;
            transition: all var(--transition-speed);
        }

        .command:where(:focus, :hover) {
            background-color: transparent;
        }

        .command:where(:focus, :hover) .name::after {
            width: 100%;
        }

        .key {
            color: var(--color-accent);
            display: inline-block;
            text-align: center;
            width: 1.5ch;
            font-weight: var(--font-weight-bold);
            font-size: 0.85em;
            opacity: 0.65;
        }

        .name {
            color: var(--color-text-subtle);
            transition: color var(--transition-speed);
            letter-spacing: 0.01em;
            position: relative;
            font-size: 0.95em;
        }

        .name::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 0;
            height: 1px;
            background-color: var(--color-text);
            transition: width var(--transition-speed);
        }

        .command:where(:focus, :hover) .name {
            color: var(--color-text);
        }

        @media (min-width: 500px) {
            .commands {
                columns: 2;
                max-width: 30rem;
            }
        }

        @media (min-width: 900px) {
            .commands {
                columns: 4;
                max-width: 52rem;
            }
        }
    </style>
    <nav>
        <menu class="commands"></menu>
    </nav>
</template>

<template id="command-template">
    <li>
        <a class="command" rel="noopener noreferrer">
            <span class="key"></span>
            <span class="name"></span>
        </a>
    </li>
</template>

<script type="module">
    class Commands extends HTMLElement {
        constructor() {
            super();
            this.attachShadow({ mode: 'open' });
            const template = document.getElementById('commands-template');
            const clone = template.content.cloneNode(true);
            const commands = clone.querySelector('.commands');
            const commandTemplate = document.getElementById('command-template');

            for (const [key, { name, url }] of COMMANDS.entries()) {
                if (!name || !url) continue;
                const clone = commandTemplate.content.cloneNode(true);
                const command = clone.querySelector('.command');
                command.href = url;
                if (CONFIG.openLinksInNewTab) command.target = '_blank';
                clone.querySelector('.key').innerText = key;
                clone.querySelector('.name').innerText = name;
                commands.append(clone);
            }

            this.shadowRoot.append(clone);
        }
    }

    customElements.define('commands-component', Commands);
</script>

<template id="search-template">
    <style>
        input,
        button {
            -moz-appearance: none;
            -webkit-appearance: none;
            background: transparent;
            border: 0;
            display: block;
            outline: 0;
        }

        .dialog {
            align-items: center;
            background: var(--color-background);
            border: none;
            display: none;
            flex-direction: column;
            height: 100%;
            justify-content: center;
            left: 0;
            padding: 0;
            top: 0;
            width: 100%;
            backdrop-filter: blur(3px);
        }

        .dialog[open] {
            display: flex;
        }

        .form {
            width: 100%;
            max-width: 500px;
        }

        .input {
            color: var(--color-text);
            font-size: 1.3rem;
            font-weight: var(--font-weight-normal);
            padding: 0.5rem 1rem;
            text-align: center;
            width: 100%;
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            font-family: var(--font-family);
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: var(--border-radius);
        }

        .suggestions {
            align-items: center;
            display: flex;
            flex-direction: column;
            flex-wrap: wrap;
            justify-content: center;
            list-style: none;
            margin: var(--space) 0 0;
            overflow: hidden;
            padding: 0;
        }

        .suggestion {
            color: var(--color-text);
            cursor: pointer;
            font-size: 0.9rem;
            padding: var(--space);
            position: relative;
            transition: color var(--transition-speed);
            white-space: nowrap;
            z-index: 1;
            border-radius: var(--border-radius);
        }

        .suggestion:where(:focus, :hover) {
            color: var(--color-background);
        }

        .suggestion::before {
            background-color: var(--color-accent);
            border-radius: var(--border-radius);
            content: ' ';
            inset: calc(var(--space) / 1.5) calc(var(--space) / 3);
            opacity: 0;
            position: absolute;
            transform: translateY(0.5em);
            transition: all var(--transition-speed);
            z-index: -1;
        }

        .suggestion:where(:focus, :hover)::before {
            opacity: 1;
            transform: translateY(0);
        }

        .match {
            color: var(--color-text-subtle);
            transition: color var(--transition-speed);
        }

        .suggestion:where(:focus, :hover) .match {
            color: var(--color-background);
        }

        @media (min-width: 700px) {
            .suggestions {
                flex-direction: row;
            }
        }
    </style>
    <dialog class="dialog">
        <form autocomplete="off" class="form" method="dialog" spellcheck="false">
            <input class="input" title="search" type="text" />
            <menu class="suggestions"></menu>
        </form>
    </dialog>
</template>

<template id="suggestion-template">
    <li>
        <button class="suggestion" type="button"></button>
    </li>
</template>

<template id="match-template">
    <span class="match"></span>
</template>

<script type="module">
    class Search extends HTMLElement {
        #dialog;
        #form;
        #input;
        #suggestions;

        constructor() {
            super();
            this.attachShadow({ mode: 'open' });
            const template = document.getElementById('search-template');
            const clone = template.content.cloneNode(true);
            this.#dialog = clone.querySelector('.dialog');
            this.#form = clone.querySelector('.form');
            this.#input = clone.querySelector('.input');
            this.#suggestions = clone.querySelector('.suggestions');
            this.#form.addEventListener('submit', this.#onSubmit, false);
            this.#input.addEventListener('input', this.#onInput);
            this.#suggestions.addEventListener('click', this.#onSuggestionClick);
            document.addEventListener('keydown', this.#onKeydown);
            this.shadowRoot.append(clone);
        }

        static #attachSearchPrefix(array, { key, splitBy }) {
            if (!splitBy) return array;
            return array.map((search) => `${key}${splitBy}${search}`);
        }

        static #escapeRegexCharacters(s) {
            return s.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
        }

        static #fetchDuckDuckGoSuggestions(search) {
            return new Promise((resolve) => {
                window.autocompleteCallback = (res) => {
                    const suggestions = [];

                    for (const item of res) {
                        if (item.phrase === search.toLowerCase()) continue;
                        suggestions.push(item.phrase);
                    }

                    resolve(suggestions);
                };

                const script = document.createElement('script');
                document.querySelector('head').appendChild(script);
                script.src = `https://duckduckgo.com/ac/?callback=autocompleteCallback&q=${search}`;
                script.onload = script.remove;
            });
        }

        static #formatSearchUrl(url, searchPath, search) {
            if (!searchPath) return url;
            const [baseUrl] = Search.#splitUrl(url);
            const urlQuery = encodeURIComponent(search);
            searchPath = searchPath.replace(/{}/g, urlQuery);
            return baseUrl + searchPath;
        }

        static #hasProtocol(s) {
            return /^[a-zA-Z]+:\/\//i.test(s);
        }

        static #isUrl(s) {
            return /^((https?:\/\/)?[\w-]+(\.[\w-]+)+\.?(:\d+)?(\/\S*)?)$/i.test(s);
        }

        static #parseQuery = (raw) => {
            const query = raw.trim();

            if (this.#isUrl(query)) {
                const url = this.#hasProtocol(query) ? query : `https://${query}`;
                return { query, url };
            }

            if (COMMANDS.has(query)) {
                const { command, key, url } = COMMANDS.get(query);
                return command ? Search.#parseQuery(command) : { key, query, url };
            }

            let splitBy = CONFIG.commandSearchDelimiter;
            const [searchKey, rawSearch] = query.split(new RegExp(`${splitBy}(.*)`));

            if (COMMANDS.has(searchKey)) {
                const { searchTemplate, url: base } = COMMANDS.get(searchKey);
                const search = rawSearch.trim();
                const url = Search.#formatSearchUrl(base, searchTemplate, search);
                return { key: searchKey, query, search, splitBy, url };
            }

            splitBy = CONFIG.commandPathDelimiter;
            const [pathKey, path] = query.split(new RegExp(`${splitBy}(.*)`));

            if (COMMANDS.has(pathKey)) {
                const { url: base } = COMMANDS.get(pathKey);
                const [baseUrl] = Search.#splitUrl(base);
                const url = `${baseUrl}/${path}`;
                return { key: pathKey, path, query, splitBy, url };
            }

            const [baseUrl, rest] = Search.#splitUrl(CONFIG.defaultSearchTemplate);
            const url = Search.#formatSearchUrl(baseUrl, rest, query);
            return { query, search: query, url };
        };

        static #splitUrl(url) {
            const parser = document.createElement('a');
            parser.href = url;
            const baseUrl = `${parser.protocol}//${parser.hostname}`;
            const rest = `${parser.pathname}${parser.search}`;
            return [baseUrl, rest];
        }

        #close() {
            this.#input.value = '';
            this.#input.blur();
            this.#dialog.close();
            this.#suggestions.innerHTML = '';
        }

        #execute(query) {
            const { url } = Search.#parseQuery(query);
            const target = CONFIG.openLinksInNewTab ? '_blank' : '_self';
            window.open(url, target, 'noopener noreferrer');
            this.#close();
        }

        #focusNextSuggestion(previous = false) {
            const active = this.shadowRoot.activeElement;
            let nextIndex;

            if (active.dataset.index) {
                const activeIndex = Number(active.dataset.index);
                nextIndex = previous ? activeIndex - 1 : activeIndex + 1;
            } else {
                nextIndex = previous ? this.#suggestions.childElementCount - 1 : 0;
            }

            const next = this.#suggestions.children[nextIndex];
            if (next) next.querySelector('.suggestion').focus();
            else this.#input.focus();
        }

        #onInput = async () => {
            const oq = Search.#parseQuery(this.#input.value);

            if (!oq.query) {
                this.#close();
                return;
            }

            let suggestions = COMMANDS.get(oq.query)?.suggestions ?? [];

            if (oq.search && suggestions.length < CONFIG.suggestionLimit) {
                const res = await Search.#fetchDuckDuckGoSuggestions(oq.search);
                const formatted = Search.#attachSearchPrefix(res, oq);
                suggestions = suggestions.concat(formatted);
            }

            const nq = Search.#parseQuery(this.#input.value);
            if (nq.query !== oq.query) return;
            this.#renderSuggestions(suggestions, oq.query);
        };

        #onKeydown = (e) => {
            if (!this.#dialog.open) {
                this.#dialog.show();
                this.#input.focus();

                requestAnimationFrame(() => {
                    // close the search dialog before the next repaint if a character is
                    // not produced (e.g. if you type shift, control, alt etc.)
                    if (!this.#input.value) this.#close();
                });

                return;
            }

            if (e.key === 'Escape') {
                this.#close();
                return;
            }

            const alt = e.altKey ? 'alt-' : '';
            const ctrl = e.ctrlKey ? 'ctrl-' : '';
            const meta = e.metaKey ? 'meta-' : '';
            const shift = e.shiftKey ? 'shift-' : '';
            const modifierPrefixedKey = `${alt}${ctrl}${meta}${shift}${e.key}`;

            if (/^(ArrowDown|Tab|ctrl-n)$/.test(modifierPrefixedKey)) {
                e.preventDefault();
                this.#focusNextSuggestion();
                return;
            }

            if (/^(ArrowUp|ctrl-p|shift-Tab)$/.test(modifierPrefixedKey)) {
                e.preventDefault();
                this.#focusNextSuggestion(true);
            }
        };

        #onSubmit = () => {
            this.#execute(this.#input.value);
        };

        #onSuggestionClick = (e) => {
            const ref = e.target.closest('.suggestion');
            if (!ref) return;
            this.#execute(ref.dataset.suggestion);
        };

        #renderSuggestions(suggestions, query) {
            this.#suggestions.innerHTML = '';
            const sliced = suggestions.slice(0, CONFIG.suggestionLimit);
            const template = document.getElementById('suggestion-template');

            for (const [index, suggestion] of sliced.entries()) {
                const clone = template.content.cloneNode(true);
                const ref = clone.querySelector('.suggestion');
                ref.dataset.index = index;
                ref.dataset.suggestion = suggestion;
                const escapedQuery = Search.#escapeRegexCharacters(query);
                const matched = suggestion.match(new RegExp(escapedQuery, 'i'));

                if (matched) {
                    const template = document.getElementById('match-template');
                    const clone = template.content.cloneNode(true);
                    const matchRef = clone.querySelector('.match');
                    const pre = suggestion.slice(0, matched.index);
                    const post = suggestion.slice(matched.index + matched[0].length);
                    matchRef.innerText = matched[0];
                    matchRef.insertAdjacentHTML('beforebegin', pre);
                    matchRef.insertAdjacentHTML('afterend', post);
                    ref.append(clone);
                } else {
                    ref.innerText = suggestion;
                }

                this.#suggestions.append(clone);
            }
        }
    }

    customElements.define('search-component', Search);
</script>

<style>
    html {
        background-color: var(--color-background);
        background-image: linear-gradient(135deg, #f8f5e6, #f2edd0);
        font-family: var(--font-family);
        font-size: var(--font-size);
        line-height: 1.4;
        height: 100%;
    }

    body {
        margin: 0;
        color: var(--color-text);
        height: 100%;
    }

    main {
        align-items: center;
        box-sizing: border-box;
        display: flex;
        justify-content: center;
        min-height: 100vh;
        overflow: hidden;
        padding: calc(var(--space) * 4) var(--space);
        position: relative;
        width: 100vw;
    }

    /* Hide the background element */
    bgelement {
        display: none;
    }

    /* Corner text styles */
    .corner-text {
        position: fixed;
        padding: 2rem;
        font-size: 0.68rem;
        line-height: 1.6;
        color: var(--color-text-subtle);
        opacity: 0.7;
        letter-spacing: 0.03em;
    }

    .top-left {
        top: 0;
        left: 0;
        text-align: left;
    }

    .top-right {
        top: 0;
        right: 0;
        text-align: right;
    }

    .bottom-left {
        bottom: 0;
        left: 0;
        text-align: left;
        max-width: 300px;
        font-style: italic;
    }

    .bottom-right {
        bottom: 0;
        right: 0;
        text-align: right;
    }

    .corner-text span {
        display: inline-block;
    }

    .corner-text .label {
        font-weight: var(--font-weight-bold);
        opacity: 0.8;
        margin-bottom: 0.3rem;
        text-transform: lowercase;
        letter-spacing: 0.05em;
    }
    
    #greeting, #quote, .bottom-right {
        opacity: 0.7;
    }
    
    #quote {
        font-size: 0.65rem;
        max-width: 250px;
        line-height: 1.7;
    }
    
    .bottom-right {
        font-size: 0.65rem;
        letter-spacing: 0.05em;
    }

    /* Settings dot styles */
    .settings-dot {
        position: fixed;
        bottom: 1rem;
        left: 50%;
        transform: translateX(-50%);
        width: 5px;
        height: 5px;
        background-color: var(--color-text-subtle);
        border-radius: 50%;
        opacity: 0.5;
        cursor: pointer;
        transition: all var(--transition-speed);
        z-index: 10;
    }

    .settings-dot:hover {
        opacity: 1;
        transform: translateX(-50%) scale(1.2);
        background-color: var(--color-accent);
    }
</style>

<script>
    // Function to get time of day greeting
    function getGreeting() {
        const hour = new Date().getHours();
        if (hour < 12) return "good morning";
        if (hour < 18) return "good afternoon";
        return "good evening";
    }

    // Random quotes array
    const QUOTES = [
        "The only way to do great work is to love what you do.",
        "Your time is limited, don't waste it living someone else's life.",
        "Stay hungry, stay foolish.",
        "Innovation distinguishes between a leader and a follower.",
        "The greatest glory in living lies not in never falling, but in rising every time we fall.",
        "Education is the most powerful weapon which you can use to change the world.",
        "The only source of knowledge is experience.",
        "Imagination is more important than knowledge.",
        "Strive not to be a success, but rather to be of value.",
        "If you can't explain it simply, you don't understand it well enough."
    ];

    // Function to get random quote
    function getRandomQuote() {
        return QUOTES[Math.floor(Math.random() * QUOTES.length)];
    }

    // Set corner text content when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('greeting').textContent = getGreeting();
        document.getElementById('quote').textContent = getRandomQuote();
    });
</script>

<main>
    <commands-component></commands-component>
    <search-component></search-component>
</main>

<div class="corner-text top-left">
    <span class="label">home</span><br>
    <span class="label">links</span>
</div>

<div class="corner-text top-right">
    <span id="greeting">good day</span>
</div>

<div class="corner-text bottom-left">
    <span id="quote"></span>
</div>

<div class="corner-text bottom-right">
    A. Magno
</div>

<template id="settings-widget-template">
    <style>
        .settings-panel {
            position: fixed;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: var(--border-radius);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            width: 280px;
            max-width: 90vw;
            z-index: 9;
            display: none;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .settings-panel.open {
            display: block;
            animation: fadeIn 0.2s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(-50%) translateY(10px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }

        .settings-title {
            font-size: 0.8rem;
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
            margin-bottom: 0.8rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            padding-bottom: 0.5rem;
        }

        .settings-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.8rem;
        }

        .settings-option-label {
            font-size: 0.75rem;
            color: var(--color-text-subtle);
        }

        .settings-checkbox {
            position: relative;
            width: 30px;
            height: 16px;
        }

        .settings-checkbox input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .settings-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .3s;
            border-radius: 34px;
        }

        .settings-slider:before {
            position: absolute;
            content: "";
            height: 12px;
            width: 12px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
        }

        input:checked + .settings-slider {
            background-color: var(--color-accent);
        }

        input:checked + .settings-slider:before {
            transform: translateX(14px);
        }
        
        .settings-select {
            font-family: var(--font-family);
            font-size: 0.75rem;
            color: var(--color-text);
            background-color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            padding: 3px 6px;
            width: 120px;
            outline: none;
            transition: all var(--transition-speed);
        }
        
        .settings-select:focus {
            border-color: var(--color-accent);
            box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.05);
        }
    </style>
    <div class="settings-panel">
        <div class="settings-title">Settings</div>
        <div class="settings-option">
            <span class="settings-option-label">Open links in new tab</span>
            <label class="settings-checkbox">
                <input type="checkbox" id="new-tab-setting">
                <span class="settings-slider"></span>
            </label>
        </div>
        <div class="settings-option">
            <span class="settings-option-label">Dark mode</span>
            <label class="settings-checkbox">
                <input type="checkbox" id="dark-mode-setting">
                <span class="settings-slider"></span>
            </label>
        </div>
        <div class="settings-option">
            <span class="settings-option-label">Theme</span>
            <select id="theme-select" class="settings-select">
                <option value="default">Default</option>
                <option value="minimal">Minimal</option>
                <option value="glass">Glass Modern</option>
                <option value="ocean">Ocean</option>
            </select>
        </div>
    </div>
</template>

<script type="module">
    class SettingsWidget extends HTMLElement {
        #panel;
        #newTabSetting;
        #darkModeSetting;
        #themeSelect;
        #currentTheme = 'default';
        
        // Theme definitions
        #themes = {
            default: {
                light: {
                    background: '#f8f5e6',
                    gradient: 'linear-gradient(135deg, #f8f5e6, #f2edd0)',
                    text: '#222222',
                    textSubtle: '#666666',
                    accent: '#333333',
                    hover: '#444444',
                    boxShadow: '0 1px 4px rgba(0, 0, 0, 0.03)'
                },
                dark: {
                    background: '#1a1a1a',
                    gradient: 'linear-gradient(135deg, #222, #333)',
                    text: '#e0e0e0',
                    textSubtle: '#a0a0a0',
                    accent: '#505050',
                    hover: '#707070',
                    boxShadow: '0 1px 4px rgba(0, 0, 0, 0.2)'
                }
            },
            minimal: {
                light: {
                    background: '#ffffff',
                    gradient: 'none',
                    text: '#000000',
                    textSubtle: '#999999',
                    accent: '#cccccc',
                    hover: '#eeeeee',
                    boxShadow: 'none',
                    borderRadius: '0',
                    borderWidth: '0',
                    fontFamily: '\"Courier New\", monospace',
                    fontSize: '12px',
                    commandsBackground: 'transparent',
                    commandsBorder: 'none',
                    commandsBoxShadow: 'none',
                    commandMaxWidth: '70rem',
                    keyColor: '#666666'
                },
                dark: {
                    background: '#000000',
                    gradient: 'none',
                    text: '#ffffff',
                    textSubtle: '#777777',
                    accent: '#333333',
                    hover: '#222222',
                    boxShadow: 'none',
                    borderRadius: '0',
                    borderWidth: '0',
                    fontFamily: '\"Courier New\", monospace',
                    fontSize: '12px',
                    commandsBackground: 'transparent',
                    commandsBorder: 'none',
                    commandsBoxShadow: 'none',
                    commandMaxWidth: '70rem',
                    keyColor: '#999999'
                }
            },
            glass: {
                light: {
                    background: 'rgba(255, 255, 255, 0.7)',
                    gradient: 'linear-gradient(135deg, #f5f7fa, #c3cfe2)',
                    text: '#334155',
                    textSubtle: '#64748b',
                    accent: '#3b82f6',
                    hover: '#60a5fa',
                    boxShadow: '0 4px 20px rgba(0, 0, 0, 0.05)',
                    borderRadius: '16px',
                    commandsBackground: 'rgba(255, 255, 255, 0.6)',
                    commandsBorder: '1px solid rgba(255, 255, 255, 0.2)',
                    commandsBoxShadow: '0 8px 32px rgba(0, 0, 0, 0.07)',
                    fontFamily: '\"Inter\", -apple-system, BlinkMacSystemFont, sans-serif',
                    fontSize: '14px',
                    keyColor: '#3b82f6',
                    commandMaxWidth: '60rem',
                    backdropFilter: 'blur(10px)',
                    cornerTextStyle: 'text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.6rem; font-weight: 500;',
                    dotSize: '6px',
                    dotOpacity: '0.7',
                    nameAfterHeight: '2px'
                },
                dark: {
                    background: 'rgba(15, 23, 42, 0.7)',
                    gradient: 'linear-gradient(135deg, #0f172a, #1e293b)',
                    text: '#e2e8f0',
                    textSubtle: '#94a3b8',
                    accent: '#38bdf8',
                    hover: '#7dd3fc',
                    boxShadow: '0 4px 20px rgba(0, 0, 0, 0.2)',
                    borderRadius: '16px',
                    commandsBackground: 'rgba(30, 41, 59, 0.5)',
                    commandsBorder: '1px solid rgba(255, 255, 255, 0.1)',
                    commandsBoxShadow: '0 8px 32px rgba(0, 0, 0, 0.2)',
                    fontFamily: '\"Inter\", -apple-system, BlinkMacSystemFont, sans-serif',
                    fontSize: '14px',
                    keyColor: '#38bdf8',
                    commandMaxWidth: '60rem',
                    backdropFilter: 'blur(10px)',
                    cornerTextStyle: 'text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.6rem; font-weight: 500;',
                    dotSize: '6px',
                    dotOpacity: '0.7',
                    nameAfterHeight: '2px'
                }
            },
            ocean: {
                light: {
                    background: '#e0f7fa',
                    gradient: 'linear-gradient(135deg, #e0f7fa, #80deea 50%, #4dd0e1)',
                    text: '#006064',
                    textSubtle: '#0097a7',
                    accent: '#00838f',
                    hover: '#006064',
                    boxShadow: '0 4px 14px rgba(0, 131, 143, 0.15)',
                    borderRadius: '12px',
                    commandsBackground: 'rgba(224, 247, 250, 0.8)',
                    commandsBorder: '1px solid rgba(129, 212, 250, 0.4)',
                    commandsBoxShadow: '0 6px 24px rgba(0, 131, 143, 0.1)',
                    fontFamily: '\"Inter\", -apple-system, BlinkMacSystemFont, sans-serif',
                    fontSize: '14px',
                    keyColor: '#00acc1',
                    commandMaxWidth: '55rem',
                    backdropFilter: 'blur(8px)',
                    cornerTextStyle: 'font-style: italic; letter-spacing: 0.05em; font-size: 0.7rem;',
                    dotSize: '8px',
                    dotOpacity: '0.8',
                    nameAfterHeight: '2px',
                    nameFont: '500',
                    commandsColumns: '3',
                    inputBackground: 'rgba(224, 247, 250, 0.9)',
                    inputBorder: '1px solid rgba(129, 212, 250, 0.5)',
                    inputShadow: '0 2px 10px rgba(0, 131, 143, 0.1)',
                    uiAnimation: 'true',
                    cornerTextOpacity: '0.85'
                },
                dark: {
                    background: '#002f35',
                    gradient: 'linear-gradient(135deg, #002f35, #00363a 50%, #004d40)',
                    text: '#e0f7fa',
                    textSubtle: '#80deea',
                    accent: '#26c6da',
                    hover: '#4dd0e1',
                    boxShadow: '0 4px 14px rgba(0, 172, 193, 0.2)',
                    borderRadius: '12px',
                    commandsBackground: 'rgba(0, 59, 66, 0.7)',
                    commandsBorder: '1px solid rgba(38, 198, 218, 0.2)',
                    commandsBoxShadow: '0 6px 24px rgba(0, 172, 193, 0.15)',
                    fontFamily: '\"Inter\", -apple-system, BlinkMacSystemFont, sans-serif',
                    fontSize: '14px',
                    keyColor: '#26c6da',
                    commandMaxWidth: '55rem',
                    backdropFilter: 'blur(8px)',
                    cornerTextStyle: 'font-style: italic; letter-spacing: 0.05em; font-size: 0.7rem;',
                    dotSize: '8px',
                    dotOpacity: '0.8',
                    nameAfterHeight: '2px',
                    nameFont: '500',
                    commandsColumns: '3',
                    inputBackground: 'rgba(0, 59, 66, 0.8)',
                    inputBorder: '1px solid rgba(38, 198, 218, 0.3)',
                    inputShadow: '0 2px 10px rgba(0, 172, 193, 0.15)',
                    uiAnimation: 'true',
                    cornerTextOpacity: '0.85'
                }
            }
        };
        
        constructor() {
            super();
            this.attachShadow({ mode: 'open' });
            const template = document.getElementById('settings-widget-template');
            const clone = template.content.cloneNode(true);
            this.#panel = clone.querySelector('.settings-panel');
            this.shadowRoot.append(clone);
            
            // Get settings elements
            this.#newTabSetting = this.shadowRoot.querySelector('#new-tab-setting');
            this.#darkModeSetting = this.shadowRoot.querySelector('#dark-mode-setting');
            this.#themeSelect = this.shadowRoot.querySelector('#theme-select');
            
            // Initialize settings from the existing CONFIG
            this.#newTabSetting.checked = CONFIG.openLinksInNewTab;
            
            // Try to load user settings from localStorage
            this.#loadSettings();
            
            // Add event listeners
            this.#newTabSetting.addEventListener('change', this.#onNewTabChange);
            this.#darkModeSetting.addEventListener('change', this.#onDarkModeChange);
            this.#themeSelect.addEventListener('change', this.#onThemeChange);
            
            // Close panel when clicking outside
            document.addEventListener('click', this.#onDocumentClick);
        }
        
        toggle() {
            this.#panel.classList.toggle('open');
        }
        
        #loadSettings() {
            try {
                // Try to load settings from localStorage
                const savedSettings = localStorage.getItem('homeSettings');
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    
                    // Apply saved settings
                    this.#newTabSetting.checked = settings.openLinksInNewTab || false;
                    this.#darkModeSetting.checked = settings.darkMode || false;
                    this.#themeSelect.value = settings.theme || 'default';
                    this.#currentTheme = settings.theme || 'default';
                    
                    // Apply theme and mode
                    this.#applyTheme(this.#currentTheme, this.#darkModeSetting.checked);
                    
                    // Update CONFIG
                    CONFIG.openLinksInNewTab = this.#newTabSetting.checked;
                }
            } catch (e) {
                console.error('Error loading settings:', e);
            }
        }
        
        #saveSettings() {
            try {
                const settings = {
                    openLinksInNewTab: this.#newTabSetting.checked,
                    darkMode: this.#darkModeSetting.checked,
                    theme: this.#currentTheme
                };
                localStorage.setItem('homeSettings', JSON.stringify(settings));
            } catch (e) {
                console.error('Error saving settings:', e);
            }
        }
        
        #onNewTabChange = (e) => {
            CONFIG.openLinksInNewTab = e.target.checked;
            // Re-initialize commands component to apply setting
            document.querySelector('commands-component').initialize();
            this.#saveSettings();
        };
        
        #onDarkModeChange = (e) => {
            this.#applyTheme(this.#currentTheme, e.target.checked);
            this.#saveSettings();
        };
        
        #onThemeChange = (e) => {
            this.#currentTheme = e.target.value;
            this.#applyTheme(this.#currentTheme, this.#darkModeSetting.checked);
            this.#saveSettings();
        };
        
        #applyTheme(themeName, isDark) {
            const theme = this.#themes[themeName] || this.#themes.default;
            const colors = isDark ? theme.dark : theme.light;
            
            document.documentElement.style.setProperty('--color-background', colors.background);
            document.documentElement.style.setProperty('--color-text', colors.text);
            document.documentElement.style.setProperty('--color-text-subtle', colors.textSubtle);
            document.documentElement.style.setProperty('--color-accent', colors.accent);
            document.documentElement.style.setProperty('--color-hover', colors.hover);
            document.documentElement.style.setProperty('--box-shadow', colors.boxShadow);
            
            // Apply gradient
            if (colors.gradient && colors.gradient !== 'none') {
                document.documentElement.style.backgroundImage = colors.gradient;
            } else {
                document.documentElement.style.backgroundImage = 'none';
            }
            
            // Handle special minimal theme properties
            if (themeName === 'minimal') {
                // Adjust border radius
                document.documentElement.style.setProperty('--border-radius', colors.borderRadius || '8px');
                
                // Adjust font
                if (colors.fontFamily) {
                    document.documentElement.style.fontFamily = colors.fontFamily;
                }
                
                if (colors.fontSize) {
                    document.documentElement.style.fontSize = colors.fontSize;
                }
                
                // Modify commands component style
                const commandsEl = document.querySelector('commands-component');
                if (commandsEl && commandsEl.shadowRoot) {
                    const commandsMenu = commandsEl.shadowRoot.querySelector('.commands');
                    if (commandsMenu) {
                        commandsMenu.style.backgroundColor = colors.commandsBackground || '';
                        commandsMenu.style.border = colors.commandsBorder || '';
                        commandsMenu.style.boxShadow = colors.commandsBoxShadow || '';
                        commandsMenu.style.maxWidth = colors.commandMaxWidth || '';
                        
                        // Update key colors
                        const keys = commandsEl.shadowRoot.querySelectorAll('.key');
                        keys.forEach(key => {
                            key.style.color = colors.keyColor || '';
                        });
                    }
                }
                
                // Hide corner texts for minimal theme
                const cornerTexts = document.querySelectorAll('.corner-text');
                cornerTexts.forEach(el => {
                    el.style.opacity = '0';
                });
                
                // Make dot smaller and more subtle
                const dot = document.querySelector('.settings-dot');
                if (dot) {
                    dot.style.width = '3px';
                    dot.style.height = '3px';
                    dot.style.opacity = '0.3';
                }
            } else if (themeName === 'glass') {
                // Apply glass theme properties
                document.documentElement.style.setProperty('--border-radius', colors.borderRadius || '16px');
                
                // Apply backdrop filter to html
                document.documentElement.style.backdropFilter = colors.backdropFilter || 'blur(10px)';
                
                // Set font properties
                if (colors.fontFamily) {
                    document.documentElement.style.fontFamily = colors.fontFamily;
                }
                
                if (colors.fontSize) {
                    document.documentElement.style.fontSize = colors.fontSize;
                }
                
                // Modify commands component style to be glassy
                const commandsEl = document.querySelector('commands-component');
                if (commandsEl && commandsEl.shadowRoot) {
                    const commandsMenu = commandsEl.shadowRoot.querySelector('.commands');
                    if (commandsMenu) {
                        commandsMenu.style.backgroundColor = colors.commandsBackground || '';
                        commandsMenu.style.border = colors.commandsBorder || '';
                        commandsMenu.style.boxShadow = colors.commandsBoxShadow || '';
                        commandsMenu.style.backdropFilter = colors.backdropFilter || '';
                        commandsMenu.style.maxWidth = colors.commandMaxWidth || '';
                        
                        // Update key colors and make them more prominent
                        const keys = commandsEl.shadowRoot.querySelectorAll('.key');
                        keys.forEach(key => {
                            key.style.color = colors.keyColor || '';
                            key.style.opacity = '1';
                            key.style.fontWeight = '600';
                        });

                        // Update name underline style
                        const names = commandsEl.shadowRoot.querySelectorAll('.name');
                        names.forEach(name => {
                            const after = name.querySelector('::after') || name;
                            name.style.letterSpacing = '0.02em';
                            if (colors.nameAfterHeight) {
                                const style = document.createElement('style');
                                style.textContent = `.name::after { height: ${colors.nameAfterHeight} !important; }`;
                                commandsEl.shadowRoot.appendChild(style);
                            }
                        });
                    }
                }
                
                // Style corner texts for glass theme
                const cornerTexts = document.querySelectorAll('.corner-text');
                cornerTexts.forEach(el => {
                    el.style.cssText = colors.cornerTextStyle || '';
                    el.style.opacity = '0.8';
                });
                
                // Style the settings dot
                const dot = document.querySelector('.settings-dot');
                if (dot) {
                    dot.style.width = colors.dotSize || '6px';
                    dot.style.height = colors.dotSize || '6px';
                    dot.style.opacity = colors.dotOpacity || '0.7';
                    dot.style.backgroundColor = colors.accent;
                    dot.style.boxShadow = '0 0 10px ' + colors.accent;
                }
                
                // Update settings panel to glass style
                const settingsEl = document.querySelector('settings-widget');
                if (settingsEl && settingsEl.shadowRoot) {
                    const panel = settingsEl.shadowRoot.querySelector('.settings-panel');
                    if (panel) {
                        panel.style.backgroundColor = colors.commandsBackground;
                        panel.style.backdropFilter = colors.backdropFilter;
                        panel.style.border = colors.commandsBorder;
                        panel.style.boxShadow = colors.commandsBoxShadow;
                        panel.style.borderRadius = colors.borderRadius;
                    }
                }
                
                // Apply search component styles
                const searchEl = document.querySelector('search-component');
                if (searchEl && searchEl.shadowRoot) {
                    const dialog = searchEl.shadowRoot.querySelector('.dialog');
                    const input = searchEl.shadowRoot.querySelector('.input');
                    if (dialog && input) {
                        dialog.style.backdropFilter = colors.backdropFilter;
                        input.style.backdropFilter = colors.backdropFilter;
                        input.style.backgroundColor = colors.commandsBackground;
                        input.style.border = colors.commandsBorder;
                        input.style.boxShadow = colors.commandsBoxShadow;
                    }
                }
            } else if (themeName === 'ocean') {
                // Apply Ocean theme properties
                document.documentElement.style.setProperty('--border-radius', colors.borderRadius || '12px');
                
                // Apply backdrop filter to html
                document.documentElement.style.backdropFilter = colors.backdropFilter || 'blur(8px)';
                
                // Set font properties
                if (colors.fontFamily) {
                    document.documentElement.style.fontFamily = colors.fontFamily;
                }
                
                if (colors.fontSize) {
                    document.documentElement.style.fontSize = colors.fontSize;
                }
                
                // Modify commands component style for Ocean theme
                const commandsEl = document.querySelector('commands-component');
                if (commandsEl && commandsEl.shadowRoot) {
                    const commandsMenu = commandsEl.shadowRoot.querySelector('.commands');
                    if (commandsMenu) {
                        commandsMenu.style.backgroundColor = colors.commandsBackground || '';
                        commandsMenu.style.border = colors.commandsBorder || '';
                        commandsMenu.style.boxShadow = colors.commandsBoxShadow || '';
                        commandsMenu.style.backdropFilter = colors.backdropFilter || '';
                        commandsMenu.style.maxWidth = colors.commandMaxWidth || '';
                        
                        // Set columns for the commands menu if specified
                        if (colors.commandsColumns) {
                            const style = document.createElement('style');
                            style.textContent = `
                                @media (min-width: 500px) {
                                    .commands {
                                        columns: ${colors.commandsColumns} !important;
                                    }
                                }
                            `;
                            commandsEl.shadowRoot.appendChild(style);
                        }
                        
                        // Update key colors with Ocean theme styling
                        const keys = commandsEl.shadowRoot.querySelectorAll('.key');
                        keys.forEach(key => {
                            key.style.color = colors.keyColor || '';
                            key.style.opacity = '1';
                            key.style.fontWeight = '600';
                            key.style.fontSize = '1em';
                        });

                        // Update name styles with Ocean theme styling
                        const names = commandsEl.shadowRoot.querySelectorAll('.name');
                        names.forEach(name => {
                            name.style.letterSpacing = '0.03em';
                            name.style.fontWeight = colors.nameFont || '400';
                            
                            if (colors.nameAfterHeight) {
                                const style = document.createElement('style');
                                style.textContent = `.name::after { 
                                    height: ${colors.nameAfterHeight} !important; 
                                    background-color: ${colors.accent} !important;
                                }`;
                                commandsEl.shadowRoot.appendChild(style);
                            }
                        });
                        
                        // Add subtle animation if enabled
                        if (colors.uiAnimation === 'true') {
                            const style = document.createElement('style');
                            style.textContent = `
                                .command {
                                    transition: transform 0.3s ease, box-shadow 0.3s ease !important;
                                }
                                .command:hover {
                                    transform: translateY(-2px) !important;
                                    box-shadow: 0 4px 12px rgba(0, 131, 143, 0.15) !important;
                                }
                            `;
                            commandsEl.shadowRoot.appendChild(style);
                        }
                    }
                }
                
                // Style corner texts for Ocean theme
                const cornerTexts = document.querySelectorAll('.corner-text');
                cornerTexts.forEach(el => {
                    el.style.cssText = colors.cornerTextStyle || '';
                    el.style.opacity = colors.cornerTextOpacity || '0.85';
                });
                
                // Style the settings dot for Ocean theme
                const dot = document.querySelector('.settings-dot');
                if (dot) {
                    dot.style.width = colors.dotSize || '8px';
                    dot.style.height = colors.dotSize || '8px';
                    dot.style.opacity = colors.dotOpacity || '0.8';
                    dot.style.backgroundColor = colors.accent;
                    dot.style.boxShadow = '0 0 12px ' + colors.accent;
                    
                    // Add pulse animation to the dot
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes pulse {
                            0% { transform: translateX(-50%) scale(1); }
                            50% { transform: translateX(-50%) scale(1.2); }
                            100% { transform: translateX(-50%) scale(1); }
                        }
                        .settings-dot:hover {
                            animation: pulse 1.5s infinite ease-in-out;
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                // Update settings panel for Ocean theme
                const settingsEl = document.querySelector('settings-widget');
                if (settingsEl && settingsEl.shadowRoot) {
                    const panel = settingsEl.shadowRoot.querySelector('.settings-panel');
                    if (panel) {
                        panel.style.backgroundColor = colors.commandsBackground;
                        panel.style.backdropFilter = colors.backdropFilter;
                        panel.style.border = colors.commandsBorder;
                        panel.style.boxShadow = colors.commandsBoxShadow;
                        panel.style.borderRadius = colors.borderRadius;
                    }
                }
                
                // Apply search component styles for Ocean theme
                const searchEl = document.querySelector('search-component');
                if (searchEl && searchEl.shadowRoot) {
                    const dialog = searchEl.shadowRoot.querySelector('.dialog');
                    const input = searchEl.shadowRoot.querySelector('.input');
                    const suggestions = searchEl.shadowRoot.querySelector('.suggestions');
                    
                    if (dialog && input) {
                        dialog.style.backdropFilter = colors.backdropFilter;
                        input.style.backgroundColor = colors.inputBackground || colors.commandsBackground;
                        input.style.border = colors.inputBorder || colors.commandsBorder;
                        input.style.boxShadow = colors.inputShadow || colors.commandsBoxShadow;
                        input.style.borderRadius = colors.borderRadius;
                        
                        // Style the suggestions for Ocean theme
                        if (suggestions) {
                            const style = document.createElement('style');
                            style.textContent = `
                                .suggestion::before {
                                    background-color: ${colors.accent} !important;
                                }
                            `;
                            searchEl.shadowRoot.appendChild(style);
                        }
                    }
                }
            } else {
                // Reset to default styles for other themes
                document.documentElement.style.setProperty('--border-radius', '8px');
                document.documentElement.style.fontFamily = 'var(--font-family)';
                document.documentElement.style.fontSize = 'var(--font-size)';
                document.documentElement.style.backdropFilter = 'none';
                
                // Reset commands component style
                const commandsEl = document.querySelector('commands-component');
                if (commandsEl && commandsEl.shadowRoot) {
                    const commandsMenu = commandsEl.shadowRoot.querySelector('.commands');
                    if (commandsMenu) {
                        commandsMenu.style.backgroundColor = 'rgba(255, 255, 255, 0.7)';
                        commandsMenu.style.border = '1px solid rgba(0, 0, 0, 0.02)';
                        commandsMenu.style.boxShadow = 'var(--box-shadow)';
                        commandsMenu.style.backdropFilter = '';
                        commandsMenu.style.maxWidth = '';
                        
                        // Reset key colors
                        const keys = commandsEl.shadowRoot.querySelectorAll('.key');
                        keys.forEach(key => {
                            key.style.color = '';
                            key.style.opacity = '';
                            key.style.fontWeight = '';
                        });
                        
                        // Reset name styles
                        const names = commandsEl.shadowRoot.querySelectorAll('.name');
                        names.forEach(name => {
                            name.style.letterSpacing = '';
                        });
                    }
                }
                
                // Show corner texts for other themes
                const cornerTexts = document.querySelectorAll('.corner-text');
                cornerTexts.forEach(el => {
                    el.style.cssText = '';
                    el.style.opacity = '';
                });
                
                // Reset dot size
                const dot = document.querySelector('.settings-dot');
                if (dot) {
                    dot.style.width = '5px';
                    dot.style.height = '5px';
                    dot.style.opacity = '0.5';
                    dot.style.backgroundColor = '';
                    dot.style.boxShadow = '';
                }
                
                // Reset settings panel
                const settingsEl = document.querySelector('settings-widget');
                if (settingsEl && settingsEl.shadowRoot) {
                    const panel = settingsEl.shadowRoot.querySelector('.settings-panel');
                    if (panel) {
                        panel.style.backgroundColor = '';
                        panel.style.backdropFilter = '';
                        panel.style.border = '';
                        panel.style.boxShadow = '';
                        panel.style.borderRadius = '';
                    }
                }
                
                // Reset search component styles
                const searchEl = document.querySelector('search-component');
                if (searchEl && searchEl.shadowRoot) {
                    const dialog = searchEl.shadowRoot.querySelector('.dialog');
                    const input = searchEl.shadowRoot.querySelector('.input');
                    if (dialog && input) {
                        dialog.style.backdropFilter = '';
                        input.style.backdropFilter = '';
                        input.style.backgroundColor = '';
                        input.style.border = '';
                        input.style.boxShadow = '';
                    }
                }
            }
        }
        
        #onDocumentClick = (e) => {
            // Don't close if clicking inside the settings panel or the dot
            if (e.target.closest('.settings-dot') || e.target.closest('settings-widget')) {
                return;
            }
            this.#panel.classList.remove('open');
        };
    }

    customElements.define('settings-widget', SettingsWidget);
    
    document.addEventListener('DOMContentLoaded', function() {
        // Create settings dot and widget
        const settingsWidget = document.createElement('settings-widget');
        document.body.appendChild(settingsWidget);
        
        const settingsDot = document.createElement('div');
        settingsDot.className = 'settings-dot';
        settingsDot.addEventListener('click', () => {
            const settingsEl = document.querySelector('settings-widget');
            settingsEl.toggle();
        });
        document.body.appendChild(settingsDot);
        
        // Existing event listeners
        document.getElementById('greeting').textContent = getGreeting();
        document.getElementById('quote').textContent = getRandomQuote();
    });
</script>
