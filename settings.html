<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="color-scheme" content="light" />
    <meta name="robots" content="noindex" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" type="image/x-icon" href="./favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <title>Settings</title>

    <!-- Preload theme script to prevent flash -->
    <script>
        // Apply theme immediately before page renders to prevent flash
        (function() {
            try {
                const savedSettings = localStorage.getItem('homeSettings');
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    const themeName = settings.theme || 'default';
                    const isDarkMode = settings.darkMode || false;
                    
                    // Apply dark mode class
                    document.documentElement.classList.toggle('dark-mode', isDarkMode);
                    
                    // Store theme data in a data attribute for components to access
                    document.documentElement.dataset.theme = themeName;
                    document.documentElement.dataset.darkMode = isDarkMode;
                    
                    // Define basic theme properties - just enough to prevent flash
                    const BASIC_THEMES = {
                        default: {
                            light: {
                                background: '#f8f5e6',
                                gradient: 'linear-gradient(135deg, #f8f5e6, #f2edd0)',
                                text: '#222222'
                            },
                            dark: {
                                background: '#1a1a1a',
                                gradient: 'linear-gradient(135deg, #222, #333)',
                                text: '#e0e0e0'
                            }
                        },
                        minimal: {
                            light: {
                                background: '#ffffff',
                                gradient: 'none',
                                text: '#000000'
                            },
                            dark: {
                                background: '#000000',
                                gradient: 'none',
                                text: '#ffffff'
                            }
                        },
                        glass: {
                            light: {
                                background: 'rgba(255, 255, 255, 0.7)',
                                gradient: 'linear-gradient(135deg, #f5f7fa, #c3cfe2)',
                                text: '#334155'
                            },
                            dark: {
                                background: 'rgba(15, 23, 42, 0.7)',
                                gradient: 'linear-gradient(135deg, #0f172a, #1e293b)',
                                text: '#e2e8f0'
                            }
                        },
                        ocean: {
                            light: {
                                background: '#e0f7fa',
                                gradient: 'linear-gradient(135deg, #e0f7fa, #80deea 50%, #4dd0e1)',
                                text: '#006064'
                            },
                            dark: {
                                background: '#002f35',
                                gradient: 'linear-gradient(135deg, #002f35, #00363a 50%, #004d40)',
                                text: '#e0f7fa'
                            }
                        },
                        swiss: {
                            light: {
                                background: '#ffffff',
                                gradient: 'none',
                                text: '#111111'
                            },
                            dark: {
                                background: '#000000',
                                gradient: 'none',
                                text: '#ffffff'
                            }
                        },
                        neon: {
                            light: {
                                background: '#0f0f1a',
                                gradient: 'radial-gradient(circle at top right, rgba(120, 0, 255, 0.2), transparent), radial-gradient(circle at bottom left, rgba(0, 255, 255, 0.2), transparent)',
                                text: '#ffffff'
                            },
                            dark: {
                                background: '#0a0a12',
                                gradient: 'radial-gradient(circle at top right, rgba(120, 0, 255, 0.3), transparent), radial-gradient(circle at bottom left, rgba(0, 255, 255, 0.3), transparent)',
                                text: '#ffffff'
                            }
                        },
                        retro: {
                            light: {
                                background: '#faf4d4',
                                gradient: 'linear-gradient(135deg, #faf4d4, #f9c58d)',
                                text: '#562349'
                            },
                            dark: {
                                background: '#2c1320',
                                gradient: 'linear-gradient(135deg, #2c1320, #42253b)',
                                text: '#f9c58d'
                            }
                        },
                        brutalist: {
                            light: {
                                background: '#ffffff',
                                gradient: 'none',
                                text: '#000000'
                            },
                            dark: {
                                background: '#000000',
                                gradient: 'none',
                                text: '#ffffff'
                            }
                        },
                        gaming: {
                            light: {
                                background: '#121212',
                                gradient: 'linear-gradient(135deg, #121212, #1a1a1a)',
                                text: '#e0e0e0'
                            },
                            dark: {
                                background: '#0a0a0a',
                                gradient: 'linear-gradient(135deg, #0a0a0a, #151515)',
                                text: '#e0e0e0'
                            }
                        },
                        cyberpunk: {
                            light: {
                                background: '#050023',
                                gradient: 'radial-gradient(circle at top right, rgba(255, 0, 170, 0.2), transparent), radial-gradient(circle at bottom left, rgba(0, 255, 255, 0.2), transparent)',
                                text: '#ffffff'
                            },
                            dark: {
                                background: '#0d0221',
                                gradient: 'radial-gradient(circle at top right, rgba(255, 0, 170, 0.2), transparent), radial-gradient(circle at bottom left, rgba(0, 255, 255, 0.2), transparent)',
                                text: '#ffffff'
                            }
                        },
                        bauhaus: {
                            light: {
                                background: '#ffffff',
                                gradient: 'none',
                                text: '#000000'
                            },
                            dark: {
                                background: '#121212',
                                gradient: 'none',
                                text: '#ffffff'
                            }
                        },
                        vaporwave: {
                            light: {
                                background: '#f2c6de',
                                gradient: 'linear-gradient(135deg, #f2c6de, #c2f5e9)',
                                text: '#000b8e'
                            },
                            dark: {
                                background: '#08012e',
                                gradient: 'linear-gradient(135deg, #08012e, #290b45)',
                                text: '#ff00f2'
                            }
                        },
                        nordic: {
                            light: {
                                background: '#ffffff',
                                gradient: 'linear-gradient(135deg, #ffffff, #f7f9fc)',
                                text: '#2e3440'
                            },
                            dark: {
                                background: '#2e3440',
                                gradient: 'linear-gradient(135deg, #2e3440, #3b4252)',
                                text: '#eceff4'
                            }
                        },
                        mac: {
                            light: {
                                background: '#ffffff',
                                gradient: 'linear-gradient(135deg, #ffffff, #f5f5f7)',
                                text: '#1d1d1f'
                            },
                            dark: {
                                background: '#000000',
                                gradient: 'linear-gradient(135deg, #000000, #1d1d1f)',
                                text: '#f5f5f7'
                            }
                        }
                    };
                    
                    // Apply basic colors immediately
                    const theme = BASIC_THEMES[themeName] || BASIC_THEMES.default;
                    const colors = isDarkMode ? theme.dark : theme.light;
                    
                    document.documentElement.style.backgroundColor = colors.background;
                    document.documentElement.style.color = colors.text;
                    
                    if (colors.gradient && colors.gradient !== 'none') {
                        document.documentElement.style.backgroundImage = colors.gradient;
                    }
                }
            } catch (e) {
                console.error('Error pre-loading theme:', e);
            }
        })();
    </script>

    <style>
        :root {
            --border-radius: 8px;
            --color-background: #f8f5e6; /* Vanilla/yellowish background */
            --color-text-subtle: #666666; /* Subtle gray text */
            --color-text: #222222; /* Near black text */
            --color-accent: #333333; /* Accent color */
            --color-hover: #444444; /* Hover color */
            --color-accent-rgb: 51, 51, 51; /* RGB values for accent color */
            --font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-size: clamp(13px, 1vw, 15px); /* Smaller font size */
            --font-weight-bold: 500;
            --font-weight-normal: 400;
            --space: .5rem;
            --transition-speed: 200ms;
            --box-shadow: 0 1px 4px rgba(0, 0, 0, 0.03);
        }

        html {
            background-color: var(--color-background);
            background-image: linear-gradient(135deg, #f8f5e6, #f2edd0);
            font-family: var(--font-family);
            font-size: var(--font-size);
            line-height: 1.4;
            height: 100%;
        }

        body {
            margin: 0;
            padding: 0;
            color: var(--color-text);
            min-height: 100%;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding-top: 2rem;
            padding-bottom: 4rem;
        }

        .back-link {
            position: fixed;
            top: 1.5rem;
            left: 1.5rem;
            padding: 0.7rem 1.2rem;
            background: rgba(255, 255, 255, 0.7);
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
            z-index: 100;
            text-decoration: none;
        }

        .back-link:hover {
            color: var(--color-text);
        }

        .back-link::before {
            content: "←";
            margin-right: 0.5rem;
            font-size: 1.2em;
        }

        .settings-container {
            width: 100%;
            max-width: 1200px;
            padding: 2rem;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 2rem;
            align-items: start;
            box-sizing: border-box;
        }

        .settings-header {
            grid-column: 1 / -1;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            padding-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-header-content {
            flex: 1;
        }

        .settings-title {
            font-size: 1.8rem;
            font-weight: var(--font-weight-bold);
            margin: 0 0 0.5rem 0;
        }

        .settings-description {
            color: var(--color-text-subtle);
            margin: 0;
            font-size: 0.9rem;
        }

        .settings-section {
            background: rgba(255, 255, 255, 0.5);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            box-shadow: var(--box-shadow);
            border: 1px solid rgba(0, 0, 0, 0.05);
            height: fit-content;
        }

        html.dark-mode .settings-section {
            background: rgba(30, 30, 30, 0.5);
            border-color: rgba(255, 255, 255, 0.05);
        }

        .settings-section-title {
            font-size: 1.2rem;
            font-weight: var(--font-weight-bold);
            margin: 0 0 1.2rem 0;
            color: var(--color-text);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .settings-section-title::before {
            content: "";
            display: inline-block;
            width: 4px;
            height: 1.2em;
            background-color: var(--color-accent);
            border-radius: 2px;
        }

        .settings-option {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
            padding: 1rem;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: var(--border-radius);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .settings-option:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        html.dark-mode .settings-option {
            background-color: rgba(40, 40, 40, 0.5);
            border-color: rgba(255, 255, 255, 0.05);
        }

        html.dark-mode .settings-option:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
        }

        .settings-option:last-child {
            margin-bottom: 0;
        }

        .settings-option-label {
            font-size: 0.95rem;
            color: var(--color-text);
            font-weight: var(--font-weight-bold);
        }

        .settings-option-description {
            display: block;
            font-size: 0.8rem;
            color: var(--color-text-subtle);
            margin-top: 0.3rem;
            max-width: 80%;
        }

        /* Make shortcuts section full width */
        .settings-section.shortcuts-section {
            grid-column: 1 / -1;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.7);
        }

        html.dark-mode .settings-section.shortcuts-section {
            background: rgba(30, 30, 30, 0.7);
        }

        .shortcuts-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
            list-style: none;
            padding: 0;
        }

        .shortcut-item {
            background: rgba(255, 255, 255, 0.8);
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: var(--border-radius);
            padding: 1.2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            transition: all 0.2s ease;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.03);
        }

        html.dark-mode .shortcut-item {
            background: rgba(40, 40, 40, 0.8);
            border-color: rgba(255, 255, 255, 0.05);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .shortcut-info {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }

        .shortcut-key {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: var(--color-accent);
            color: white;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: var(--font-weight-bold);
            flex-shrink: 0;
        }

        .shortcut-details {
            flex: 1;
            min-width: 0;
        }

        .shortcut-name {
            font-size: 1rem;
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
            margin-bottom: 0.2rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .shortcut-url {
            font-size: 0.85rem;
            color: var(--color-text-subtle);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .shortcut-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .shortcut-edit-btn, .shortcut-delete-btn {
            flex: 1;
            padding: 0.6rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            background: rgba(255, 255, 255, 0.5);
            color: var(--color-text);
            font-size: 0.85rem;
            font-weight: var(--font-weight-bold);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.4rem;
        }

        .shortcut-edit-btn:hover {
            background: var(--color-accent);
            color: white;
            border-color: var(--color-accent);
        }

        .shortcut-delete-btn {
            color: #e53935;
            border-color: rgba(229, 57, 53, 0.2);
        }

        .shortcut-delete-btn:hover {
            background: #e53935;
            color: white;
            border-color: #e53935;
        }

        .shortcut-add-btn {
            width: 100%;
            padding: 1rem;
            border: 2px dashed rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            background: rgba(255, 255, 255, 0.3);
            color: var(--color-text-subtle);
            font-size: 0.9rem;
            font-weight: var(--font-weight-bold);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .shortcut-add-btn:hover {
            background: rgba(255, 255, 255, 0.5);
            border-color: var(--color-accent);
            color: var(--color-accent);
        }

        .shortcut-add-btn::before {
            content: "+";
            font-size: 1.2em;
        }

        /* Data management section styling */
        .data-management-section {
            grid-column: 1 / -1;
        }

        .data-management-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .data-btn {
            padding: 1rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            background: rgba(255, 255, 255, 0.5);
            color: var(--color-text);
            font-size: 0.9rem;
            font-weight: var(--font-weight-bold);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .data-btn:hover {
            background: var(--color-accent);
            color: white;
            border-color: var(--color-accent);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .export-btn::before {
            content: "↓";
        }

        .import-btn::before {
            content: "↑";
        }

        /* Save button container */
        .save-button-container {
            grid-column: 1 / -1;
            display: flex;
            justify-content: center;
            margin-top: 1rem;
        }

        .save-button {
            padding: 1rem 2.5rem;
            background: var(--color-accent);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-weight: var(--font-weight-bold);
            cursor: pointer;
            transition: all 0.2s ease;
            min-width: 200px;
        }

        .save-button:hover {
            background: var(--color-hover);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        html.dark-mode .save-button {
            background: #505050;
        }

        html.dark-mode .save-button:hover {
            background: #707070;
        }

        /* Toggle switch styling */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .3s;
            border-radius: 24px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            top: 3px;
            background-color: white;
            transition: .3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        input:checked + .toggle-slider {
            background-color: var(--color-accent);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }

        /* Disabled toggle styling */
        .toggle-switch input:disabled + .toggle-slider {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .toggle-switch input:disabled + .toggle-slider:before {
            cursor: not-allowed;
        }

        /* Disabled toggle container styling */
        .toggle-switch:has(input:disabled) {
            opacity: 0.5;
        }

        /* Fallback for browsers that don't support :has() */
        .toggle-switch.disabled {
            opacity: 0.5;
        }

        .toggle-switch.disabled .toggle-slider {
            cursor: not-allowed;
        }

        /* Select styling */
        .settings-select {
            padding: 0.7rem 1rem;
            font-size: 0.9rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            background-color: rgba(255, 255, 255, 0.7);
            color: var(--color-text);
            transition: all 0.2s ease;
            width: 100%;
            box-sizing: border-box;
        }

        .settings-select:focus {
            outline: none;
            border-color: var(--color-accent);
            box-shadow: 0 0 0 2px rgba(var(--color-accent-rgb), 0.1);
        }

        html.dark-mode .settings-select {
            background-color: rgba(40, 40, 40, 0.7);
            border-color: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
        }

        /* Shortcut editor modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-speed);
            backdrop-filter: blur(3px);
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--color-background);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(20px);
            transition: transform var(--transition-speed);
        }

        html.dark-mode .modal-content {
            background-color: #222;
        }

        .modal-overlay.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: var(--font-weight-bold);
            margin: 0;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--color-text-subtle);
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-label {
            display: block;
            font-size: 0.85rem;
            margin-bottom: 0.3rem;
            color: var(--color-text);
        }

        html.dark-mode .form-label {
            color: #e0e0e0;
        }

        .form-input {
            padding: 0.7rem 1rem;
            font-size: 0.9rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            background-color: rgba(255, 255, 255, 0.7);
            color: var(--color-text);
            transition: all 0.2s ease;
            width: 100%;
            box-sizing: border-box;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--color-accent);
            box-shadow: 0 0 0 2px rgba(var(--color-accent-rgb), 0.1);
        }

        html.dark-mode .form-input {
            background-color: rgba(40, 40, 40, 0.7);
            border-color: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
        }

        .form-input.key-input {
            width: 3rem;
            text-align: center;
            text-transform: lowercase;
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
            margin-top: 1.5rem;
        }

        .modal-btn {
            padding: 0.5rem 1rem;
            font-family: var(--font-family);
            font-size: 0.85rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all var(--transition-speed);
        }

        .modal-btn-cancel {
            background-color: transparent;
            border: 1px solid rgba(0, 0, 0, 0.1);
            color: var(--color-text);
        }

        html.dark-mode .modal-btn-cancel {
            border-color: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
        }

        .modal-btn-cancel:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        html.dark-mode .modal-btn-cancel:hover {
            background-color: rgba(255, 255, 255, 0.05);
        }

        .modal-btn-save {
            background-color: var(--color-accent);
            border: none;
            color: white;
        }

        html.dark-mode .modal-btn-save {
            background-color: #505050;
        }

        .modal-btn-save:hover {
            background-color: var(--color-hover);
        }

        html.dark-mode .modal-btn-save:hover {
            background-color: #707070;
        }

        /* Import input styling */
        .import-input {
            display: none;
        }

        /* Import file modal */
        .import-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all var(--transition-speed);
        }

        .import-modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .import-modal-content {
            background-color: var(--color-background);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(20px);
            transition: transform var(--transition-speed);
        }

        html.dark-mode .import-modal-content {
            background-color: #222;
        }

        .import-modal-overlay.active .import-modal-content {
            transform: translateY(0);
        }

        .import-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .import-modal-title {
            font-size: 1.2rem;
            font-weight: var(--font-weight-bold);
            margin: 0;
        }

        .import-modal-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--color-text-subtle);
        }

        .import-text-area {
            width: 100%;
            min-height: 150px;
            padding: 0.8rem;
            font-family: var(--font-family);
            font-size: 0.85rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            background-color: rgba(255, 255, 255, 0.7);
            color: var(--color-text);
            box-sizing: border-box;
            margin-bottom: 1rem;
            resize: vertical;
        }

        html.dark-mode .import-text-area {
            background-color: rgba(40, 40, 40, 0.7);
            border-color: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
        }

        .import-text-area:focus {
            outline: none;
            border-color: var(--color-accent);
        }

        .import-modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        .import-error {
            color: #e53935;
            font-size: 0.85rem;
            margin-top: 0.5rem;
            display: none;
        }

        .import-error.active {
            display: block;
        }

        /* Import file container styling */
        .import-file-container {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .import-file-input {
            display: none;
        }

        .import-file-label {
            padding: 0.5rem 1rem;
            background-color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            cursor: pointer;
            font-family: var(--font-family);
            font-size: 0.85rem;
            color: var(--color-text);
            transition: all var(--transition-speed);
        }

        .import-file-label:hover {
            background-color: rgba(255, 255, 255, 0.9);
        }

        html.dark-mode .import-file-label {
            background-color: rgba(40, 40, 40, 0.7);
            border-color: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
        }

        html.dark-mode .import-file-label:hover {
            background-color: rgba(60, 60, 60, 0.9);
        }

        .import-file-name {
            margin-left: 0.5rem;
            font-size: 0.85rem;
            color: var(--color-text-subtle);
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* Import divider styling */
        .import-divider {
            text-align: center;
            margin: 1rem 0;
            position: relative;
        }

        .import-divider:before {
            content: "";
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 1px;
            background-color: rgba(0, 0, 0, 0.1);
            z-index: 0;
        }

        html.dark-mode .import-divider:before {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .import-divider span {
            position: relative;
            padding: 0 1rem;
            background-color: var(--color-background);
            color: var(--color-text-subtle);
            font-size: 0.85rem;
            z-index: 1;
        }

        /* Color picker styling */
        .color-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .color-option {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .color-option-label {
            font-size: 0.9rem;
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
        }

        .color-option-description {
            font-size: 0.8rem;
            color: var(--color-text-subtle);
            margin-bottom: 0.5rem;
        }

        .color-picker-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .color-picker {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-color: transparent;
            width: 50px;
            height: 50px;
            border: none;
            cursor: pointer;
            padding: 0;
        }

        .color-picker::-webkit-color-swatch-wrapper {
            padding: 0;
        }

        .color-picker::-webkit-color-swatch {
            border: 2px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        html.dark-mode .color-picker::-webkit-color-swatch {
            border-color: rgba(255, 255, 255, 0.1);
        }

        .color-picker-input {
            flex: 1;
            padding: 0.7rem 1rem;
            font-size: 0.9rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            background-color: rgba(255, 255, 255, 0.7);
            color: var(--color-text);
        }

        html.dark-mode .color-picker-input {
            background-color: rgba(40, 40, 40, 0.7);
            border-color: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
        }

        .color-reset-btn {
            padding: 0.5rem 1rem;
            background: rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            color: var(--color-text);
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .color-reset-btn:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        html.dark-mode .color-reset-btn {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.1);
            color: #e0e0e0;
        }

        html.dark-mode .color-reset-btn:hover {
            background: rgba(255, 255, 255, 0.15);
        }

        .color-preview {
            width: 100%;
            height: 100px;
            border-radius: var(--border-radius);
            margin-top: 1rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            background-image: linear-gradient(135deg, var(--preview-background-color, #f8f5e6), var(--preview-background-secondary-color, #f2edd0));
            position: relative;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        html.dark-mode .color-preview {
            border-color: rgba(255, 255, 255, 0.1);
        }

        .preview-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--preview-text-color, #222222);
            font-weight: var(--font-weight-bold);
            font-size: 1rem;
        }

        .preview-accent {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 50px;
            height: 20px;
            background-color: var(--preview-accent-color, #333333);
            border-radius: 4px;
        }

        /* RSS Feeds Settings Styles */
        .rss-feeds-container {
            margin-top: 1rem;
        }
        
        .rss-feeds-textarea {
            width: 90%;
            height: 120px;
            padding: 0.75rem;
            font-family: var(--font-family);
            font-size: 0.9rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            resize: vertical;
            background-color: rgba(255, 255, 255, 0.7);
            transition: border-color 0.2s ease;
        }
        
        .dark-mode .rss-feeds-textarea {
            background-color: rgba(30, 30, 30, 0.7);
            border-color: rgba(255, 255, 255, 0.1);
            color: var(--color-text);
        }
        
        .rss-feeds-textarea:focus {
            outline: none;
            border-color: var(--color-accent);
        }
        
        .rss-feeds-suggestions {
            margin-top: 1rem;
        }
        
        .rss-feeds-suggestions h3 {
            font-size: 0.9rem;
            margin: 0 0 0.5rem 0;
            font-weight: 500;
        }
        
        .suggestion-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .suggestion-btn {
            background-color: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: var(--border-radius);
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .dark-mode .suggestion-btn {
            background-color: rgba(50, 50, 50, 0.5);
            border-color: rgba(255, 255, 255, 0.05);
        }
        
        .suggestion-btn:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }
        
        .dark-mode .suggestion-btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        /* Command Suggestions Management section styling */
        .suggestions-manager {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .command-selector {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .suggestions-editor {
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(0, 0, 0, 0.05);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .dark-mode .suggestions-editor {
            background: rgba(40, 40, 40, 0.5);
            border-color: rgba(255, 255, 255, 0.05);
        }

        .suggestions-current {
            margin-bottom: 1.5rem;
        }

        .suggestions-textarea {
            width: 100%;
            min-height: 120px;
            padding: 1rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            background: rgba(255, 255, 255, 0.7);
            color: var(--color-text);
            font-family: inherit;
            font-size: 0.9rem;
            line-height: 1.5;
            resize: vertical;
            transition: all 0.2s ease;
        }

        .dark-mode .suggestions-textarea {
            background: rgba(30, 30, 30, 0.7);
            border-color: rgba(255, 255, 255, 0.1);
            color: var(--color-text);
        }

        .suggestions-textarea:focus {
            outline: none;
            border-color: var(--color-accent);
            box-shadow: 0 0 0 2px rgba(var(--color-accent), 0.2);
        }

        .suggestions-actions {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .suggestion-save-btn,
        .suggestion-clear-btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            font-weight: var(--font-weight-bold);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .suggestion-save-btn {
            background: #4CAF50;
            color: white;
        }

        .suggestion-save-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
        }

        .suggestion-clear-btn {
            background: #f44336;
            color: white;
        }

        .suggestion-clear-btn:hover {
            background: #da190b;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
        }

        .suggestions-help {
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding-top: 1.5rem;
        }

        .dark-mode .suggestions-help {
            border-top-color: rgba(255, 255, 255, 0.1);
        }

        .suggestions-help h4 {
            margin: 0 0 1rem 0;
            font-size: 0.9rem;
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
        }

        .quick-suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .quick-suggestion-btn {
            background-color: rgba(33, 150, 243, 0.1);
            border: 1px solid rgba(33, 150, 243, 0.3);
            border-radius: var(--border-radius);
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
            color: var(--color-text);
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .quick-suggestion-btn:hover {
            background-color: rgba(33, 150, 243, 0.2);
            transform: translateY(-1px);
        }

        .dark-mode .quick-suggestion-btn {
            background-color: rgba(33, 150, 243, 0.2);
            border-color: rgba(33, 150, 243, 0.4);
        }

        .dark-mode .quick-suggestion-btn:hover {
            background-color: rgba(33, 150, 243, 0.3);
        }

        /* GitHub Sync section styling */
        .sync-section {
            grid-column: 1 / -1;
        }

        .sync-status {
            background: rgba(255, 255, 255, 0.5);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        html.dark-mode .sync-status {
            background: rgba(40, 40, 40, 0.7);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .sync-status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .sync-status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ccc;
            transition: background-color 0.3s ease;
        }

        .sync-status-dot.enabled {
            background: #4CAF50;
        }

        .sync-status-dot.syncing {
            background: #FF9800;
            animation: pulse 1.5s infinite;
        }

        .sync-status-dot.error {
            background: #F44336;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .sync-status-text {
            font-weight: var(--font-weight-bold);
            color: var(--color-text);
        }

        .sync-last-update {
            font-size: 0.85rem;
            color: var(--color-text-subtle);
        }

        .sync-controls {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .sync-token-section {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .token-input-container {
            position: relative;
            display: flex;
            align-items: center;
        }

        .token-input-container .form-input {
            padding-right: 3rem;
        }

        .token-toggle-btn {
            position: absolute;
            right: 0.5rem;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            padding: 0.25rem;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }

        .token-toggle-btn:hover {
            background: rgba(0, 0, 0, 0.1);
        }

        html.dark-mode .token-toggle-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .sync-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .sync-btn {
            padding: 0.8rem 1.2rem;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            background: rgba(255, 255, 255, 0.5);
            color: var(--color-text);
            font-size: 0.9rem;
            font-weight: var(--font-weight-bold);
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .sync-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .sync-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .enable-btn {
            background: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }

        .enable-btn:hover:not(:disabled) {
            background: #45a049;
        }

        .disable-btn {
            background: #F44336;
            color: white;
            border-color: #F44336;
        }

        .disable-btn:hover:not(:disabled) {
            background: #da190b;
        }

        .manual-btn {
            background: #2196F3;
            color: white;
            border-color: #2196F3;
        }

        .manual-btn:hover:not(:disabled) {
            background: #0b7dda;
        }

        .share-btn {
            background: #FF9800;
            color: white;
            border-color: #FF9800;
        }

        .share-btn:hover:not(:disabled) {
            background: #e68900;
        }

        .sync-info {
            background: rgba(255, 255, 255, 0.3);
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: var(--border-radius);
            padding: 1rem;
            font-size: 0.85rem;
        }

        html.dark-mode .sync-info {
            background: rgba(40, 40, 40, 0.5);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .sync-info-item {
            margin-bottom: 0.5rem;
        }

        .sync-info-item:last-child {
            margin-bottom: 0;
        }

        /* Save button container */
    </style>
</head>
<body>
    <a href="/home" class="back-link">Back to Home</a>
    
    <div class="settings-container">
        <div class="settings-header">
            <div class="settings-header-content">
            <h1 class="settings-title">Settings</h1>
            <p class="settings-description">Customize your homepage experience</p>
            </div>
        </div>

        <div class="settings-section">
            <h2 class="settings-section-title">Appearance</h2>
            
            <div class="settings-option">
                <div>
                    <span class="settings-option-label">Dark mode</span>
                    <span class="settings-option-description">Switch between light and dark theme</span>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="dark-mode-setting">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <div class="settings-option">
                <div>
                    <span class="settings-option-label">Auto theme</span>
                    <span class="settings-option-description">Automatically switch theme based on system preference</span>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="auto-theme-setting">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <div class="settings-option">
                <div>
                    <span class="settings-option-label">Theme</span>
                    <span class="settings-option-description">Choose a design theme for your homepage</span>
                </div>
                <select id="theme-select" class="settings-select">
                    <option value="default">Default</option>
                    <option value="minimal">Minimal</option>
                    <option value="glass">Glass Modern</option>
                    <option value="ocean">Ocean</option>
                    <option value="swiss">Swiss</option>
                    <option value="neon">Neon</option>
                    <option value="retro">Retro</option>
                    <option value="brutalist">Brutalist</option>
                    <option value="gaming">Gaming</option>
                    <option value="cyberpunk">Cyberpunk</option>
                    <option value="bauhaus">Bauhaus</option>
                    <option value="vaporwave">Vaporwave</option>
                    <option value="nordic">Nordic</option>
                    <option value="mac">Mac</option>
                    <option value="custom">Custom</option>
                </select>
            </div>

            <div class="settings-option">
                <div>
                    <span class="settings-option-label">Corner Text</span>
                    <span class="settings-option-description">Text displayed in the bottom right corner</span>
                </div>
                <input type="text" id="corner-text-setting" class="settings-select" placeholder="Enter corner text">
            </div>
        </div>
        
        <!-- New separate section for color customization -->
        <div class="settings-section" id="colors-section" style="display: none;">
            <h2 class="settings-section-title">Color Customization</h2>
            <p class="settings-option-description" style="margin-bottom: 1rem;">
                Customize the colors of your homepage. Changes will be applied on top of your selected theme.
            </p>
            
            <div class="settings-option">
                <div>
                    <span class="settings-option-label">Use Custom Colors</span>
                    <span class="settings-option-description">Enable to use your custom colors instead of theme defaults</span>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="custom-colors-setting">
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <div id="custom-colors-container">
                <div class="color-options">
                    <div class="color-option">
                        <span class="color-option-label">Background Color</span>
                        <span class="color-option-description">Main background color</span>
                        <div class="color-picker-container">
                            <input type="color" id="background-color" class="color-picker">
                            <input type="text" id="background-color-text" class="color-picker-input" placeholder="#f8f5e6">
                        </div>
                    </div>
                    
                    <div class="color-option">
                        <span class="color-option-label">Background Secondary</span>
                        <span class="color-option-description">Secondary color for gradient</span>
                        <div class="color-picker-container">
                            <input type="color" id="background-secondary-color" class="color-picker">
                            <input type="text" id="background-secondary-color-text" class="color-picker-input" placeholder="#f2edd0">
                        </div>
                    </div>
                </div>
                
                <div class="color-options">
                    <div class="color-option">
                        <span class="color-option-label">Text Color</span>
                        <span class="color-option-description">Main text color</span>
                        <div class="color-picker-container">
                            <input type="color" id="text-color" class="color-picker">
                            <input type="text" id="text-color-text" class="color-picker-input" placeholder="#222222">
                        </div>
                    </div>
                    
                    <div class="color-option">
                        <span class="color-option-label">Accent Color</span>
                        <span class="color-option-description">Color for buttons and highlights</span>
                        <div class="color-picker-container">
                            <input type="color" id="accent-color" class="color-picker">
                            <input type="text" id="accent-color-text" class="color-picker-input" placeholder="#333333">
                        </div>
                    </div>
                </div>
                
                <button type="button" id="reset-colors" class="color-reset-btn">Reset to Theme Colors</button>
                
                <div class="color-preview">
                    <div class="preview-text">Preview Text</div>
                    <div class="preview-accent"></div>
                </div>
            </div>
        </div>

        <div class="settings-section">
            <h2 class="settings-section-title">Behavior</h2>
            
            <div class="settings-option">
                <div>
                    <span class="settings-option-label">Open links in new tab</span>
                    <span class="settings-option-description">Controls whether links open in the same window or a new tab</span>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="new-tab-setting">
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>

        <!-- RSS Feeds configuration section -->
        <div class="settings-section">
            <h2 class="settings-section-title">RSS Feeds</h2>
            <p class="settings-option-description" style="margin-bottom: 1rem;">Configure RSS feeds to display in the news section</p>
            
            <div class="settings-option">
                <div>
                    <span class="settings-option-label">Enable RSS feeds</span>
                    <span class="settings-option-description">Show RSS feeds in the news section</span>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="rss-enabled-setting" checked>
                    <span class="toggle-slider"></span>
                </label>
            </div>
            
            <div class="rss-feeds-container" id="rss-feeds-container">
                <textarea id="rss-feeds" class="rss-feeds-textarea" placeholder="Enter RSS feed URLs, one per line
Example: https://news.ycombinator.com/rss
Example: https://www.theverge.com/rss/index.xml"></textarea>
                
                <div class="rss-feeds-suggestions">
                    <h3>Common RSS feeds:</h3>
                    <div class="suggestion-buttons">
                        <button class="suggestion-btn" data-url="https://hnrss.org/frontpage">Hacker News</button>
                        <button class="suggestion-btn" data-url="https://www.theverge.com/rss/index.xml">The Verge</button>
                        <button class="suggestion-btn" data-url="https://rss.nytimes.com/services/xml/rss/nyt/HomePage.xml">New York Times</button>
                        <button class="suggestion-btn" data-url="https://feeds.bbci.co.uk/news/world/rss.xml">BBC News</button>
                        <button class="suggestion-btn" data-url="https://feeds.arstechnica.com/arstechnica/index">Ars Technica</button>
                        <button class="suggestion-btn" data-url="https://www.repubblica.it/rss/homepage/rss2.0.xml">La Repubblica</button>
                        <button class="suggestion-btn" data-url="https://www.ilsole24ore.com/rss/italia.xml">Il Sole 24 Ore</button>
                        <button class="suggestion-btn" data-url="https://www.corriere.it/rss/homepage.xml">Corriere della Sera</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Command Suggestions section -->
        <div class="settings-section">
            <h2 class="settings-section-title">Command Suggestions</h2>
            <p class="settings-option-description" style="margin-bottom: 1rem;">Manage suggestions for your commands. Select a command to edit its suggestions.</p>
            
            <div class="suggestions-manager">
                <div class="command-selector">
                    <label for="command-select" class="form-label">Select Command:</label>
                    <select id="command-select" class="form-input">
                        <option value="">Choose a command...</option>
                    </select>
                </div>
                
                <div id="suggestions-editor" class="suggestions-editor" style="display: none;">
                    <div class="suggestions-current">
                        <label for="suggestions-textarea" class="form-label">Current Suggestions:</label>
                        <textarea id="suggestions-textarea" class="suggestions-textarea" 
                                placeholder="Enter suggestions one per line
Example: web.whatsapp.com
Example: anilist.co
Example: discord.com/app"></textarea>
                    </div>
                    
                    <div class="suggestions-actions">
                        <button type="button" id="save-suggestions" class="suggestion-save-btn">Save Suggestions</button>
                        <button type="button" id="clear-suggestions" class="suggestion-clear-btn">Clear All</button>
                    </div>
                    
                    <div class="suggestions-help">
                        <h4>Quick add common suggestions:</h4>
                        <div class="quick-suggestions">
                            <button class="quick-suggestion-btn" data-suggestion="web.whatsapp.com">WhatsApp Web</button>
                            <button class="quick-suggestion-btn" data-suggestion="discord.com/app">Discord</button>
                            <button class="quick-suggestion-btn" data-suggestion="anilist.co">AniList</button>
                            <button class="quick-suggestion-btn" data-suggestion="github.com">GitHub</button>
                            <button class="quick-suggestion-btn" data-suggestion="stackoverflow.com">Stack Overflow</button>
                            <button class="quick-suggestion-btn" data-suggestion="reddit.com">Reddit</button>
                            <button class="quick-suggestion-btn" data-suggestion="netflix.com">Netflix</button>
                            <button class="quick-suggestion-btn" data-suggestion="spotify.com">Spotify</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="settings-section shortcuts-section">
            <h2 class="settings-section-title">Shortcuts</h2>
            <p class="settings-option-description" style="margin-bottom: 1rem;">Manage your homepage shortcuts</p>
            
            <ul class="shortcuts-list" id="shortcuts-list">
                <!-- Shortcuts will be populated here by JavaScript -->
            </ul>
            
            <button type="button" id="add-shortcut" class="shortcut-add-btn">+ Add New Shortcut</button>
        </div>

        <!-- GitHub Sync Section -->
        <div class="settings-section sync-section">
            <h2 class="settings-section-title">GitHub Sync</h2>
            <p class="settings-option-description" style="margin-bottom: 1rem;">Synchronize your settings and shortcuts across devices using GitHub Gist</p>
            
            <div class="sync-status" id="sync-status">
                <div class="sync-status-indicator" id="sync-status-indicator">
                    <span class="sync-status-dot" id="sync-status-dot"></span>
                    <span class="sync-status-text" id="sync-status-text">Sync Disabled</span>
                </div>
                <div class="sync-last-update" id="sync-last-update"></div>
            </div>

            <div class="sync-controls">
                <div class="sync-token-section" id="sync-token-section">
                    <label for="github-token" class="form-label">GitHub Personal Access Token</label>
                    <div class="token-input-container">
                        <input type="password" id="github-token" class="form-input" placeholder="Enter your GitHub token with 'gist' permission">
                        <button type="button" id="toggle-token-visibility" class="token-toggle-btn">👁️</button>
                    </div>
                    <p class="settings-option-description" style="margin-top: 0.5rem; font-size: 0.85rem;">
                        Create a token at <a href="https://github.com/settings/tokens" target="_blank" style="color: var(--color-accent);">GitHub Settings</a> with 'gist' permission only.
                    </p>
                </div>

                <div class="sync-buttons">
                    <button type="button" id="enable-sync" class="sync-btn enable-btn">Enable Sync</button>
                    <button type="button" id="disable-sync" class="sync-btn disable-btn" style="display: none;">Disable Sync</button>
                    <button type="button" id="manual-sync" class="sync-btn manual-btn" style="display: none;">Manual Sync</button>
                    <button type="button" id="generate-sync-url" class="sync-btn share-btn" style="display: none;">Generate Share URL</button>
                </div>

                <div class="sync-info" id="sync-info" style="display: none;">
                    <div class="sync-info-item">
                        <strong>Gist ID:</strong> <span id="gist-id-display">-</span>
                    </div>
                    <div class="sync-info-item">
                        <strong>User ID:</strong> <span id="user-id-display">-</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="settings-section data-management-section">
            <h2 class="settings-section-title">Data Management</h2>
            <p class="settings-option-description" style="margin-bottom: 1rem;">Export or import your settings and shortcuts</p>
            
            <div class="data-management-buttons">
                <button type="button" id="export-settings" class="data-btn export-btn">Export Settings</button>
                <button type="button" id="import-settings" class="data-btn import-btn">Import Settings</button>
            </div>
        </div>

        <div class="save-button-container">
        <button type="button" id="save-settings" class="save-button">Save Settings</button>
        </div>
    </div>

    <!-- Shortcut Editor Modal -->
    <div class="modal-overlay" id="shortcut-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Add Shortcut</h3>
                <button type="button" class="modal-close" id="modal-close">&times;</button>
            </div>
            <form id="shortcut-form">
                <div class="form-group">
                    <label for="shortcut-key" class="form-label">Key (single character)</label>
                    <input type="text" id="shortcut-key" class="form-input key-input" maxlength="1" required>
                </div>
                <div class="form-group">
                    <label for="shortcut-name" class="form-label">Name</label>
                    <input type="text" id="shortcut-name" class="form-input" required>
                </div>
                <div class="form-group">
                    <label for="shortcut-url" class="form-label">URL</label>
                    <input type="url" id="shortcut-url" class="form-input" required>
                </div>
                <div class="modal-actions">
                    <button type="button" class="modal-btn modal-btn-cancel" id="modal-cancel">Cancel</button>
                    <button type="submit" class="modal-btn modal-btn-save">Save</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Import Settings Modal -->
    <div class="import-modal-overlay" id="import-modal">
        <div class="import-modal-content">
            <div class="import-modal-header">
                <h3 class="import-modal-title">Import Settings</h3>
                <button type="button" class="import-modal-close" id="import-modal-close">&times;</button>
            </div>
            <div>
                <p class="settings-option-description" style="margin-bottom: 1rem;">Upload your settings file or paste the JSON data below</p>
                
                <div class="import-file-container">
                    <input type="file" id="import-file-input" class="import-file-input" accept=".json">
                    <label for="import-file-input" class="import-file-label">Select JSON File</label>
                    <span id="import-file-name" class="import-file-name"></span>
                </div>
                
                <div class="import-divider">
                    <span>or</span>
                </div>
                
                <textarea id="import-data" class="import-text-area" placeholder="Paste JSON settings data here..."></textarea>
                <div id="import-error" class="import-error">Invalid data format. Please use a valid settings JSON file.</div>
            </div>
            <div class="import-modal-actions">
                <button type="button" class="modal-btn modal-btn-cancel" id="import-modal-cancel">Cancel</button>
                <button type="button" class="modal-btn modal-btn-save" id="import-modal-apply">Apply</button>
            </div>
        </div>
    </div>

    <script>
        // Theme definitions - same as in the widget to ensure consistency
        const THEMES = {
            default: {
                light: {
                    background: '#f8f5e6',
                    gradient: 'linear-gradient(135deg, #f8f5e6, #f2edd0)',
                    text: '#222222',
                    textSubtle: '#666666',
                    accent: '#333333',
                    hover: '#444444',
                    boxShadow: '0 1px 4px rgba(0, 0, 0, 0.03)'
                },
                dark: {
                    background: '#1a1a1a',
                    gradient: 'linear-gradient(135deg, #222, #333)',
                    text: '#e0e0e0',
                    textSubtle: '#a0a0a0',
                    accent: '#505050',
                    hover: '#707070',
                    boxShadow: '0 1px 4px rgba(0, 0, 0, 0.2)'
                }
            },
            minimal: {
                light: {
                    background: '#ffffff',
                    gradient: 'none',
                    text: '#000000',
                    textSubtle: '#999999',
                    accent: '#cccccc',
                    hover: '#eeeeee',
                    boxShadow: 'none',
                    borderRadius: '0',
                    borderWidth: '0',
                    fontFamily: '"Courier New", monospace',
                    fontSize: '12px',
                    commandsBackground: 'transparent',
                    commandsBorder: 'none',
                    commandsBoxShadow: 'none',
                    commandMaxWidth: '70rem',
                    keyColor: '#666666'
                },
                dark: {
                    background: '#000000',
                    gradient: 'none',
                    text: '#ffffff',
                    textSubtle: '#777777',
                    accent: '#333333',
                    hover: '#222222',
                    boxShadow: 'none',
                    borderRadius: '0',
                    borderWidth: '0',
                    fontFamily: '"Courier New", monospace',
                    fontSize: '12px',
                    commandsBackground: 'transparent',
                    commandsBorder: 'none',
                    commandsBoxShadow: 'none',
                    commandMaxWidth: '70rem',
                    keyColor: '#999999'
                }
            },
            swiss: {
                light: {
                    background: '#ffffff',
                    gradient: 'none',
                    text: '#111111',
                    textSubtle: '#666666',
                    accent: '#ff3b30',
                    hover: '#ff6651',
                    boxShadow: 'none',
                    borderRadius: '0',
                    borderWidth: '0',
                    fontFamily: '"Helvetica Neue", Arial, sans-serif',
                    fontSize: '13px',
                    fontWeight: '300',
                    commandsBackground: 'transparent',
                    commandsBorder: 'none',
                    commandsBoxShadow: 'none',
                    commandMaxWidth: '80rem',
                    keyColor: '#ff3b30',
                    nameSpacing: '0.05em',
                    gridLayout: 'true',
                    letterSpacing: '0.03em',
                    keyFontSize: '1.1em',
                    keyWeight: '700',
                    nameAfterHeight: '0',
                    nameHoverColor: '#ff3b30'
                },
                dark: {
                    background: '#000000',
                    gradient: 'none',
                    text: '#ffffff',
                    textSubtle: '#999999',
                    accent: '#ff3b30',
                    hover: '#ff6651',
                    boxShadow: 'none',
                    borderRadius: '0',
                    borderWidth: '0',
                    fontFamily: '"Helvetica Neue", Arial, sans-serif',
                    fontSize: '13px',
                    fontWeight: '300',
                    commandsBackground: 'transparent',
                    commandsBorder: 'none',
                    commandsBoxShadow: 'none',
                    commandMaxWidth: '80rem',
                    keyColor: '#ff3b30',
                    nameSpacing: '0.05em',
                    gridLayout: 'true',
                    letterSpacing: '0.03em',
                    keyFontSize: '1.1em',
                    keyWeight: '700',
                    nameAfterHeight: '0',
                    nameHoverColor: '#ff3b30',
                    cornerTextTransform: 'uppercase',
                    cornerTextSpacing: '0.1em',
                    cornerTextWeight: '400',
                    cornerTextSize: '0.65rem'
                }
            },
            glass: {
                light: {
                    background: 'rgba(255, 255, 255, 0.7)',
                    gradient: 'linear-gradient(135deg, #f5f7fa, #c3cfe2)',
                    text: '#334155',
                    textSubtle: '#64748b',
                    accent: '#3b82f6',
                    hover: '#60a5fa',
                    boxShadow: '0 4px 20px rgba(0, 0, 0, 0.05)',
                    borderRadius: '16px',
                    commandsBackground: 'rgba(255, 255, 255, 0.6)',
                    commandsBorder: '1px solid rgba(255, 255, 255, 0.2)',
                    commandsBoxShadow: '0 8px 32px rgba(0, 0, 0, 0.07)',
                    fontFamily: '"Inter", -apple-system, BlinkMacSystemFont, sans-serif',
                    fontSize: '14px',
                    keyColor: '#3b82f6',
                    commandMaxWidth: '60rem',
                    backdropFilter: 'blur(10px)',
                    cornerTextStyle: 'text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.6rem; font-weight: 500;',
                    dotSize: '6px',
                    dotOpacity: '0.7',
                    nameAfterHeight: '2px'
                },
                dark: {
                    background: 'rgba(15, 23, 42, 0.7)',
                    gradient: 'linear-gradient(135deg, #0f172a, #1e293b)',
                    text: '#e2e8f0',
                    textSubtle: '#94a3b8',
                    accent: '#38bdf8',
                    hover: '#7dd3fc',
                    boxShadow: '0 4px 20px rgba(0, 0, 0, 0.2)',
                    borderRadius: '16px',
                    commandsBackground: 'rgba(30, 41, 59, 0.5)',
                    commandsBorder: '1px solid rgba(255, 255, 255, 0.1)',
                    commandsBoxShadow: '0 8px 32px rgba(0, 0, 0, 0.2)',
                    fontFamily: '"Inter", -apple-system, BlinkMacSystemFont, sans-serif',
                    fontSize: '14px',
                    keyColor: '#38bdf8',
                    commandMaxWidth: '60rem',
                    backdropFilter: 'blur(10px)',
                    cornerTextStyle: 'text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.6rem; font-weight: 500;',
                    dotSize: '6px',
                    dotOpacity: '0.7',
                    nameAfterHeight: '2px'
                }
            },
            ocean: {
                light: {
                    background: '#e0f7fa',
                    gradient: 'linear-gradient(135deg, #e0f7fa, #80deea 50%, #4dd0e1)',
                    text: '#006064',
                    textSubtle: '#0097a7',
                    accent: '#00838f',
                    hover: '#006064',
                    boxShadow: '0 4px 14px rgba(0, 131, 143, 0.15)',
                    borderRadius: '12px',
                    commandsBackground: 'rgba(224, 247, 250, 0.8)',
                    commandsBorder: '1px solid rgba(129, 212, 250, 0.4)',
                    commandsBoxShadow: '0 6px 24px rgba(0, 131, 143, 0.1)',
                    fontFamily: '"Inter", -apple-system, BlinkMacSystemFont, sans-serif',
                    fontSize: '14px',
                    keyColor: '#00acc1',
                    commandMaxWidth: '55rem',
                    backdropFilter: 'blur(8px)',
                    cornerTextStyle: 'font-style: italic; letter-spacing: 0.05em; font-size: 0.7rem;',
                    dotSize: '8px',
                    dotOpacity: '0.8',
                    nameAfterHeight: '2px',
                    nameFont: '500',
                    commandsColumns: '3',
                    inputBackground: 'rgba(224, 247, 250, 0.9)',
                    inputBorder: '1px solid rgba(129, 212, 250, 0.5)',
                    inputShadow: '0 2px 10px rgba(0, 131, 143, 0.1)',
                    uiAnimation: 'true',
                    cornerTextOpacity: '0.85'
                },
                dark: {
                    background: '#002f35',
                    gradient: 'linear-gradient(135deg, #002f35, #00363a 50%, #004d40)',
                    text: '#e0f7fa',
                    textSubtle: '#80deea',
                    accent: '#26c6da',
                    hover: '#4dd0e1',
                    boxShadow: '0 4px 14px rgba(0, 172, 193, 0.2)',
                    borderRadius: '12px',
                    commandsBackground: 'rgba(0, 59, 66, 0.7)',
                    commandsBorder: '1px solid rgba(38, 198, 218, 0.2)',
                    commandsBoxShadow: '0 6px 24px rgba(0, 172, 193, 0.15)',
                    fontFamily: '"Inter", -apple-system, BlinkMacSystemFont, sans-serif',
                    fontSize: '14px',
                    keyColor: '#26c6da',
                    commandMaxWidth: '55rem',
                    backdropFilter: 'blur(8px)',
                    cornerTextStyle: 'font-style: italic; letter-spacing: 0.05em; font-size: 0.7rem;',
                    dotSize: '8px',
                    dotOpacity: '0.8',
                    nameAfterHeight: '2px',
                    nameFont: '500',
                    commandsColumns: '3',
                    inputBackground: 'rgba(0, 59, 66, 0.8)',
                    inputBorder: '1px solid rgba(38, 198, 218, 0.3)',
                    inputShadow: '0 2px 10px rgba(0, 172, 193, 0.15)',
                    uiAnimation: 'true',
                    cornerTextOpacity: '0.85'
                }
            },
            // New themes added below
            neon: {
                light: {
                    background: '#0f0f1a',
                    gradient: 'radial-gradient(circle at top right, rgba(120, 0, 255, 0.2), transparent), radial-gradient(circle at bottom left, rgba(0, 255, 255, 0.2), transparent)',
                    text: '#ffffff',
                    textSubtle: '#a0a0c0',
                    accent: '#ff00aa',
                    hover: '#ff4dcd',
                    boxShadow: '0 0 20px rgba(255, 0, 170, 0.3)',
                    borderRadius: '8px',
                    commandsBackground: 'rgba(15, 15, 30, 0.7)',
                    commandsBorder: '1px solid rgba(255, 0, 170, 0.3)',
                    commandsBoxShadow: '0 0 15px rgba(255, 0, 170, 0.2)',
                    fontFamily: '"Inter", -apple-system, BlinkMacSystemFont, sans-serif',
                    fontSize: '14px',
                    keyColor: '#ff00aa',
                    commandMaxWidth: '60rem',
                    backdropFilter: 'blur(5px)',
                    cornerTextStyle: 'letter-spacing: 0.05em; font-size: 0.7rem; font-weight: 400;',
                    dotSize: '6px',
                    dotOpacity: '0.9',
                    nameAfterHeight: '2px',
                    nameHoverColor: '#ff00aa',
                    uiAnimation: 'true',
                    cornerTextOpacity: '0.8',
                    textGlow: 'true',
                    textGlowColor: 'rgba(255, 0, 170, 0.7)',
                    keyHoverGlow: 'true'
                },
                dark: {
                    background: '#0a0a12',
                    gradient: 'radial-gradient(circle at top right, rgba(120, 0, 255, 0.3), transparent), radial-gradient(circle at bottom left, rgba(0, 255, 255, 0.3), transparent)',
                    text: '#ffffff',
                    textSubtle: '#a0a0c0',
                    accent: '#00eeff',
                    hover: '#4df4ff',
                    boxShadow: '0 0 20px rgba(0, 238, 255, 0.3)',
                    borderRadius: '8px',
                    commandsBackground: 'rgba(10, 10, 20, 0.7)',
                    commandsBorder: '1px solid rgba(0, 238, 255, 0.3)',
                    commandsBoxShadow: '0 0 15px rgba(0, 238, 255, 0.2)',
                    fontFamily: '"Inter", -apple-system, BlinkMacSystemFont, sans-serif',
                    fontSize: '14px',
                    keyColor: '#00eeff',
                    commandMaxWidth: '60rem',
                    backdropFilter: 'blur(5px)',
                    cornerTextStyle: 'letter-spacing: 0.05em; font-size: 0.7rem; font-weight: 400;',
                    dotSize: '6px',
                    dotOpacity: '0.9',
                    nameAfterHeight: '2px',
                    nameHoverColor: '#00eeff',
                    uiAnimation: 'true',
                    cornerTextOpacity: '0.8',
                    textGlow: 'true',
                    textGlowColor: 'rgba(0, 238, 255, 0.7)',
                    keyHoverGlow: 'true'
                }
            },
            retro: {
                light: {
                    background: '#faf4d4',
                    gradient: 'linear-gradient(135deg, #faf4d4, #f9c58d)',
                    text: '#562349',
                    textSubtle: '#813772',
                    accent: '#ca5fa6',
                    hover: '#dc92c3',
                    boxShadow: '3px 3px 0 rgba(86, 35, 73, 0.2)',
                    borderRadius: '0px',
                    commandsBackground: 'rgba(250, 244, 212, 0.9)',
                    commandsBorder: '2px solid #562349',
                    commandsBoxShadow: '4px 4px 0 rgba(86, 35, 73, 0.2)',
                    fontFamily: '"Space Grotesk", "Courier New", monospace',
                    fontSize: '14px',
                    keyColor: '#ca5fa6',
                    commandMaxWidth: '60rem',
                    cornerTextStyle: 'font-family: "Space Grotesk", monospace; letter-spacing: 0.1em; font-size: 0.7rem; font-weight: 500;',
                    dotSize: '8px',
                    dotOpacity: '0.9',
                    nameAfterHeight: '0px',
                    borderStyle: 'solid',
                    borderWidth: '2px',
                    borderColor: '#562349',
                    uiAnimation: 'true',
                    fontWeight: '500',
                    keyFontSize: '1.2em'
                },
                dark: {
                    background: '#2c1320',
                    gradient: 'linear-gradient(135deg, #2c1320, #42253b)',
                    text: '#f9c58d',
                    textSubtle: '#dd9e6c',
                    accent: '#f4b674',
                    hover: '#f7d4a6',
                    boxShadow: '3px 3px 0 rgba(244, 182, 116, 0.2)',
                    borderRadius: '0px',
                    commandsBackground: 'rgba(44, 19, 32, 0.9)',
                    commandsBorder: '2px solid #f4b674',
                    commandsBoxShadow: '4px 4px 0 rgba(244, 182, 116, 0.2)',
                    fontFamily: '"Space Grotesk", "Courier New", monospace',
                    fontSize: '14px',
                    keyColor: '#f4b674',
                    commandMaxWidth: '60rem',
                    cornerTextStyle: 'font-family: "Space Grotesk", monospace; letter-spacing: 0.1em; font-size: 0.7rem; font-weight: 500;',
                    dotSize: '8px',
                    dotOpacity: '0.9',
                    nameAfterHeight: '0px',
                    borderStyle: 'solid',
                    borderWidth: '2px',
                    borderColor: '#f4b674',
                    uiAnimation: 'true',
                    fontWeight: '500',
                    keyFontSize: '1.2em'
                }
            },
            brutalist: {
                light: {
                    background: '#ffffff',
                    gradient: 'none',
                    text: '#000000',
                    textSubtle: '#444444',
                    accent: '#000000',
                    hover: '#333333',
                    boxShadow: 'none',
                    borderRadius: '0',
                    commandsBackground: 'transparent',
                    commandsBorder: '1px solid #000000',
                    commandsBoxShadow: 'none',
                    fontFamily: '"Helvetica Neue", Arial, sans-serif',
                    fontSize: '16px',
                    fontWeight: '400',
                    keyColor: '#000000',
                    commandMaxWidth: '100%',
                    cornerTextStyle: 'text-transform: uppercase; letter-spacing: 0.05em; font-size: 0.8rem; font-weight: 700;',
                    nameAfterHeight: '0',
                    gridLayout: 'true',
                    layoutType: 'grid',
                    borderStyle: 'solid',
                    borderWidth: '1px',
                    borderColor: '#000000',
                    commandPadding: '0.5rem'
                },
                dark: {
                    background: '#000000',
                    gradient: 'none',
                    text: '#ffffff',
                    textSubtle: '#bbbbbb',
                    accent: '#ffffff',
                    hover: '#cccccc',
                    boxShadow: 'none',
                    borderRadius: '0',
                    commandsBackground: 'transparent',
                    commandsBorder: '1px solid #ffffff',
                    commandsBoxShadow: 'none',
                    fontFamily: '"Helvetica Neue", Arial, sans-serif',
                    fontSize: '16px',
                    fontWeight: '400',
                    keyColor: '#ffffff',
                    commandMaxWidth: '100%',
                    cornerTextStyle: 'text-transform: uppercase; letter-spacing: 0.05em; font-size: 0.8rem; font-weight: 700;',
                    nameAfterHeight: '0',
                    gridLayout: 'true',
                    layoutType: 'grid',
                    borderStyle: 'solid',
                    borderWidth: '1px',
                    borderColor: '#ffffff',
                    commandPadding: '0.5rem'
                }
            },
            gaming: {
                light: {
                    background: '#121212',
                    gradient: 'linear-gradient(135deg, #121212, #1a1a1a)',
                    text: '#e0e0e0',
                    textSubtle: '#a0a0a0',
                    accent: '#00ff66',
                    hover: '#33ff85',
                    boxShadow: '0 0 10px rgba(0, 255, 102, 0.2)',
                    borderRadius: '4px',
                    commandsBackground: 'rgba(26, 26, 26, 0.9)',
                    commandsBorder: '1px solid rgba(0, 255, 102, 0.3)',
                    commandsBoxShadow: '0 0 15px rgba(0, 255, 102, 0.15)',
                    fontFamily: '"Exo 2", "Inter", sans-serif',
                    fontSize: '14px',
                    keyColor: '#00ff66',
                    commandMaxWidth: '65rem',
                    cornerTextStyle: 'font-family: "Exo 2", sans-serif; text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.7rem; font-weight: 600;',
                    dotSize: '5px',
                    dotOpacity: '0.9',
                    nameAfterHeight: '1px',
                    uiAnimation: 'true',
                    keyFontSize: '1em',
                    keyStyle: 'border: 1px solid rgba(0, 255, 102, 0.3); padding: 2px 6px; border-radius: 2px;'
                },
                dark: {
                    background: '#0a0a0a',
                    gradient: 'linear-gradient(135deg, #0a0a0a, #151515)',
                    text: '#e0e0e0',
                    textSubtle: '#a0a0a0',
                    accent: '#00ff66',
                    hover: '#33ff85',
                    boxShadow: '0 0 10px rgba(0, 255, 102, 0.2)',
                    borderRadius: '4px',
                    commandsBackground: 'rgba(15, 15, 15, 0.9)',
                    commandsBorder: '1px solid rgba(0, 255, 102, 0.3)',
                    commandsBoxShadow: '0 0 15px rgba(0, 255, 102, 0.15)',
                    fontFamily: '"Exo 2", "Inter", sans-serif',
                    fontSize: '14px',
                    keyColor: '#00ff66',
                    commandMaxWidth: '65rem',
                    cornerTextStyle: 'font-family: "Exo 2", sans-serif; text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.7rem; font-weight: 600;',
                    dotSize: '5px',
                    dotOpacity: '0.9',
                    nameAfterHeight: '1px',
                    uiAnimation: 'true',
                    keyFontSize: '1em',
                    keyStyle: 'border: 1px solid rgba(0, 255, 102, 0.3); padding: 2px 6px; border-radius: 2px;'
                }
            },
            cyberpunk: {
                light: {
                    background: '#050023',
                    gradient: 'radial-gradient(circle at top right, rgba(255, 0, 170, 0.2), transparent), radial-gradient(circle at bottom left, rgba(0, 255, 255, 0.2), transparent)',
                    text: '#ffffff',
                    textSubtle: '#9e9ebf',
                    accent: '#ff2a6d',
                    hover: '#ff5a8d',
                    boxShadow: '0 0 25px rgba(255, 42, 109, 0.5)',
                    borderRadius: '2px',
                    commandsBackground: 'rgba(10, 10, 40, 0.7)',
                    commandsBorder: '1px solid rgba(255, 42, 109, 0.3)',
                    commandsBoxShadow: '0 0 20px rgba(255, 42, 109, 0.3)',
                    fontFamily: '"Rajdhani", "Inter", sans-serif',
                    fontSize: '15px',
                    keyColor: '#ff2a6d',
                    commandMaxWidth: '65rem',
                    cornerTextStyle: 'font-family: "Rajdhani", sans-serif; text-transform: uppercase; letter-spacing: 0.2em; font-size: 0.7rem; font-weight: 600;',
                    dotSize: '4px',
                    dotOpacity: '0.9',
                    nameAfterHeight: '2px',
                    uiAnimation: 'true',
                    keyFontSize: '1em',
                    keyStyle: 'border: 1px solid rgba(255, 42, 109, 0.5); padding: 2px 6px; background: rgba(255, 42, 109, 0.1);',
                    textGlow: 'true',
                    textGlowColor: 'rgba(255, 42, 109, 0.7)',
                    scanlines: 'true',
                    nameHoverColor: '#05d9e8',
                    glitchEffect: 'true'
                },
                dark: {
                    background: '#0d0221',
                    gradient: 'radial-gradient(circle at top right, rgba(255, 0, 170, 0.2), transparent), radial-gradient(circle at bottom left, rgba(0, 255, 255, 0.2), transparent)',
                    text: '#ffffff',
                    textSubtle: '#9e9ebf',
                    accent: '#05d9e8',
                    hover: '#65fdf0',
                    boxShadow: '0 0 25px rgba(5, 217, 232, 0.5)',
                    borderRadius: '2px',
                    commandsBackground: 'rgba(13, 2, 33, 0.7)',
                    commandsBorder: '1px solid rgba(5, 217, 232, 0.3)',
                    commandsBoxShadow: '0 0 20px rgba(5, 217, 232, 0.3)',
                    fontFamily: '"Rajdhani", "Inter", sans-serif',
                    fontSize: '15px',
                    keyColor: '#05d9e8',
                    commandMaxWidth: '65rem',
                    cornerTextStyle: 'font-family: "Rajdhani", sans-serif; text-transform: uppercase; letter-spacing: 0.2em; font-size: 0.7rem; font-weight: 600;',
                    dotSize: '4px',
                    dotOpacity: '0.9',
                    nameAfterHeight: '2px',
                    uiAnimation: 'true',
                    keyFontSize: '1em',
                    keyStyle: 'border: 1px solid rgba(5, 217, 232, 0.5); padding: 2px 6px; background: rgba(5, 217, 232, 0.1);',
                    textGlow: 'true',
                    textGlowColor: 'rgba(5, 217, 232, 0.7)',
                    scanlines: 'true',
                    nameHoverColor: '#ff2a6d',
                    glitchEffect: 'true'
                }
            },
            bauhaus: {
                light: {
                    background: '#ffffff',
                    gradient: 'none',
                    text: '#000000',
                    textSubtle: '#333333',
                    accent: '#e53935',
                    hover: '#f44336',
                    boxShadow: 'none',
                    borderRadius: '0',
                    commandsBackground: 'rgba(255, 255, 255, 0.9)',
                    commandsBorder: '2px solid #000000',
                    commandsBoxShadow: 'none',
                    fontFamily: '"Futura PT", "Helvetica Neue", Arial, sans-serif',
                    fontSize: '16px',
                    keyColor: '#e53935',
                    commandMaxWidth: '100%',
                    cornerTextStyle: 'font-family: "Futura PT", sans-serif; text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.8rem; font-weight: 700;',
                    nameAfterHeight: '0',
                    gridLayout: 'true',
                    layoutType: 'grid',
                    borderStyle: 'solid',
                    borderWidth: '2px',
                    borderColor: '#000000',
                    keyStyle: 'background-color: #e53935; color: white; border-radius: 0; width: 40px; height: 40px;',
                    nameHoverColor: '#e53935',
                    geometricElements: 'true',
                    transformAngle: '7deg',
                    primaryColor: '#e53935',
                    secondaryColor: '#2196f3',
                    tertiaryColor: '#ffeb3b'
                },
                dark: {
                    background: '#121212',
                    gradient: 'none',
                    text: '#ffffff',
                    textSubtle: '#cccccc',
                    accent: '#e53935',
                    hover: '#f44336',
                    boxShadow: 'none',
                    borderRadius: '0',
                    commandsBackground: 'rgba(30, 30, 30, 0.9)',
                    commandsBorder: '2px solid #ffffff',
                    commandsBoxShadow: 'none',
                    fontFamily: '"Futura PT", "Helvetica Neue", Arial, sans-serif',
                    fontSize: '16px',
                    keyColor: '#e53935',
                    commandMaxWidth: '100%',
                    cornerTextStyle: 'font-family: "Futura PT", sans-serif; text-transform: uppercase; letter-spacing: 0.1em; font-size: 0.8rem; font-weight: 700;',
                    nameAfterHeight: '0',
                    gridLayout: 'true',
                    layoutType: 'grid',
                    borderStyle: 'solid',
                    borderWidth: '2px',
                    borderColor: '#ffffff',
                    keyStyle: 'background-color: #e53935; color: white; border-radius: 0; width: 40px; height: 40px;',
                    nameHoverColor: '#e53935',
                    geometricElements: 'true',
                    transformAngle: '7deg',
                    primaryColor: '#e53935',
                    secondaryColor: '#2196f3',
                    tertiaryColor: '#ffeb3b'
                }
            },
            vaporwave: {
                light: {
                    background: '#f2c6de',
                    gradient: 'linear-gradient(135deg, #f2c6de, #c2f5e9)',
                    text: '#000b8e',
                    textSubtle: '#671e75',
                    accent: '#ff00f2',
                    hover: '#ff66f5',
                    boxShadow: '0 6px 20px rgba(103, 30, 117, 0.3)',
                    borderRadius: '0',
                    commandsBackground: 'rgba(242, 198, 222, 0.7)',
                    commandsBorder: '2px solid #ff00f2',
                    commandsBoxShadow: '0 8px 24px rgba(255, 0, 242, 0.25)',
                    fontFamily: '"VT323", "Press Start 2P", monospace',
                    fontSize: '16px',
                    keyColor: '#ff00f2',
                    commandMaxWidth: '70rem',
                    cornerTextStyle: 'font-family: "VT323", monospace; font-size: 1rem;',
                    dotSize: '10px',
                    dotOpacity: '0.9',
                    nameAfterHeight: '0',
                    preserve3d: 'true',
                    gridGap: '1.5rem',
                    borderStyle: 'solid',
                    borderWidth: '2px',
                    borderColor: '#ff00f2',
                    keyStyle: 'box-shadow: 2px 2px 0 #000b8e; transform: translateZ(10px);',
                    nameHoverColor: '#ff00f2',
                    gridColumns: '2',
                    scanlines: 'true',
                    floatItems: 'true',
                    driftAnimation: 'true',
                    sunsetGradient: 'true',
                    pixelFont: 'true'
                },
                dark: {
                    background: '#08012e',
                    gradient: 'linear-gradient(135deg, #08012e, #290b45)',
                    text: '#ff00f2',
                    textSubtle: '#c78df0',
                    accent: '#00fad9',
                    hover: '#66fceb',
                    boxShadow: '0 6px 20px rgba(0, 250, 217, 0.3)',
                    borderRadius: '0',
                    commandsBackground: 'rgba(8, 1, 46, 0.7)',
                    commandsBorder: '2px solid #00fad9',
                    commandsBoxShadow: '0 8px 24px rgba(0, 250, 217, 0.25)',
                    fontFamily: '"VT323", "Press Start 2P", monospace',
                    fontSize: '16px',
                    keyColor: '#00fad9',
                    commandMaxWidth: '70rem',
                    cornerTextStyle: 'font-family: "VT323", monospace; font-size: 1rem;',
                    dotSize: '10px',
                    dotOpacity: '0.9',
                    nameAfterHeight: '0',
                    preserve3d: 'true',
                    gridGap: '1.5rem',
                    borderStyle: 'solid',
                    borderWidth: '2px',
                    borderColor: '#00fad9',
                    keyStyle: 'box-shadow: 2px 2px 0 #ff00f2; transform: translateZ(10px);',
                    nameHoverColor: '#00fad9',
                    gridColumns: '2',
                    scanlines: 'true',
                    floatItems: 'true',
                    driftAnimation: 'true',
                    sunsetGradient: 'true',
                    pixelFont: 'true'
                }
            },
            nordic: {
                light: {
                    background: '#ffffff',
                    gradient: 'linear-gradient(135deg, #ffffff, #f7f9fc)',
                    text: '#2e3440',
                    textSubtle: '#4c566a',
                    accent: '#5e81ac',
                    hover: '#81a1c1',
                    boxShadow: '0 4px 12px rgba(46, 52, 64, 0.05)',
                    borderRadius: '12px',
                    commandsBackground: 'rgba(255, 255, 255, 0.8)',
                    commandsBorder: '1px solid rgba(216, 222, 233, 0.7)',
                    commandsBoxShadow: '0 8px 24px rgba(46, 52, 64, 0.05)',
                    fontFamily: '"Inter", -apple-system, BlinkMacSystemFont, sans-serif',
                    fontSize: '14px',
                    fontWeight: '400',
                    keyColor: '#5e81ac',
                    commandMaxWidth: '60rem',
                    cornerTextStyle: 'font-family: "Inter", sans-serif; letter-spacing: 0.02em; font-size: 0.75rem; font-weight: 400; opacity: 0.7;',
                    dotSize: '5px',
                    dotOpacity: '0.3',
                    nameAfterHeight: '1px',
                    gridGap: '2rem',
                    minimalInterface: 'true',
                    subtleTransitions: 'true',
                    cleanSpacing: 'true',
                    keyStyle: 'background-color: rgba(94, 129, 172, 0.1); color: #5e81ac; font-weight: 500;',
                    nameHoverColor: '#5e81ac',
                    simplifiedLayout: 'true'
                },
                dark: {
                    background: '#2e3440',
                    gradient: 'linear-gradient(135deg, #2e3440, #3b4252)',
                    text: '#eceff4',
                    textSubtle: '#d8dee9',
                    accent: '#88c0d0',
                    hover: '#8fbcbb',
                    boxShadow: '0 4px 12px rgba(0, 0, 0, 0.1)',
                    borderRadius: '12px',
                    commandsBackground: 'rgba(46, 52, 64, 0.6)',
                    commandsBorder: '1px solid rgba(76, 86, 106, 0.5)',
                    commandsBoxShadow: '0 8px 24px rgba(0, 0, 0, 0.1)',
                    fontFamily: '"Inter", -apple-system, BlinkMacSystemFont, sans-serif',
                    fontSize: '14px',
                    fontWeight: '400',
                    keyColor: '#88c0d0',
                    commandMaxWidth: '60rem',
                    cornerTextStyle: 'font-family: "Inter", sans-serif; letter-spacing: 0.02em; font-size: 0.75rem; font-weight: 400; opacity: 0.7;',
                    dotSize: '5px',
                    dotOpacity: '0.3',
                    nameAfterHeight: '1px',
                    gridGap: '2rem',
                    minimalInterface: 'true',
                    subtleTransitions: 'true',
                    cleanSpacing: 'true',
                    keyStyle: 'background-color: rgba(136, 192, 208, 0.1); color: #88c0d0; font-weight: 500;',
                    nameHoverColor: '#88c0d0',
                    simplifiedLayout: 'true'
                }
            },
            mac: {
                light: {
                    background: '#ffffff',
                    gradient: 'linear-gradient(135deg, #ffffff, #f5f5f7)',
                    text: '#1d1d1f',
                    textSubtle: '#86868b',
                    accent: '#0071e3',
                    hover: '#0077ed',
                    boxShadow: '0 2px 6px rgba(0, 0, 0, 0.03)',
                    borderRadius: '8px',
                    commandsBackground: 'rgba(255, 255, 255, 0.8)',
                    commandsBorder: '1px solid rgba(0, 0, 0, 0.05)',
                    commandsBoxShadow: '0 10px 20px rgba(0, 0, 0, 0.05)',
                    fontFamily: '-apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif',
                    fontSize: '14px',
                    fontWeight: '500',
                    keyColor: '#0071e3',
                    commandMaxWidth: '70rem',
                    cornerTextStyle: 'font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif; letter-spacing: -0.01em; font-size: 0.75rem; font-weight: 400; opacity: 0.7;',
                    dotSize: '4px',
                    dotOpacity: '0.1',
                    nameAfterHeight: '0px',
                    gridGap: '1.5rem',
                    minimalInterface: 'true',
                    subtleTransitions: 'true',
                    cleanSpacing: 'true',
                    keyStyle: 'background: linear-gradient(to bottom, #f7f7f7, #e2e2e2); border: 1px solid #d1d1d1; box-shadow: 0 1px 2px rgba(0,0,0,0.05), 0 -1px 0 rgba(255,255,255,0.5) inset, 0 1px 0 rgba(0,0,0,0.1); color: #333; font-weight: 600; transform: translateY(0); transition: all 0.1s ease; position: relative; text-shadow: 0 1px 0 rgba(255,255,255,0.5);',
                    keyHoverStyle: 'transform: translateY(-1px); box-shadow: 0 2px 3px rgba(0,0,0,0.07), 0 -1px 0 rgba(255,255,255,0.5) inset, 0 1px 0 rgba(0,0,0,0.1);',
                    keyActiveStyle: 'transform: translateY(1px); box-shadow: 0 0 1px rgba(0,0,0,0.1), 0 -1px 0 rgba(255,255,255,0.5) inset, 0 1px 0 rgba(0,0,0,0.1);',
                    nameHoverColor: '#0071e3',
                    keycapStyle: 'true',
                    key3D: 'true',
                    keyFontSize: '0.9em',
                    keyBorderRadius: '4px',
                    keyPadding: '6px 8px',
                    keyHeight: '30px',
                    keyWidth: '30px',
                    keyVerticalAlign: 'middle',
                    macKeyboardEffect: 'true',
                    keyTextAlign: 'center',
                    inputStyle: 'border-radius: 8px; border: 1px solid rgba(0, 0, 0, 0.1); padding: 8px 12px; background: rgba(255, 255, 255, 0.8);'
                },
                dark: {
                    background: '#000000',
                    gradient: 'linear-gradient(135deg, #000000, #1d1d1f)',
                    text: '#f5f5f7',
                    textSubtle: '#86868b',
                    accent: '#0077ed',
                    hover: '#0284ff',
                    boxShadow: '0 2px 6px rgba(0, 0, 0, 0.15)',
                    borderRadius: '8px',
                    commandsBackground: 'rgba(28, 28, 30, 0.8)',
                    commandsBorder: '1px solid rgba(255, 255, 255, 0.05)',
                    commandsBoxShadow: '0 10px 20px rgba(0, 0, 0, 0.15)',
                    fontFamily: '-apple-system, BlinkMacSystemFont, "SF Pro Text", "Helvetica Neue", sans-serif',
                    fontSize: '14px',
                    fontWeight: '500',
                    keyColor: '#0077ed',
                    commandMaxWidth: '70rem',
                    cornerTextStyle: 'font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif; letter-spacing: -0.01em; font-size: 0.75rem; font-weight: 400; opacity: 0.7;',
                    dotSize: '4px',
                    dotOpacity: '0.2',
                    nameAfterHeight: '0px',
                    gridGap: '1.5rem',
                    minimalInterface: 'true',
                    subtleTransitions: 'true',
                    cleanSpacing: 'true',
                    keyStyle: 'background: linear-gradient(to bottom, #3a3a3c, #2c2c2e); border: 1px solid #1c1c1e; box-shadow: 0 1px 2px rgba(0,0,0,0.2), 0 -1px 0 rgba(255,255,255,0.1) inset, 0 1px 0 rgba(0,0,0,0.2); color: #f5f5f7; font-weight: 600; transform: translateY(0); transition: all 0.1s ease; position: relative; text-shadow: 0 1px 1px rgba(0,0,0,0.2);',
                    keyHoverStyle: 'transform: translateY(-1px); box-shadow: 0 2px 3px rgba(0,0,0,0.3), 0 -1px 0 rgba(255,255,255,0.1) inset, 0 1px 0 rgba(0,0,0,0.2);',
                    keyActiveStyle: 'transform: translateY(1px); box-shadow: 0 0 1px rgba(0,0,0,0.3), 0 -1px 0 rgba(255,255,255,0.1) inset, 0 1px 0 rgba(0,0,0,0.2);',
                    nameHoverColor: '#0077ed',
                    keycapStyle: 'true',
                    key3D: 'true',
                    keyFontSize: '0.9em',
                    keyBorderRadius: '4px',
                    keyPadding: '6px 8px',
                    keyHeight: '30px',
                    keyWidth: '30px',
                    keyVerticalAlign: 'middle',
                    macKeyboardEffect: 'true',
                    keyTextAlign: 'center',
                    inputStyle: 'border-radius: 8px; border: 1px solid rgba(255, 255, 255, 0.1); padding: 8px 12px; background: rgba(28, 28, 30, 0.8);'
                }
            }
        };

        // Variables to store settings and commands
        let currentSettings = {
            openLinksInNewTab: false,
            darkMode: false,
            autoTheme: false,  // New flag for auto theme switching
            theme: 'default',
            cornerText: '',
            rssEnabled: true,  // New flag for RSS feeds functionality
            customColors: {
                background: '#f8f5e6',
                backgroundSecondary: '#f2edd0',
                text: '#222222',
                accent: '#333333'
            },
            useCustomColors: false  // New flag to track if custom colors should be used
        };
        
        let commands = new Map();
        let editingKey = null;

        // DOM Elements
        const darkModeSetting = document.getElementById('dark-mode-setting');
        const autoThemeSetting = document.getElementById('auto-theme-setting');
        const themeSelect = document.getElementById('theme-select');
        const newTabSetting = document.getElementById('new-tab-setting');
        const cornerTextSetting = document.getElementById('corner-text-setting');
        const rssEnabledSetting = document.getElementById('rss-enabled-setting');
        const saveButton = document.getElementById('save-settings');
        const shortcutsList = document.getElementById('shortcuts-list');
        const addShortcutButton = document.getElementById('add-shortcut');
        
        // Modal Elements
        const shortcutModal = document.getElementById('shortcut-modal');
        const modalTitle = document.getElementById('modal-title');
        const modalCloseButton = document.getElementById('modal-close');
        const modalCancelButton = document.getElementById('modal-cancel');
        const shortcutForm = document.getElementById('shortcut-form');
        const shortcutKeyInput = document.getElementById('shortcut-key');
        const shortcutNameInput = document.getElementById('shortcut-name');
        const shortcutUrlInput = document.getElementById('shortcut-url');

        // Import/Export Elements
        const exportBtn = document.getElementById('export-settings');
        const importBtn = document.getElementById('import-settings');
        const importModal = document.getElementById('import-modal');
        const importModalClose = document.getElementById('import-modal-close');
        const importModalCancel = document.getElementById('import-modal-cancel');
        const importModalApply = document.getElementById('import-modal-apply');
        const importDataTextarea = document.getElementById('import-data');
        const importError = document.getElementById('import-error');
        const importFileInput = document.getElementById('import-file-input');
        const importFileName = document.getElementById('import-file-name');

        // GitHub Sync Elements
        const githubTokenInput = document.getElementById('github-token');
        const toggleTokenVisibilityBtn = document.getElementById('toggle-token-visibility');
        const enableSyncBtn = document.getElementById('enable-sync');
        const disableSyncBtn = document.getElementById('disable-sync');
        const manualSyncBtn = document.getElementById('manual-sync');
        const generateSyncUrlBtn = document.getElementById('generate-sync-url');
        const syncStatusDot = document.getElementById('sync-status-dot');
        const syncStatusText = document.getElementById('sync-status-text');
        const syncLastUpdate = document.getElementById('sync-last-update');
        const syncInfo = document.getElementById('sync-info');
        const gistIdDisplay = document.getElementById('gist-id-display');
        const userIdDisplay = document.getElementById('user-id-display');

        // Suggestions Management Elements
        const commandSelect = document.getElementById('command-select');
        const suggestionsEditor = document.getElementById('suggestions-editor');
        const suggestionsTextarea = document.getElementById('suggestions-textarea');
        const saveSuggestionsBtn = document.getElementById('save-suggestions');
        const clearSuggestionsBtn = document.getElementById('clear-suggestions');

        // GitHub Sync State Variables
        let githubToken = localStorage.getItem('githubToken') || '';
        let gistId = localStorage.getItem('gistId') || '';
        let syncUserId = localStorage.getItem('syncUserId') || '';
        let syncEnabled = localStorage.getItem('syncEnabled') === 'true';
        let isSyncing = false;
        let autoSyncTimeout = null;

        // Initialize the page
        document.addEventListener('DOMContentLoaded', () => {
            loadSettings();
            loadCommands();
            renderShortcuts();
            
            // Apply current theme
            applyTheme(currentSettings.theme, currentSettings.darkMode, currentSettings.useCustomColors);
            
            // Add event listeners
            darkModeSetting.addEventListener('change', onDarkModeChange);
            autoThemeSetting.addEventListener('change', onAutoThemeChange);
            themeSelect.addEventListener('change', onThemeChange);
            newTabSetting.addEventListener('change', onNewTabChange);
            rssEnabledSetting.addEventListener('change', onRssEnabledChange);
            cornerTextSetting.addEventListener('change', (e) => {
                currentSettings.cornerText = e.target.value.trim();
            });
            
            // Add event listener for custom colors toggle
            const customColorsToggle = document.getElementById('custom-colors-setting');
            customColorsToggle.addEventListener('change', (e) => {
                currentSettings.useCustomColors = e.target.checked;
                applyTheme(currentSettings.theme, currentSettings.darkMode, currentSettings.useCustomColors);
                
                // Highlight the colors section if custom colors are enabled
                const colorsSection = document.getElementById('colors-section');
                if (currentSettings.useCustomColors) {
                    colorsSection.style.border = '2px solid var(--color-accent)';
                    colorsSection.style.padding = '1.5rem';
                    colorsSection.style.borderRadius = 'var(--border-radius)';
                    colorsSection.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.1)';
                } else {
                    colorsSection.style.border = '';
                    colorsSection.style.padding = '';
                    colorsSection.style.borderRadius = '';
                    colorsSection.style.boxShadow = '';
                }
            });
            
            saveButton.addEventListener('click', saveSettings);
            
            // Shortcut modal event listeners
            addShortcutButton.addEventListener('click', openAddShortcutModal);
            modalCloseButton.addEventListener('click', closeModal);
            modalCancelButton.addEventListener('click', closeModal);
            shortcutForm.addEventListener('submit', onShortcutSave);
            
            // Export/Import event listeners
            exportBtn.addEventListener('click', exportSettings);
            importBtn.addEventListener('click', openImportModal);
            importModalClose.addEventListener('click', closeImportModal);
            importModalCancel.addEventListener('click', closeImportModal);
            importModalApply.addEventListener('click', importSettings);
            importFileInput.addEventListener('change', handleFileSelect);
            
            // Color picker event listeners
            setupColorPickers();

            // Add RSS feed suggestion buttons functionality
            const suggestionButtons = document.querySelectorAll('.suggestion-btn');
            const rssFeedsTextarea = document.getElementById('rss-feeds');
            
            suggestionButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const url = this.getAttribute('data-url');
                    
                    // Get current feeds
                    const currentFeeds = rssFeedsTextarea.value
                        .split('\n')
                        .map(feed => feed.trim())
                        .filter(feed => feed !== '');
                    
                    // Check if already added
                    if (!currentFeeds.includes(url)) {
                        // Add to textarea
                        if (currentFeeds.length > 0) {
                            rssFeedsTextarea.value = currentFeeds.join('\n') + '\n' + url;
                        } else {
                            rssFeedsTextarea.value = url;
                        }
                        
                        // Show feedback
                        button.innerText = '✓ Added';
                        button.style.backgroundColor = 'rgba(0, 200, 0, 0.2)';
                        
                        // Reset after 1 second
                        setTimeout(() => {
                            button.innerText = button.getAttribute('data-original-text') || 
                                              button.innerText.replace('✓ Added', '');
                            button.style.backgroundColor = '';
                        }, 1000);
                    } else {
                        // Already added - show feedback
                        button.innerText = 'Already added';
                        
                        // Reset after 1 second
                        setTimeout(() => {
                            button.innerText = button.getAttribute('data-original-text') || button.innerText.replace('Already added', button.innerText);
                        }, 1000);
                    }
                });
                
                // Store original text
                button.setAttribute('data-original-text', button.innerText);
            });

            // Initialize suggestions management functionality
            initializeSuggestionsManager();

            // Initialize auto theme if enabled
            if (currentSettings.autoTheme) {
                // Apply system preference and set up listener
                const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                currentSettings.darkMode = systemPrefersDark;
                darkModeSetting.checked = systemPrefersDark;
                darkModeSetting.disabled = true;
                darkModeSetting.parentElement.classList.add('disabled');
                setupSystemThemeListener();
                applyTheme(currentSettings.theme, currentSettings.darkMode, currentSettings.useCustomColors);
            }

            // GitHub Sync event listeners
            toggleTokenVisibilityBtn.addEventListener('click', toggleTokenVisibility);
            enableSyncBtn.addEventListener('click', enableSync);
            disableSyncBtn.addEventListener('click', disableSync);
            manualSyncBtn.addEventListener('click', manualSync);
            generateSyncUrlBtn.addEventListener('click', generateSyncUrl);
            githubTokenInput.addEventListener('input', onTokenInput);

            // Initialize sync UI
            initializeSyncUI();
            
            // Check for sync URL in hash
            checkForSyncUrl();
        });

        // Initialize suggestions management functionality
        function initializeSuggestionsManager() {
            // Populate command selector
            populateCommandSelector();
            
            // Add event listeners
            commandSelect.addEventListener('change', onCommandSelectChange);
            saveSuggestionsBtn.addEventListener('click', onSaveSuggestions);
            clearSuggestionsBtn.addEventListener('click', onClearSuggestions);
            
            // Add event listeners for quick suggestion buttons
            const quickSuggestionBtns = document.querySelectorAll('.quick-suggestion-btn');
            quickSuggestionBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const suggestion = this.getAttribute('data-suggestion');
                    addQuickSuggestion(suggestion);
                });
            });
        }

        // Populate the command selector dropdown
        function populateCommandSelector() {
            // Clear existing options except the first one
            while (commandSelect.children.length > 1) {
                commandSelect.removeChild(commandSelect.lastChild);
            }
            
            // Add commands that can have suggestions
            for (const [key, command] of commands.entries()) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = `${key} - ${command.name}`;
                commandSelect.appendChild(option);
            }
        }

        // Handle command selection change
        function onCommandSelectChange() {
            const selectedKey = commandSelect.value;
            
            if (selectedKey) {
                const command = commands.get(selectedKey);
                if (command) {
                    // Show the suggestions editor
                    suggestionsEditor.style.display = 'block';
                    
                    // Load current suggestions if they exist
                    const suggestions = command.suggestions || [];
                    suggestionsTextarea.value = suggestions.join('\n');
                }
            } else {
                // Hide the suggestions editor
                suggestionsEditor.style.display = 'none';
                suggestionsTextarea.value = '';
            }
        }

        // Save suggestions for the selected command
        function onSaveSuggestions() {
            const selectedKey = commandSelect.value;
            if (!selectedKey) return;
            
            const suggestionsText = suggestionsTextarea.value.trim();
            const suggestions = suggestionsText ? 
                suggestionsText.split('\n')
                    .map(s => s.trim())
                    .filter(s => s !== '') : 
                [];
            
            // Update the command with new suggestions
            const command = commands.get(selectedKey);
            if (command) {
                if (suggestions.length > 0) {
                    command.suggestions = suggestions;
                } else {
                    // Remove suggestions property if empty
                    delete command.suggestions;
                }
                commands.set(selectedKey, command);
                
                // Save to localStorage
                saveCommandsToStorage();
                
                // Show success feedback
                showFeedback(saveSuggestionsBtn, 'Saved!', '#4CAF50');
            }
        }

        // Clear all suggestions for the selected command
        function onClearSuggestions() {
            if (confirm('Are you sure you want to clear all suggestions for this command?')) {
                suggestionsTextarea.value = '';
            }
        }

        // Add a quick suggestion to the textarea
        function addQuickSuggestion(suggestion) {
            const currentSuggestions = suggestionsTextarea.value
                .split('\n')
                .map(s => s.trim())
                .filter(s => s !== '');
            
            if (!currentSuggestions.includes(suggestion)) {
                if (currentSuggestions.length > 0) {
                    suggestionsTextarea.value = currentSuggestions.join('\n') + '\n' + suggestion;
                } else {
                    suggestionsTextarea.value = suggestion;
                }
            }
        }

        // Save commands to localStorage
        function saveCommandsToStorage() {
            try {
                const commandsArray = Array.from(commands.entries());
                localStorage.setItem('homeCommands', JSON.stringify(commandsArray));
            } catch (e) {
                console.error('Error saving commands:', e);
            }
        }

        // Show temporary feedback on buttons
        function showFeedback(button, text, color) {
            const originalText = button.textContent;
            const originalBg = button.style.backgroundColor;
            
            button.textContent = text;
            button.style.backgroundColor = color;
            
            setTimeout(() => {
                button.textContent = originalText;
                button.style.backgroundColor = originalBg;
            }, 1500);
        }

        // Load settings from localStorage
        function loadSettings() {
            try {
                const savedSettings = localStorage.getItem('homeSettings');
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    
                    // Update current settings
                    currentSettings = {
                        openLinksInNewTab: settings.openLinksInNewTab || false,
                        darkMode: settings.darkMode || false,
                        autoTheme: settings.autoTheme || false,  // New flag for auto theme switching
                        theme: settings.theme || 'default',
                        cornerText: settings.cornerText || '',
                        rssEnabled: settings.rssEnabled !== undefined ? settings.rssEnabled : true,  // Default to enabled
                        customColors: settings.customColors || {
                            background: '#f8f5e6',
                            backgroundSecondary: '#f2edd0',
                            text: '#222222',
                            accent: '#333333'
                        },
                        useCustomColors: settings.useCustomColors || false
                    };
                    
                    // Update form elements
                    darkModeSetting.checked = currentSettings.darkMode;
                    autoThemeSetting.checked = currentSettings.autoTheme;
                    themeSelect.value = currentSettings.theme;
                    newTabSetting.checked = currentSettings.openLinksInNewTab;
                    rssEnabledSetting.checked = currentSettings.rssEnabled;
                    cornerTextSetting.value = currentSettings.cornerText;
                    
                    // Set custom colors toggle
                    const customColorsToggle = document.getElementById('custom-colors-setting');
                    customColorsToggle.checked = currentSettings.useCustomColors;
                    
                    // Highlight the colors section if custom colors are enabled
                    const colorsSection = document.getElementById('colors-section');
                    if (currentSettings.useCustomColors) {
                        colorsSection.style.border = '2px solid var(--color-accent)';
                        colorsSection.style.padding = '1.5rem';
                        colorsSection.style.borderRadius = 'var(--border-radius)';
                        colorsSection.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.1)';
                    }
                    
                    // Update color pickers
                    if (currentSettings.customColors) {
                        updateColorPickers(currentSettings.customColors);
                    }
                    
                    // Load RSS feeds
                    if (settings.rssFeeds && Array.isArray(settings.rssFeeds)) {
                        document.getElementById('rss-feeds').value = settings.rssFeeds.join('\n');
                    }
                    
                    // Set RSS container visibility
                    const rssContainer = document.getElementById('rss-feeds-container');
                    if (currentSettings.rssEnabled) {
                        rssContainer.style.display = 'block';
                        rssContainer.style.opacity = '1';
                    } else {
                        rssContainer.style.display = 'none';
                        rssContainer.style.opacity = '0.5';
                    }
                    
                    console.log("Settings loaded:", currentSettings);
                }
            } catch (e) {
                console.error('Error loading settings:', e);
                // Show error message on the page
                const errorMsg = document.createElement('div');
                errorMsg.style.color = 'red';
                errorMsg.style.padding = '1rem';
                errorMsg.style.marginTop = '1rem';
                errorMsg.style.border = '1px solid red';
                errorMsg.textContent = 'Error loading settings: ' + e.message;
                document.querySelector('.settings-container').appendChild(errorMsg);
            }
        }

        // Load commands from localStorage
        function loadCommands() {
            try {
                const savedCommands = localStorage.getItem('homeCommands');
                if (savedCommands) {
                    const commandsArray = JSON.parse(savedCommands);
                    commands = new Map(commandsArray);
                } else {
                    // Default commands
                    commands = new Map([
                        ['a', { name: 'Plex', url: 'https://app.plex.tv/desktop/' }],
                        ['g', { name: 'Google', url: 'https://google.com' }],
                        ['y', { name: 'YouTube', url: 'https://youtube.com/' }],
                    ]);
                }
            } catch (e) {
                console.error('Error loading commands:', e);
            }
        }

        // Render the shortcuts list
        function renderShortcuts() {
            shortcutsList.innerHTML = '';
            
            // Sort commands alphabetically by key
            const sortedCommands = Array.from(commands.entries()).sort((a, b) => a[0].localeCompare(b[0]));
            
            for (const [key, command] of sortedCommands) {
                const li = document.createElement('li');
                li.className = 'shortcut-item';
                li.dataset.key = key;
                
                const info = document.createElement('div');
                info.className = 'shortcut-info';
                
                const keySpan = document.createElement('span');
                keySpan.className = 'shortcut-key';
                keySpan.textContent = key;
                
                const detailsDiv = document.createElement('div');
                detailsDiv.className = 'shortcut-details';
                
                const nameSpan = document.createElement('div');
                nameSpan.className = 'shortcut-name';
                nameSpan.textContent = command.name;
                
                const urlSpan = document.createElement('div');
                urlSpan.className = 'shortcut-url';
                urlSpan.textContent = command.url;
                
                detailsDiv.appendChild(nameSpan);
                detailsDiv.appendChild(urlSpan);
                
                info.appendChild(keySpan);
                info.appendChild(detailsDiv);
                
                const actions = document.createElement('div');
                actions.className = 'shortcut-actions';
                
                const editButton = document.createElement('button');
                editButton.type = 'button';
                editButton.className = 'shortcut-edit-btn';
                editButton.textContent = 'Edit';
                editButton.addEventListener('click', () => openEditShortcutModal(key));
                
                const deleteButton = document.createElement('button');
                deleteButton.type = 'button';
                deleteButton.className = 'shortcut-delete-btn';
                deleteButton.textContent = 'Delete';
                deleteButton.addEventListener('click', () => deleteShortcut(key));
                
                actions.appendChild(editButton);
                actions.appendChild(deleteButton);
                
                li.appendChild(info);
                li.appendChild(actions);
                
                shortcutsList.appendChild(li);
            }
            
            // Update command selector after rendering shortcuts
            if (typeof populateCommandSelector === 'function') {
                populateCommandSelector();
            }
        }

        // Dark mode toggle handler
        function onDarkModeChange(e) {
            const isDarkMode = e.target.checked;
            applyTheme(currentSettings.theme, isDarkMode, currentSettings.useCustomColors);
            currentSettings.darkMode = isDarkMode;
            
            // Update color pickers to reflect the current theme's colors in the new mode
            const themeColors = getThemeColors(currentSettings.theme, isDarkMode);
            updateColorPreview(currentSettings.useCustomColors ? currentSettings.customColors : themeColors);
        }

        // Auto theme toggle handler
        function onAutoThemeChange(e) {
            currentSettings.autoTheme = e.target.checked;
            
            if (currentSettings.autoTheme) {
                // Enable auto theme: disable manual dark mode toggle and apply system preference
                darkModeSetting.disabled = true;
                darkModeSetting.parentElement.classList.add('disabled');
                
                // Apply system preference immediately
                const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                currentSettings.darkMode = systemPrefersDark;
                darkModeSetting.checked = systemPrefersDark;
                
                // Listen for system preference changes
                setupSystemThemeListener();
            } else {
                // Disable auto theme: re-enable manual dark mode toggle
                darkModeSetting.disabled = false;
                darkModeSetting.parentElement.classList.remove('disabled');
                
                // Remove system preference listener
                removeSystemThemeListener();
            }
            
            applyTheme(currentSettings.theme, currentSettings.darkMode, currentSettings.useCustomColors);
        }

        // System theme listener setup
        let systemThemeMediaQuery = null;
        
        function setupSystemThemeListener() {
            if (systemThemeMediaQuery) {
                removeSystemThemeListener();
            }
            
            systemThemeMediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
            systemThemeMediaQuery.addEventListener('change', handleSystemThemeChange);
        }
        
        function removeSystemThemeListener() {
            if (systemThemeMediaQuery) {
                systemThemeMediaQuery.removeEventListener('change', handleSystemThemeChange);
                systemThemeMediaQuery = null;
            }
        }
        
        function handleSystemThemeChange(e) {
            if (currentSettings.autoTheme) {
                currentSettings.darkMode = e.matches;
                darkModeSetting.checked = e.matches;
                applyTheme(currentSettings.theme, currentSettings.darkMode, currentSettings.useCustomColors);
                
                // Update color pickers to reflect the new mode
                const themeColors = getThemeColors(currentSettings.theme, currentSettings.darkMode);
                updateColorPickers(themeColors);
                updateColorPreview(currentSettings.useCustomColors ? currentSettings.customColors : themeColors);
            }
        }

        // Theme change handler
        function onThemeChange(e) {
            const theme = e.target.value;
            currentSettings.theme = theme;
            applyTheme(theme, currentSettings.darkMode, currentSettings.useCustomColors);
            
            // Update color pickers to reflect the current theme's colors
            const themeColors = getThemeColors(theme, currentSettings.darkMode);
            updateColorPickers(themeColors);
            updateColorPreview(currentSettings.useCustomColors ? currentSettings.customColors : themeColors);
        }

        // New tab setting handler
        function onNewTabChange(e) {
            currentSettings.openLinksInNewTab = e.target.checked;
        }

        // RSS enabled setting handler
        function onRssEnabledChange(e) {
            currentSettings.rssEnabled = e.target.checked;
            const rssContainer = document.getElementById('rss-feeds-container');
            
            if (currentSettings.rssEnabled) {
                // Enable RSS feeds: show the container
                rssContainer.style.display = 'block';
                rssContainer.style.opacity = '1';
            } else {
                // Disable RSS feeds: hide the container
                rssContainer.style.display = 'none';
                rssContainer.style.opacity = '0.5';
            }
        }

        // Setup color pickers
        function setupColorPickers() {
            const backgroundColorPicker = document.getElementById('background-color');
            const backgroundColorText = document.getElementById('background-color-text');
            const backgroundSecondaryColorPicker = document.getElementById('background-secondary-color');
            const backgroundSecondaryColorText = document.getElementById('background-secondary-color-text');
            const textColorPicker = document.getElementById('text-color');
            const textColorText = document.getElementById('text-color-text');
            const accentColorPicker = document.getElementById('accent-color');
            const accentColorText = document.getElementById('accent-color-text');
            const resetColorsBtn = document.getElementById('reset-colors');
            const colorPreview = document.querySelector('.color-preview');
            
            // Set initial values based on current theme
            const initialThemeColors = getThemeColors(currentSettings.theme, currentSettings.darkMode);
            updateColorPickers(initialThemeColors);
            updateColorPreview(currentSettings.useCustomColors ? currentSettings.customColors : initialThemeColors);
            
            // Add event listeners for color pickers
            backgroundColorPicker.addEventListener('input', (e) => {
                const color = e.target.value;
                backgroundColorText.value = color;
                currentSettings.customColors.background = color;
                if (currentSettings.useCustomColors) {
                    updateColorPreview(currentSettings.customColors);
                    applyTheme(currentSettings.theme, currentSettings.darkMode, true);
                }
            });
            
            backgroundColorText.addEventListener('input', (e) => {
                const color = e.target.value;
                if (isValidColor(color)) {
                    backgroundColorPicker.value = color;
                    currentSettings.customColors.background = color;
                    if (currentSettings.useCustomColors) {
                        updateColorPreview(currentSettings.customColors);
                        applyTheme(currentSettings.theme, currentSettings.darkMode, true);
                    }
                }
            });
            
            backgroundSecondaryColorPicker.addEventListener('input', (e) => {
                const color = e.target.value;
                backgroundSecondaryColorText.value = color;
                currentSettings.customColors.backgroundSecondary = color;
                if (currentSettings.useCustomColors) {
                    updateColorPreview(currentSettings.customColors);
                    applyTheme(currentSettings.theme, currentSettings.darkMode, true);
                }
            });
            
            backgroundSecondaryColorText.addEventListener('input', (e) => {
                const color = e.target.value;
                if (isValidColor(color)) {
                    backgroundSecondaryColorPicker.value = color;
                    currentSettings.customColors.backgroundSecondary = color;
                    if (currentSettings.useCustomColors) {
                        updateColorPreview(currentSettings.customColors);
                        applyTheme(currentSettings.theme, currentSettings.darkMode, true);
                    }
                }
            });
            
            textColorPicker.addEventListener('input', (e) => {
                const color = e.target.value;
                textColorText.value = color;
                currentSettings.customColors.text = color;
                if (currentSettings.useCustomColors) {
                    updateColorPreview(currentSettings.customColors);
                    applyTheme(currentSettings.theme, currentSettings.darkMode, true);
                }
            });
            
            textColorText.addEventListener('input', (e) => {
                const color = e.target.value;
                if (isValidColor(color)) {
                    textColorPicker.value = color;
                    currentSettings.customColors.text = color;
                    if (currentSettings.useCustomColors) {
                        updateColorPreview(currentSettings.customColors);
                        applyTheme(currentSettings.theme, currentSettings.darkMode, true);
                    }
                }
            });
            
            accentColorPicker.addEventListener('input', (e) => {
                const color = e.target.value;
                accentColorText.value = color;
                currentSettings.customColors.accent = color;
                if (currentSettings.useCustomColors) {
                    updateColorPreview(currentSettings.customColors);
                    applyTheme(currentSettings.theme, currentSettings.darkMode, true);
                }
            });
            
            accentColorText.addEventListener('input', (e) => {
                const color = e.target.value;
                if (isValidColor(color)) {
                    accentColorPicker.value = color;
                    currentSettings.customColors.accent = color;
                    if (currentSettings.useCustomColors) {
                        updateColorPreview(currentSettings.customColors);
                        applyTheme(currentSettings.theme, currentSettings.darkMode, true);
                    }
                }
            });
            
            resetColorsBtn.addEventListener('click', () => {
                // Reset to current theme colors
                const themeColors = getThemeColors(currentSettings.theme, currentSettings.darkMode);
                
                currentSettings.customColors = { ...themeColors };
                updateColorPickers(themeColors);
                updateColorPreview(currentSettings.useCustomColors ? themeColors : themeColors);
                
                if (currentSettings.useCustomColors) {
                    applyTheme(currentSettings.theme, currentSettings.darkMode, true);
                }
            });
        }
        
        // Update color pickers with values
        function updateColorPickers(colors) {
            document.getElementById('background-color').value = colors.background;
            document.getElementById('background-color-text').value = colors.background;
            document.getElementById('background-secondary-color').value = colors.backgroundSecondary;
            document.getElementById('background-secondary-color-text').value = colors.backgroundSecondary;
            document.getElementById('text-color').value = colors.text;
            document.getElementById('text-color-text').value = colors.text;
            document.getElementById('accent-color').value = colors.accent;
            document.getElementById('accent-color-text').value = colors.accent;
        }
        
        // Update color preview
        function updateColorPreview(colors) {
            const colorPreview = document.querySelector('.color-preview');
            colorPreview.style.setProperty('--preview-background-color', colors.background);
            colorPreview.style.setProperty('--preview-background-secondary-color', colors.backgroundSecondary);
            colorPreview.style.setProperty('--preview-text-color', colors.text);
            colorPreview.style.setProperty('--preview-accent-color', colors.accent);
        }
        
        // Check if a string is a valid color
        function isValidColor(color) {
            const s = new Option().style;
            s.color = color;
            return s.color !== '';
        }
        
        // Apply custom theme
        function applyCustomTheme(colors, isDarkMode) {
            // Apply basic colors
            document.documentElement.style.setProperty('--color-background', colors.background);
            document.documentElement.style.setProperty('--color-text', colors.text);
            document.documentElement.style.setProperty('--color-accent', colors.accent);
            document.documentElement.style.setProperty('--color-hover', lightenDarkenColor(colors.accent, isDarkMode ? 20 : -20));
            
            // Apply gradient
            document.documentElement.style.backgroundImage = `linear-gradient(135deg, ${colors.background}, ${colors.backgroundSecondary})`;
            
            // Calculate and set subtle text color
            const subtleText = isDarkMode ? lightenDarkenColor(colors.text, -30) : lightenDarkenColor(colors.text, 30);
            document.documentElement.style.setProperty('--color-text-subtle', subtleText);
        }
        
        // Helper function to lighten or darken a color
        function lightenDarkenColor(color, percent) {
            let R = parseInt(color.substring(1, 3), 16);
            let G = parseInt(color.substring(3, 5), 16);
            let B = parseInt(color.substring(5, 7), 16);

            R = parseInt(R * (100 + percent) / 100);
            G = parseInt(G * (100 + percent) / 100);
            B = parseInt(B * (100 + percent) / 100);

            R = (R < 255) ? R : 255;
            G = (G < 255) ? G : 255;
            B = (B < 255) ? B : 255;

            R = (R > 0) ? R : 0;
            G = (G > 0) ? G : 0;
            B = (B > 0) ? B : 0;

            const RR = ((R.toString(16).length === 1) ? "0" + R.toString(16) : R.toString(16));
            const GG = ((G.toString(16).length === 1) ? "0" + G.toString(16) : G.toString(16));
            const BB = ((B.toString(16).length === 1) ? "0" + B.toString(16) : B.toString(16));

            return "#" + RR + GG + BB;
        }
        
        // Apply theme to page
        function applyTheme(themeName, isDarkMode, useCustomColors) {
            // Toggle dark mode class
            document.documentElement.classList.toggle('dark-mode', isDarkMode);
            
            // Store theme data in the document
            document.documentElement.dataset.theme = themeName;
            document.documentElement.dataset.darkMode = isDarkMode;
            
            // Get the base theme colors
            const theme = THEMES[themeName] || THEMES.default;
            const colors = isDarkMode ? theme.dark : theme.light;
            
            // Apply colors - either from theme or custom
            if (useCustomColors) {
                // Apply custom colors on top of theme
                document.documentElement.style.setProperty('--color-background', currentSettings.customColors.background);
                document.documentElement.style.setProperty('--color-text', currentSettings.customColors.text);
                document.documentElement.style.setProperty('--color-accent', currentSettings.customColors.accent);
                document.documentElement.style.setProperty('--color-hover', lightenDarkenColor(currentSettings.customColors.accent, isDarkMode ? 20 : -20));
                
                // Apply gradient with custom colors
                document.documentElement.style.backgroundImage = `linear-gradient(135deg, ${currentSettings.customColors.background}, ${currentSettings.customColors.backgroundSecondary})`;
                
                // Calculate and set subtle text color
                const subtleText = isDarkMode ? lightenDarkenColor(currentSettings.customColors.text, -30) : lightenDarkenColor(currentSettings.customColors.text, 30);
                document.documentElement.style.setProperty('--color-text-subtle', subtleText);
            } else {
                // Apply theme colors
            document.documentElement.style.setProperty('--color-background', colors.background);
            document.documentElement.style.setProperty('--color-text', colors.text);
            document.documentElement.style.setProperty('--color-text-subtle', colors.textSubtle);
            document.documentElement.style.setProperty('--color-accent', colors.accent);
            document.documentElement.style.setProperty('--color-hover', colors.hover);
            document.documentElement.style.setProperty('--box-shadow', colors.boxShadow);
            
            // Apply gradient
            if (colors.gradient && colors.gradient !== 'none') {
                document.documentElement.style.backgroundImage = colors.gradient;
            } else {
                document.documentElement.style.backgroundImage = 'none';
                }
            }
            
            // Always apply theme-specific styles
            if (colors.borderRadius) {
                document.documentElement.style.setProperty('--border-radius', colors.borderRadius);
            } else {
                document.documentElement.style.setProperty('--border-radius', '8px');
            }
            
            if (colors.fontFamily) {
                document.documentElement.style.fontFamily = colors.fontFamily;
            } else {
                document.documentElement.style.fontFamily = 'var(--font-family)';
            }
            
            if (colors.fontSize) {
                document.documentElement.style.fontSize = colors.fontSize;
            } else {
                document.documentElement.style.fontSize = 'var(--font-size)';
            }
            
            // Handle special theme properties
            if (themeName === 'minimal') {
                // Set minimal styles
                document.querySelectorAll('.corner-text').forEach(el => {
                    el.style.opacity = '0';
                });
                
                // Style minimal specific settings
                const buttons = document.querySelectorAll('button');
                buttons.forEach(btn => {
                    btn.style.borderRadius = colors.borderRadius || '0';
                });
                
            } else if (themeName === 'glass') {
                // Apply glass theme properties
                document.documentElement.style.backdropFilter = colors.backdropFilter || 'blur(10px)';
                
                // Style the back link for glass theme
                const backLink = document.querySelector('.back-link');
                if (backLink) {
                    backLink.style.color = colors.accent;
                }
                
                // Style buttons for glass theme
                const buttons = document.querySelectorAll('button');
                buttons.forEach(btn => {
                    if (btn.classList.contains('save-button')) {
                        btn.style.boxShadow = '0 4px 10px rgba(0, 0, 0, 0.1)';
                    }
                });
                
            } else if (themeName === 'ocean') {
                // Apply Ocean theme properties
                document.documentElement.style.backdropFilter = colors.backdropFilter || 'blur(8px)';
                
                // Style buttons for ocean theme
                const saveButton = document.querySelector('.save-button');
                if (saveButton) {
                    saveButton.style.boxShadow = colors.boxShadow;
                }
                
                // Apply animations if enabled
                if (colors.uiAnimation === 'true') {
                    const styleElement = document.getElementById('ocean-animations');
                    if (!styleElement) {
                        const style = document.createElement('style');
                        style.id = 'ocean-animations';
                        style.textContent = `
                            .shortcut-item {
                                transition: transform 0.3s ease, box-shadow 0.3s ease !important;
                            }
                            .shortcut-item:hover {
                                transform: translateY(-2px) !important;
                                box-shadow: 0 4px 12px rgba(0, 131, 143, 0.15) !important;
                            }
                            
                            .save-button {
                                transition: all 0.3s ease !important;
                            }
                            .save-button:hover {
                                transform: translateY(-2px);
                                box-shadow: 0 6px 14px rgba(0, 131, 143, 0.2) !important;
                            }
                        `;
                        document.head.appendChild(style);
                    }
                } else {
                    const styleElement = document.getElementById('ocean-animations');
                    if (styleElement) {
                        styleElement.remove();
                    }
                }
                
            } else if (themeName === 'swiss') {
                // Apply Swiss theme properties
                document.documentElement.style.letterSpacing = colors.letterSpacing || '0.03em';
                
                if (colors.fontWeight) {
                    document.documentElement.style.fontWeight = colors.fontWeight;
                }
                
                // Style corner texts for Swiss theme
                document.querySelectorAll('.shortcut-key').forEach(el => {
                    el.style.backgroundColor = useCustomColors ? currentSettings.customColors.accent : colors.accent;
                    el.style.borderRadius = '0';
                });
                
                // Apply Swiss button styles
                document.querySelectorAll('button').forEach(btn => {
                    btn.style.borderRadius = '0';
                    if (btn.classList.contains('save-button')) {
                        btn.style.backgroundColor = useCustomColors ? currentSettings.customColors.accent : colors.accent;
                    }
                });
                
                // Create Swiss style for form elements
                const styleElement = document.getElementById('swiss-style');
                if (!styleElement) {
                    const style = document.createElement('style');
                    style.id = 'swiss-style';
                    style.textContent = `
                        .settings-select, .form-input {
                            border-radius: 0 !important;
                        }
                        .shortcut-item {
                            border-radius: 0 !important;
                            border-left: 2px solid transparent;
                            transition: all 0.2s ease;
                        }
                        .shortcut-item:hover {
                            border-left-color: ${useCustomColors ? currentSettings.customColors.accent : colors.accent};
                        }
                    `;
                    document.head.appendChild(style);
                }
            } else if (themeName === 'mac') {
                // Apply Mac theme properties with 3D keyboard-like effects
                if (colors.fontWeight) {
                    document.documentElement.style.fontWeight = colors.fontWeight;
                }
                
                // Create Mac 3D keyboard style for shortcut keys
                const macStyleElement = document.getElementById('mac-style');
                if (!macStyleElement) {
                    const style = document.createElement('style');
                    style.id = 'mac-style';
                    style.textContent = `
                        .shortcut-key {
                            ${colors.keyStyle}
                            width: ${colors.keyWidth || '30px'};
                            height: ${colors.keyHeight || '30px'};
                            border-radius: ${colors.keyBorderRadius || '4px'};
                            padding: ${colors.keyPadding || '6px 8px'};
                            text-align: ${colors.keyTextAlign || 'center'};
                            vertical-align: ${colors.keyVerticalAlign || 'middle'};
                            font-size: ${colors.keyFontSize || '0.9em'};
                        }
                        
                        .shortcut-key:hover {
                            ${colors.keyHoverStyle}
                        }
                        
                        .shortcut-key:active {
                            ${colors.keyActiveStyle}
                        }
                        
                        .shortcut-name {
                            font-weight: 500;
                            transition: color 0.2s ease;
                        }
                        
                        .shortcut-item {
                            background: ${isDarkMode ? 'rgba(28, 28, 30, 0.5)' : 'rgba(255, 255, 255, 0.5)'};
                            border: 1px solid ${isDarkMode ? 'rgba(255, 255, 255, 0.05)' : 'rgba(0, 0, 0, 0.05)'};
                            transition: transform 0.15s ease, box-shadow 0.15s ease;
                        }
                        
                        .shortcut-item:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 4px 10px ${isDarkMode ? 'rgba(0, 0, 0, 0.2)' : 'rgba(0, 0, 0, 0.05)'};
                        }
                        
                        .shortcut-edit-btn, .shortcut-delete-btn {
                            ${colors.inputStyle || ''}
                            transition: all 0.15s ease;
                        }
                        
                        .shortcut-edit-btn:hover {
                            background: ${colors.accent};
                            color: white;
                        }
                        
                        .settings-select, .form-input, .color-picker-input {
                            ${colors.inputStyle || ''}
                        }
                    `;
                    document.head.appendChild(style);
                }
                
                // Update any specific elements that need special styling
                document.querySelectorAll('.save-button').forEach(btn => {
                    btn.style.borderRadius = '8px';
                    btn.style.background = useCustomColors ? currentSettings.customColors.accent : colors.accent;
                    btn.style.color = '#ffffff';
                    btn.style.fontWeight = '600';
                    btn.style.boxShadow = '0 1px 2px rgba(0,0,0,0.1)';
                    btn.style.transition = 'all 0.15s ease';
                });
            } else {
                // Reset to default styles for other themes
                document.documentElement.style.backdropFilter = 'none';
                document.documentElement.style.letterSpacing = '';
                document.documentElement.style.fontWeight = '';
                
                // Remove theme-specific style elements
                const oceanStyles = document.getElementById('ocean-animations');
                if (oceanStyles) oceanStyles.remove();
                
                const swissStyles = document.getElementById('swiss-style');
                if (swissStyles) swissStyles.remove();
                
                const macStyles = document.getElementById('mac-style');
                if (macStyles) macStyles.remove();
                
                // Reset any styled elements
                document.querySelectorAll('.shortcut-key').forEach(el => {
                    el.style.borderRadius = '';
                    el.style.backgroundColor = '';
                });
                
                document.querySelectorAll('button').forEach(btn => {
                    btn.style.borderRadius = '';
                    btn.style.boxShadow = '';
                    btn.style.backgroundColor = '';
                });
            }
            
            // Dispatch theme changed event for other components
            document.dispatchEvent(new CustomEvent('themeChanged', {
                detail: { 
                    theme: themeName, 
                    darkMode: isDarkMode,
                    useCustomColors: useCustomColors,
                    customColors: useCustomColors ? currentSettings.customColors : null
                }
            }));
            
            console.log("Theme applied:", themeName, "Dark mode:", isDarkMode, "Custom colors:", useCustomColors);
        }

        // Save settings to localStorage
        function saveSettings() {
            try {
                console.log("Saving settings:", currentSettings);
                
                // Save RSS feeds
                const rssFeeds = document.getElementById('rss-feeds').value
                    .split('\n')
                    .map(url => url.trim())
                    .filter(url => url !== '');
                currentSettings.rssFeeds = rssFeeds;
                
                // Save settings with all necessary theme information
                localStorage.setItem('homeSettings', JSON.stringify(currentSettings));
                
                // Save commands
                const commandsArray = Array.from(commands.entries());
                localStorage.setItem('homeCommands', JSON.stringify(commandsArray));
                
                // Show a brief success message in the button
                const button = saveButton;
                const originalText = button.textContent;
                button.textContent = 'Saved!';
                button.disabled = true;
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.disabled = false;
                }, 1500);
                
                // Apply the settings immediately
                applyTheme(currentSettings.theme, currentSettings.darkMode, currentSettings.useCustomColors);
            } catch (e) {
                console.error('Error saving settings:', e);
                alert('There was an error saving your settings. Please try again.');
            }
        }

        // Open add shortcut modal
        function openAddShortcutModal() {
            editingKey = null;
            modalTitle.textContent = 'Add Shortcut';
            shortcutKeyInput.value = '';
            shortcutNameInput.value = '';
            shortcutUrlInput.value = '';
            shortcutModal.classList.add('active');
        }

        // Open edit shortcut modal
        function openEditShortcutModal(key) {
            if (!commands.has(key)) return;
            
            const command = commands.get(key);
            editingKey = key;
            
            modalTitle.textContent = 'Edit Shortcut';
            shortcutKeyInput.value = key;
            shortcutNameInput.value = command.name || '';
            shortcutUrlInput.value = command.url || '';
            
            shortcutModal.classList.add('active');
        }

        // Close modal
        function closeModal() {
            shortcutModal.classList.remove('active');
        }

        // Save shortcut
        function onShortcutSave(e) {
            e.preventDefault();
            
            const key = shortcutKeyInput.value.trim().toLowerCase();
            const name = shortcutNameInput.value.trim();
            const url = shortcutUrlInput.value.trim();
            
            // Validate inputs
            if (!key || !name || !url) {
                alert('All fields are required.');
                return;
            }
            
            // Ensure key is a single character
            if (key.length !== 1) {
                alert('Key must be a single character.');
                return;
            }
            
            // If we're changing the key, check if it's already in use
            if (key !== editingKey && commands.has(key)) {
                alert(`Key "${key}" is already in use. Please choose another.`);
                return;
            }
            
            // Create or update the command
            const command = { name, url };
            
            // If we're changing the key, remove the old entry
            if (editingKey && editingKey !== key) {
                // Preserve existing properties from old command if changing key
                const oldCommand = commands.get(editingKey);
                if (oldCommand) {
                    // Copy over additional properties like suggestions
                    Object.keys(oldCommand).forEach(prop => {
                        if (prop !== 'name' && prop !== 'url') {
                            command[prop] = oldCommand[prop];
                        }
                    });
                }
                commands.delete(editingKey);
            } else if (editingKey === key) {
                // We're editing the same key, preserve existing properties
                const existingCommand = commands.get(key);
                if (existingCommand) {
                    Object.keys(existingCommand).forEach(prop => {
                        if (prop !== 'name' && prop !== 'url') {
                            command[prop] = existingCommand[prop];
                        }
                    });
                }
            }
            
            // Set the new command
            commands.set(key, command);
            
            // Re-render shortcuts
            renderShortcuts();
            
            // Close the modal
            closeModal();
        }

        // Delete shortcut
        function deleteShortcut(key) {
            if (!commands.has(key)) return;
            
            const command = commands.get(key);
            if (confirm(`Delete the shortcut "${key}" - ${command.name}?`)) {
                commands.delete(key);
                renderShortcuts();
            }
        }

        // Export settings and commands
        function exportSettings() {
            try {
                // Create an object with all settings and commands
                const exportData = {
                    settings: currentSettings,
                    commands: Array.from(commands.entries())
                };
                
                // Convert to JSON string
                const exportString = JSON.stringify(exportData, null, 2);
                
                // Create a Blob with the data
                const blob = new Blob([exportString], { type: 'application/json' });
                
                // Create a download link
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'home_settings_' + new Date().toISOString().slice(0, 10) + '.json';
                
                // Trigger the download
                document.body.appendChild(a);
                a.click();
                
                // Clean up
                setTimeout(() => {
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                }, 100);
            } catch (e) {
                console.error('Error exporting settings:', e);
                alert('There was an error exporting your settings. Please try again.');
            }
        }
        
        // Open import modal
        function openImportModal() {
            importDataTextarea.value = '';
            importError.classList.remove('active');
            importFileName.textContent = '';
            importFileInput.value = ''; // Clear any previously selected file
            importModal.classList.add('active');
        }
        
        // Close import modal
        function closeImportModal() {
            importModal.classList.remove('active');
        }
        
        // Handle file selection
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (!file) {
                importFileName.textContent = '';
                return;
            }
            
            // Display the selected filename
            importFileName.textContent = file.name;
            
            // Clear the textarea since we'll use the file
            importDataTextarea.value = '';
            
            // Clear any previous error
            importError.classList.remove('active');
        }
        
        // Import settings and commands
        function importSettings() {
            try {
                // Check if we have a file selected
                if (importFileInput.files.length > 0) {
                    const file = importFileInput.files[0];
                    const reader = new FileReader();
                    
                    reader.onload = function(event) {
                        try {
                            const fileContents = event.target.result;
                            processImportData(fileContents);
                        } catch (e) {
                            console.error('Error processing imported file:', e);
                            importError.textContent = 'Invalid file format. Please provide a valid JSON file.';
                            importError.classList.add('active');
                        }
                    };
                    
                    reader.onerror = function() {
                        importError.textContent = 'Error reading file. Please try again.';
                        importError.classList.add('active');
                    };
                    
                    reader.readAsText(file);
                } else {
                    // No file selected, try to use textarea content
                    const importString = importDataTextarea.value.trim();
                    
                    if (!importString) {
                        importError.textContent = 'Please select a file or paste your settings data.';
                        importError.classList.add('active');
                        return;
                    }
                    
                    processImportData(importString);
                }
            } catch (e) {
                console.error('Error importing settings:', e);
                importError.textContent = 'An error occurred during import. Please try again.';
                importError.classList.add('active');
            }
        }
        
        // Process the imported data
        function processImportData(dataString) {
            try {
                // Parse the JSON data
                const importData = JSON.parse(dataString);
                
                // Validate the imported data format
                if (!importData.settings || !importData.commands) {
                    importError.textContent = 'Invalid data format. The file is missing required data.';
                    importError.classList.add('active');
                    return;
                }
                
                // Update current settings
                currentSettings = {
                    openLinksInNewTab: importData.settings.openLinksInNewTab || false,
                    darkMode: importData.settings.darkMode || false,
                    autoTheme: importData.settings.autoTheme || false,  // New flag for auto theme switching
                    theme: importData.settings.theme || 'default',
                    cornerText: importData.settings.cornerText || '',
                    customColors: importData.settings.customColors || {
                        background: '#f8f5e6',
                        backgroundSecondary: '#f2edd0',
                        text: '#222222',
                        accent: '#333333'
                    },
                    useCustomColors: importData.settings.useCustomColors || false,
                    rssFeeds: importData.settings.rssFeeds || []
                };
                
                // Update UI to reflect imported settings
                darkModeSetting.checked = currentSettings.darkMode;
                autoThemeSetting.checked = currentSettings.autoTheme;
                themeSelect.value = currentSettings.theme;
                newTabSetting.checked = currentSettings.openLinksInNewTab;
                rssEnabledSetting.checked = currentSettings.rssEnabled;
                cornerTextSetting.value = currentSettings.cornerText;
                
                // Update RSS feeds textarea if rssFeeds exist
                if (currentSettings.rssFeeds && Array.isArray(currentSettings.rssFeeds)) {
                    document.getElementById('rss-feeds').value = currentSettings.rssFeeds.join('\n');
                }
                
                // Update commands
                commands = new Map(importData.commands);
                
                // Re-render shortcuts
                renderShortcuts();
                
                // Apply the imported theme
                applyTheme(currentSettings.theme, currentSettings.darkMode, currentSettings.useCustomColors);
                
                // Save the imported settings to localStorage
                saveSettings();
                
                // Close the import modal
                closeImportModal();
                
                // Show success message
                alert('Settings imported successfully!');
            } catch (e) {
                console.error('Error processing import data:', e);
                importError.textContent = 'Invalid data format. Please provide a valid JSON file.';
                importError.classList.add('active');
            }
        }

        // Get colors for a specific theme
        function getThemeColors(themeName, isDarkMode) {
            const theme = THEMES[themeName] || THEMES.default;
            const colors = isDarkMode ? theme.dark : theme.light;
            
            // Extract the background colors from gradient if available
            let background = colors.background;
            let backgroundSecondary = colors.background;
            
            if (colors.gradient && colors.gradient !== 'none') {
                // Try to extract colors from gradient
                const gradientMatch = colors.gradient.match(/linear-gradient\([^,]+,\s*([^,]+),\s*([^)]+)\)/);
                if (gradientMatch && gradientMatch.length >= 3) {
                    background = gradientMatch[1].trim();
                    backgroundSecondary = gradientMatch[2].trim();
                }
            }
            
            return {
                background: background,
                backgroundSecondary: backgroundSecondary,
                text: colors.text,
                accent: colors.accent
            };
        }

        // ===== GITHUB SYNC FUNCTIONALITY =====

        // Initialize sync UI
        function initializeSyncUI() {
            // Set token input value
            githubTokenInput.value = githubToken;
            
            // Update sync status
            updateSyncStatus();
            
            // Show/hide sync controls based on sync state
            updateSyncControls();
        }

        // Update sync status display
        function updateSyncStatus() {
            if (isSyncing) {
                syncStatusDot.className = 'sync-status-dot syncing';
                syncStatusText.textContent = 'Syncing...';
            } else if (syncEnabled && githubToken) {
                syncStatusDot.className = 'sync-status-dot enabled';
                syncStatusText.textContent = 'Sync Enabled';
                
                // Show last sync time
                const lastSync = localStorage.getItem('lastSync');
                if (lastSync) {
                    const lastSyncDate = new Date(parseInt(lastSync));
                    syncLastUpdate.textContent = `Last sync: ${lastSyncDate.toLocaleString()}`;
                } else {
                    syncLastUpdate.textContent = '';
                }
            } else {
                syncStatusDot.className = 'sync-status-dot';
                syncStatusText.textContent = 'Sync Disabled';
                syncLastUpdate.textContent = '';
            }
        }

        // Update sync controls visibility
        function updateSyncControls() {
            if (syncEnabled && githubToken) {
                enableSyncBtn.style.display = 'none';
                disableSyncBtn.style.display = 'block';
                manualSyncBtn.style.display = 'block';
                generateSyncUrlBtn.style.display = 'block';
                syncInfo.style.display = 'block';
                
                // Update sync info
                gistIdDisplay.textContent = gistId || 'Not created yet';
                userIdDisplay.textContent = syncUserId || 'Not generated yet';
            } else {
                enableSyncBtn.style.display = 'block';
                disableSyncBtn.style.display = 'none';
                manualSyncBtn.style.display = 'none';
                generateSyncUrlBtn.style.display = 'none';
                syncInfo.style.display = 'none';
            }
        }

        // Toggle token visibility
        function toggleTokenVisibility() {
            const isPassword = githubTokenInput.type === 'password';
            githubTokenInput.type = isPassword ? 'text' : 'password';
            toggleTokenVisibilityBtn.textContent = isPassword ? '🙈' : '👁️';
        }

        // Handle token input
        function onTokenInput(e) {
            githubToken = e.target.value.trim();
            localStorage.setItem('githubToken', githubToken);
        }

        // Generate unique user ID
        function generateUserId() {
            return 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
        }

        // Enable sync
        async function enableSync() {
            try {
                if (!githubToken) {
                    alert('Please enter your GitHub Personal Access Token first.');
                    githubTokenInput.focus();
                    return;
                }

                enableSyncBtn.disabled = true;
                enableSyncBtn.textContent = 'Enabling...';

                // Generate user ID if not exists
                if (!syncUserId) {
                    syncUserId = generateUserId();
                    localStorage.setItem('syncUserId', syncUserId);
                }

                // Initialize sync
                await initGistSync();

                // Update state
                syncEnabled = true;
                localStorage.setItem('syncEnabled', 'true');

                // Update UI
                updateSyncStatus();
                updateSyncControls();

                alert('Sync enabled successfully!');
            } catch (error) {
                console.error('Error enabling sync:', error);
                alert('Failed to enable sync: ' + error.message);
            } finally {
                enableSyncBtn.disabled = false;
                enableSyncBtn.textContent = 'Enable Sync';
            }
        }

        // Disable sync
        function disableSync() {
            if (confirm('Are you sure you want to disable sync? This will not delete your gist data.')) {
                syncEnabled = false;
                localStorage.setItem('syncEnabled', 'false');
                
                updateSyncStatus();
                updateSyncControls();
                
                alert('Sync disabled.');
            }
        }

        // Manual sync
        async function manualSync() {
            if (!syncEnabled || !githubToken) {
                alert('Sync is not enabled.');
                return;
            }

            try {
                manualSyncBtn.disabled = true;
                manualSyncBtn.textContent = 'Syncing...';

                // Load from gist first, then save
                await loadFromGist();
                await saveToGist();

                alert('Manual sync completed!');
            } catch (error) {
                console.error('Error during manual sync:', error);
                alert('Manual sync failed: ' + error.message);
            } finally {
                manualSyncBtn.disabled = false;
                manualSyncBtn.textContent = 'Manual Sync';
            }
        }

        // Generate sync URL
        function generateSyncUrl() {
            try {
                const exportData = {
                    settings: currentSettings,
                    commands: Array.from(commands.entries()),
                    syncEnabled: true,
                    githubToken: githubToken,
                    gistId: gistId,
                    version: "2.0"
                };

                const compressed = btoa(JSON.stringify(exportData));
                const syncUrl = `${window.location.origin}${window.location.pathname}#sync=${compressed}`;

                // Copy to clipboard
                navigator.clipboard.writeText(syncUrl).then(() => {
                    alert('⚠️ WARNING: This URL contains your GitHub token!\n\nSync URL copied to clipboard. Share this URL to sync settings across devices, but be careful as it contains your GitHub token.');
                }).catch(() => {
                    // Fallback for older browsers
                    prompt('⚠️ WARNING: This URL contains your GitHub token!\n\nCopy this sync URL:', syncUrl);
                });
            } catch (error) {
                console.error('Error generating sync URL:', error);
                alert('Failed to generate sync URL: ' + error.message);
            }
        }

        // Check for sync URL in hash
        function checkForSyncUrl() {
            const hash = window.location.hash;
            if (hash.startsWith('#sync=')) {
                try {
                    const compressed = hash.substring(6);
                    const importData = JSON.parse(atob(compressed));

                    if (confirm('Import sync data from URL? This will replace your current settings.')) {
                        // Import the data
                        if (importData.settings) {
                            currentSettings = importData.settings;
                        }
                        if (importData.commands) {
                            commands = new Map(importData.commands);
                        }
                        if (importData.githubToken) {
                            githubToken = importData.githubToken;
                            localStorage.setItem('githubToken', githubToken);
                        }
                        if (importData.gistId) {
                            gistId = importData.gistId;
                            localStorage.setItem('gistId', gistId);
                        }
                        if (importData.syncEnabled) {
                            syncEnabled = true;
                            localStorage.setItem('syncEnabled', 'true');
                        }

                        // Update UI
                        loadSettings();
                        renderShortcuts();
                        initializeSyncUI();
                        applyTheme(currentSettings.theme, currentSettings.darkMode, currentSettings.useCustomColors);

                        // Save settings
                        saveSettings();

                        alert('Sync data imported successfully!');
                    }

                    // Clear the hash
                    window.location.hash = '';
                } catch (error) {
                    console.error('Error importing sync URL:', error);
                    alert('Invalid sync URL format.');
                    window.location.hash = '';
                }
            }
        }

        // Initialize GitHub Gist sync
        async function initGistSync() {
            if (!githubToken) {
                throw new Error('GitHub token required');
            }

            // Load existing data if gist ID exists
            if (gistId) {
                await loadFromGist();
            }

            // Perform initial save
            await saveToGist();
        }

        // Find existing gist
        async function findExistingGist() {
            const response = await fetch('https://api.github.com/gists', {
                headers: { 'Authorization': `token ${githubToken}` }
            });

            if (!response.ok) {
                throw new Error(`GitHub API error: ${response.status} ${response.statusText}`);
            }

            const gists = await response.json();
            const rssGist = gists.find(gist => 
                gist.description === "Home Settings Sync Data" &&
                gist.files['home-sync-data.json']
            );

            if (rssGist) {
                gistId = rssGist.id;
                localStorage.setItem('gistId', gistId);
                return gistId;
            }
            return null;
        }

        // Get gist data
        async function getGistData() {
            if (!gistId) {
                await findExistingGist();
                if (!gistId) return null;
            }

            try {
                const response = await fetch(`https://api.github.com/gists/${gistId}`, {
                    headers: { 'Authorization': `token ${githubToken}` }
                });

                if (!response.ok) {
                    if (response.status === 404) {
                        // Gist was deleted, clear the ID
                        gistId = '';
                        localStorage.removeItem('gistId');
                        return null;
                    }
                    throw new Error(`GitHub API error: ${response.status} ${response.statusText}`);
                }

                const gist = await response.json();
                const fileContent = gist.files['home-sync-data.json']?.content;
                
                if (fileContent) {
                    return JSON.parse(fileContent);
                }
            } catch (error) {
                console.error('Error getting gist data:', error);
                throw error;
            }

            return null;
        }

        // Save gist data
        async function saveGistData(data) {
            // Find existing gist if no ID
            if (!gistId) {
                await findExistingGist();
            }

            const gistData = {
                description: "Home Settings Sync Data",
                public: false,
                files: {
                    "home-sync-data.json": {
                        content: JSON.stringify(data, null, 2)
                    }
                }
            };

            const url = gistId 
                ? `https://api.github.com/gists/${gistId}`
                : 'https://api.github.com/gists';

            const method = gistId ? 'PATCH' : 'POST';

            const response = await fetch(url, {
                method,
                headers: {
                    'Authorization': `token ${githubToken}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(gistData)
            });

            if (!response.ok) {
                throw new Error(`GitHub API error: ${response.status} ${response.statusText}`);
            }

            const result = await response.json();

            // Store gist ID for new gists
            if (!gistId) {
                gistId = result.id;
                localStorage.setItem('gistId', gistId);
            }

            return result;
        }

        // Load from gist
        async function loadFromGist() {
            try {
                isSyncing = true;
                updateSyncStatus();

                const gistData = await getGistData();
                if (!gistData) return;

                const localLastSync = parseInt(localStorage.getItem('lastSync') || '0');
                const gistLastSync = gistData.lastSync || 0;

                // Conflict resolution with 50ms buffer
                if (gistLastSync > localLastSync + 50) {
                    console.log('Loading newer data from gist');

                    // Update settings
                    if (gistData.settings) {
                        currentSettings = { ...currentSettings, ...gistData.settings };
                        
                        // Update UI elements
                        darkModeSetting.checked = currentSettings.darkMode;
                        autoThemeSetting.checked = currentSettings.autoTheme;
                        themeSelect.value = currentSettings.theme;
                        newTabSetting.checked = currentSettings.openLinksInNewTab;
                        rssEnabledSetting.checked = currentSettings.rssEnabled;
                        cornerTextSetting.value = currentSettings.cornerText;
                        
                        if (currentSettings.rssFeeds && Array.isArray(currentSettings.rssFeeds)) {
                            document.getElementById('rss-feeds').value = currentSettings.rssFeeds.join('\n');
                        }
                    }

                    // Update commands
                    if (gistData.commands) {
                        commands = new Map(gistData.commands);
                        renderShortcuts();
                    }

                    // Save to localStorage
                    localStorage.setItem('homeSettings', JSON.stringify(currentSettings));
                    localStorage.setItem('homeCommands', JSON.stringify(Array.from(commands.entries())));
                    localStorage.setItem('lastSync', gistLastSync.toString());

                    // Apply theme
                    applyTheme(currentSettings.theme, currentSettings.darkMode, currentSettings.useCustomColors);
                }
            } catch (error) {
                console.error('Error loading from gist:', error);
                syncStatusDot.className = 'sync-status-dot error';
                syncStatusText.textContent = 'Sync Error';
                throw error;
            } finally {
                isSyncing = false;
                updateSyncStatus();
            }
        }

        // Save to gist
        async function saveToGist() {
            if (!githubToken || !syncEnabled || isSyncing) return;

            try {
                isSyncing = true;
                updateSyncStatus();

                // Pre-save conflict check
                const existingGistData = await getGistData();
                const localLastSync = parseInt(localStorage.getItem('lastSync') || '0');

                if (existingGistData && existingGistData.lastSync > localLastSync) {
                    console.log('Newer data found in gist, loading instead of saving');
                    await loadFromGist();
                    return;
                }

                // Timestamp delay for uniqueness
                await new Promise(resolve => setTimeout(resolve, 100));

                const dataToSync = {
                    settings: currentSettings,
                    commands: Array.from(commands.entries()),
                    lastSync: Date.now(),
                    version: "2.0"
                };

                await saveGistData(dataToSync);
                localStorage.setItem('lastSync', dataToSync.lastSync.toString());

                console.log('Data saved to gist successfully');
            } catch (error) {
                console.error('Error saving to gist:', error);
                syncStatusDot.className = 'sync-status-dot error';
                syncStatusText.textContent = 'Sync Error';
                throw error;
            } finally {
                isSyncing = false;
                updateSyncStatus();
            }
        }

        // Auto sync with debouncing
        function autoSync() {
            if (syncEnabled && !isSyncing && githubToken) {
                // Debounce to avoid rapid-fire syncing
                clearTimeout(autoSyncTimeout);
                autoSyncTimeout = setTimeout(() => {
                    saveToGist().catch(error => {
                        console.error('Auto-sync failed:', error);
                    });
                }, 500);
            }
        }

        // Override saveSettings to trigger auto-sync
        const originalSaveSettings = saveSettings;
        saveSettings = function() {
            originalSaveSettings.call(this);
            autoSync();
        };

    </script>
</body>
</html>